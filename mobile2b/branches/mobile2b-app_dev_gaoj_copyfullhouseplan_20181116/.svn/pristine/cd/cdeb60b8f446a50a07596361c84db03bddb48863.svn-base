<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nork.design.dao.FullHouseDesignPlanMapper">

    <resultMap id="BaseResultMap" type="com.nork.design.model.FullHouseDesignPlan" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="uuid" property="uuid" jdbcType="VARCHAR" />
        <result column="plan_code" property="planCode" jdbcType="VARCHAR" />
        <result column="plan_name" property="planName" jdbcType="VARCHAR" />
        <result column="plan_style_id" property="planStyleId" jdbcType="INTEGER" />
        <result column="plan_style_name" property="planStyleName" jdbcType="VARCHAR" />
        <result column="plan_pic_id" property="planPicId" jdbcType="INTEGER" />
        <result column="plan_describe" property="planDescribe" jdbcType="VARCHAR" />
        <result column="company_id" property="companyId" jdbcType="INTEGER" />
        <result column="brand_ids" property="brandIds" jdbcType="VARCHAR" />
        <result column="user_id" property="userId" jdbcType="INTEGER" />
        <result column="source_type" property="sourceType" jdbcType="INTEGER" />
        <result column="source_plan_id" property="sourcePlanId" jdbcType="INTEGER" />
        <result column="open_state" property="openState" jdbcType="INTEGER" />
        <result column="vr_resource_uuid" property="vrResourceUuid" jdbcType="VARCHAR" />
        <result column="version" property="version" jdbcType="INTEGER" />
        <result column="open_time" property="openTime" jdbcType="TIMESTAMP" />
        <result column="creator" property="creator" jdbcType="VARCHAR" />
        <result column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
        <result column="modifier" property="modifier" jdbcType="VARCHAR" />
        <result column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
        <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="render_state" property="renderState" jdbcType="INTEGER" />
    </resultMap>
    <sql id="Base_Column_List" >
        id, uuid, plan_code, plan_name, plan_style_id, plan_style_name, plan_pic_id, plan_describe,
        company_id, brand_ids, user_id, source_type, source_plan_id, open_state,
        vr_resource_uuid, version, open_time, creator, gmt_create, modifier, gmt_modified, is_deleted, remark,render_state
    </sql>

    <update id="updateByPrimaryKey" parameterType="com.nork.design.model.FullHouseDesignPlan" >
        update full_house_design_plan
        <set >
        <if test="uuid != null" >
            uuid = #{uuid,jdbcType=VARCHAR},
        </if>
        <if test="planCode != null" >
            plan_code = #{planCode,jdbcType=VARCHAR},
        </if>
        <if test="planName != null" >
            plan_name = #{planName,jdbcType=VARCHAR},
        </if>
        <if test="planStyleId != null" >
            plan_style_id = #{planStyleId,jdbcType=INTEGER},
        </if>
        <if test="planStyleName != null" >
            plan_style_name = #{planStyleName,jdbcType=VARCHAR},
        </if>
        <if test="planPicId != null" >
            plan_pic_id = #{planPicId,jdbcType=INTEGER},
        </if>
        <if test="planDescribe != null" >
            plan_describe = #{planDescribe,jdbcType=VARCHAR},
        </if>
        <if test="companyId != null" >
            company_id = #{companyId,jdbcType=INTEGER},
        </if>
        <if test="brandIds != null" >
            brand_ids = #{brandIds,jdbcType=VARCHAR},
        </if>
        <if test="userId != null" >
            user_id = #{userId,jdbcType=INTEGER},
        </if>
        <if test="sourceType != null" >
            source_type = #{sourceType,jdbcType=INTEGER},
        </if>
        <if test="sourcePlanId != null" >
            source_plan_id = #{sourcePlanId,jdbcType=INTEGER},
        </if>
        <if test="openState != null" >
            open_state = #{openState,jdbcType=INTEGER},
        </if>
        <if test="vrResourceUuid != null" >
            vr_resource_uuid = #{vrResourceUuid,jdbcType=VARCHAR},
        </if>
        <if test="version != null">
            version = #{version,jdbcType=INTEGER},
        </if>
        <if test="openTime != null">
            open_time = #{openTime,jdbcType=TIMESTAMP},
        </if>
        <if test="creator != null" >
            creator = #{creator,jdbcType=VARCHAR},
        </if>
        <if test="gmtCreate != null" >
            gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
        </if>
        <if test="modifier != null" >
            modifier = #{modifier,jdbcType=VARCHAR},
        </if>
        <if test="gmtModified != null" >
            gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
        </if>
        <if test="isDeleted != null" >
            is_deleted = #{isDeleted,jdbcType=INTEGER},
        </if>
        <if test="remark != null" >
            remark = #{remark,jdbcType=VARCHAR},
        </if>
            <if test="renderState != null" >
                render_state = #{renderState,jdbcType=INTEGER},
        </if>

        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>


    <select id="getFullHousePlanCountByUserId" resultType="java.lang.Integer">
		select count(1)
		from full_house_design_plan
		where user_id = #{userId}
		and (source_type = 2 or (source_type = 5 and is_update = 1))
		and is_deleted = 0

	</select>

	<select id="getFullHousePlanListByUserId" resultType="com.nork.design.model.ThumbData"
		parameterType="com.nork.design.model.DesignPlanRenderScene">
		select
		  	fh.id as cpId,
			fh.plan_name as name,
			rrp.pic_path as pic,
			fh.vr_resource_uuid as fullHousePlanUUID,
            fh.render_state as renderState,
			fh.gmt_modified as ctime,
			2 as planHouseType
		from full_house_design_plan fh
		left join res_render_pic rrp on fh.plan_pic_id = rrp.id
		where fh.user_id = #{userId}
        and (source_type = 2 or (source_type = 5 and is_update = 1))
        and fh.is_deleted = 0
		order by fh.gmt_modified desc
		<if test="start !=-1 and limit !=-1"> LIMIT #{start}, #{limit}</if>
	</select>

    <select id="getFullHousePlanById" parameterType="integer" resultMap="BaseResultMap">
        select
          <include refid="Base_Column_List"></include>
        from full_house_design_plan
        where id = #{fullHousePlanId,jdbcType=INTEGER}
    </select>


    <select id="getFullHousePlanByUUID" parameterType="String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"></include>
        from full_house_design_plan
        where uuid = #{fullHousePlanUUID,jdbcType=VARCHAR}
    </select>


    <resultMap id="BaseDetailMap" type="com.nork.design.model.FullHouseDesignPlanDetail" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="uuid" property="uuid" jdbcType="VARCHAR" />
        <result column="full_house_plan_id" property="fullHousePlanId" jdbcType="INTEGER" />
        <result column="recommended_plan_group_primary_id" property="recommendedPlanGroupPrimaryId" jdbcType="INTEGER" />
        <result column="render_scene_plan_id" property="renderScenePlanId" jdbcType="INTEGER" />
        <result column="space_type" property="spaceType" jdbcType="INTEGER" />
        <result column="priority_level" property="priorityLevel" jdbcType="INTEGER" />
        <result column="plan_render_resource_id" property="planRenderResourceId" jdbcType="INTEGER" />
        <result column="plan_recommended_resource_id" property="planRecommendedResourceId" jdbcType="INTEGER" />
        <result column="creator" property="creator" jdbcType="VARCHAR" />
        <result column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
        <result column="modifier" property="modifier" jdbcType="VARCHAR" />
        <result column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
        <result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Detail_List" >
        id, uuid, full_house_plan_id, recommended_plan_group_primary_id, render_scene_plan_id, space_type, priority_level,
        plan_render_resource_id, plan_recommended_resource_id, creator, gmt_create, modifier, gmt_modified, is_deleted,
        remark
    </sql>

    <select id="getFullHousePlanDetailsList" parameterType="integer" resultMap="BaseDetailMap">
        select
        <include refid="Base_Detail_List"/>
        from full_house_design_plan_detail where full_house_plan_id = #{fullHousePlanId,jdbcType=INTEGER}
    </select>
</mapper>
