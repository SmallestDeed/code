<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.grouppurchase.dao.GroupPurchaseOpenDetailMapper">
    <resultMap id="BaseResultMap" type="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="user_id" property="userId" jdbcType="BIGINT"/>
        <result column="purchase_activity_id" property="purchaseActivityId" jdbcType="BIGINT"/>
        <result column="purchase_open_id" property="purchaseOpenId" jdbcType="BIGINT"/>
        <result column="purchase_goods_id" property="purchaseGoodsId" jdbcType="BIGINT"/>
        <result column="telephone" property="telephone" jdbcType="BIGINT"/>
        <result column="user_type" property="userType" jdbcType="TINYINT"/>
        <result column="is_master" property="isMaster" jdbcType="TINYINT"/>
        <result column="order_amount" property="orderAmount" jdbcType="DECIMAL"/>
        <result column="buy_quantity" property="buyQuantity" jdbcType="DECIMAL"/>
        <result column="order_id" property="orderId" jdbcType="BIGINT"/>
        <result column="order_no" property="orderNo" jdbcType="VARCHAR"/>
        <result column="creator" property="creator" jdbcType="VARCHAR"/>
        <result column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP"/>
        <result column="MODIFIER" property="modifier" jdbcType="VARCHAR"/>
        <result column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP"/>
        <result column="is_deleted" property="isDeleted" jdbcType="INTEGER"/>
        <result column="join_status" property="joinStatus" jdbcType="INTEGER"/>
    </resultMap>
    <sql id="Base_Column_List">
    id, user_id, purchase_activity_id, purchase_open_id, purchase_goods_id, telephone, 
    user_type, is_master, order_amount, buy_quantity, order_id, order_no, creator, gmt_create, 
    MODIFIER, gmt_modified, is_deleted,join_status
  </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        from group_purchase_open_detail
        where id = #{id,jdbcType=BIGINT}
    </select>
    <select id="bizQuery" resultType="com.sandu.api.grouppurchase.bo.UserPurchaseListBO">
        select detail.purchase_open_id,detail.is_master, spu.spu_name,spu.id as spu_id, good.activity_price,
        spu.pic_id as picId, sku.price as basePrice,
        o.total_number,
        o.open_status,
        o.join_number,
        o.expire_date,
        o.gmt_create as start_date,
        o.purchase_activity_id as activityId

        from group_purchase_open_detail detail,
              group_purchase_open o,
              group_purchase_goods good,
              base_goods_sku sku,
              base_goods_spu spu
         where detail.purchase_open_id = o.id
           and detail.purchase_goods_id = good.id
           and good.sku_id = sku.id
           and good.spu_id = spu.id
        and o.purchase_activity_id = good.purchase_activity_id

        <if test="joinStatus != null">
            and detail.join_status = #{joinStatus}
        </if>
        <if test="isMaster != null">
            and detail.is_master = #{isMaster}
        </if>
        <if test="userId != null">
            and detail.user_id = #{userId}
        </if>
        <if test="purchaseOpenId != null">
            and o.id = #{purchaseOpenId}
        </if>
        order by o.id desc
    </select>
    <select id="getOpenDetailByOpenId" resultType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        select * from group_purchase_open_detail
        where is_deleted = 0 and join_status = 2
        <if test="purchaseOpenId != null and purchaseOpenId != ''">
            and purchase_open_id = #{purchaseOpenId}
        </if>
    </select>
    <select id="getByOrderId" resultType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        select * from group_purchase_open_detail
        where is_deleted = 0
         and order_no = #{payTradeNo}
    </select>
    <select id="listByPurchaseOpenIds" resultType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        select * from group_purchase_open_detail
        where purchase_open_id in
        <foreach collection="purchaseOpenIds" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>
    <select id="listByGroupPurchaseOpenIds"
            resultType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        select * from group_purchase_open_detail where 1= 1
        <if test="failedOpenIds !=null and failedOpenIds.size > 0">
            and purchase_open_id in
            <foreach collection="failedOpenIds" separator="," open="(" close=")" item="id">
                #{id}
            </foreach>
        </if>
    </select>
    <select id="checkOpenDetailsWithUserIdAndOpenId"
            resultType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        select * from group_purchase_open_detail
        where purchase_activity_id = #{purchaseActivityId} and user_id = #{userId} and is_deleted = 0 and join_status not in (0,1)
    </select>

    <select id="listGroupUserDetail" resultType="com.sandu.api.user.model.SysUser">
      select u.id, u.nick_name, u.head_pic from sys_user u where u.id in
      <foreach collection="list" item="item" open="(" separator="," close=")">#{item}</foreach>
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from group_purchase_open_detail
    where id = #{id,jdbcType=BIGINT}
  </delete>
    <insert id="insert" parameterType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
    insert into group_purchase_open_detail (id, user_id, purchase_activity_id, 
      purchase_open_id, purchase_goods_id, telephone, 
      user_type, is_master, order_amount, 
      buy_quantity, order_id, order_no, 
      creator, gmt_create, MODIFIER, 
      gmt_modified, is_deleted,join_status)
    values (#{id,jdbcType=BIGINT}, #{userId,jdbcType=BIGINT}, #{purchaseActivityId,jdbcType=BIGINT}, 
      #{purchaseOpenId,jdbcType=BIGINT}, #{purchaseGoodsId,jdbcType=BIGINT}, #{telephone,jdbcType=BIGINT}, 
      #{userType,jdbcType=TINYINT}, #{isMaster,jdbcType=TINYINT}, #{orderAmount,jdbcType=DECIMAL}, 
      #{buyQuantity,jdbcType=DECIMAL}, #{orderId,jdbcType=BIGINT}, #{orderNo,jdbcType=VARCHAR}, 
      #{creator,jdbcType=VARCHAR}, #{gmtCreate,jdbcType=TIMESTAMP}, #{modifier,jdbcType=VARCHAR}, 
      #{gmtModified,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=INTEGER},#{joinStatus})
  </insert>
    <insert id="insertSelective" parameterType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        insert into group_purchase_open_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="userId != null">
                user_id,
            </if>
            <if test="purchaseActivityId != null">
                purchase_activity_id,
            </if>
            <if test="purchaseOpenId != null">
                purchase_open_id,
            </if>
            <if test="purchaseGoodsId != null">
                purchase_goods_id,
            </if>
            <if test="telephone != null">
                telephone,
            </if>
            <if test="userType != null">
                user_type,
            </if>
            <if test="isMaster != null">
                is_master,
            </if>
            <if test="orderAmount != null">
                order_amount,
            </if>
            <if test="buyQuantity != null">
                buy_quantity,
            </if>
            <if test="orderId != null">
                order_id,
            </if>
            <if test="orderNo != null">
                order_no,
            </if>
            <if test="creator != null">
                creator,
            </if>
            <if test="gmtCreate != null">
                gmt_create,
            </if>
            <if test="modifier != null">
                MODIFIER,
            </if>
            <if test="gmtModified != null">
                gmt_modified,
            </if>
            <if test="isDeleted != null">
                is_deleted,
            </if>
            <if test="joinStatus != null">
                join_status,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="userId != null">
                #{userId,jdbcType=BIGINT},
            </if>
            <if test="purchaseActivityId != null">
                #{purchaseActivityId,jdbcType=BIGINT},
            </if>
            <if test="purchaseOpenId != null">
                #{purchaseOpenId,jdbcType=BIGINT},
            </if>
            <if test="purchaseGoodsId != null">
                #{purchaseGoodsId,jdbcType=BIGINT},
            </if>
            <if test="telephone != null">
                #{telephone,jdbcType=BIGINT},
            </if>
            <if test="userType != null">
                #{userType,jdbcType=TINYINT},
            </if>
            <if test="isMaster != null">
                #{isMaster,jdbcType=TINYINT},
            </if>
            <if test="orderAmount != null">
                #{orderAmount,jdbcType=DECIMAL},
            </if>
            <if test="buyQuantity != null">
                #{buyQuantity,jdbcType=DECIMAL},
            </if>
            <if test="orderId != null">
                #{orderId,jdbcType=BIGINT},
            </if>
            <if test="orderNo != null">
                #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="joinStatus != null">
                #{joinStatus},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
        update group_purchase_open_detail
        <set>
            <if test="userId != null">
                user_id = #{userId,jdbcType=BIGINT},
            </if>
            <if test="purchaseActivityId != null">
                purchase_activity_id = #{purchaseActivityId,jdbcType=BIGINT},
            </if>
            <if test="purchaseOpenId != null">
                purchase_open_id = #{purchaseOpenId,jdbcType=BIGINT},
            </if>
            <if test="purchaseGoodsId != null">
                purchase_goods_id = #{purchaseGoodsId,jdbcType=BIGINT},
            </if>
            <if test="telephone != null">
                telephone = #{telephone,jdbcType=BIGINT},
            </if>
            <if test="userType != null">
                user_type = #{userType,jdbcType=TINYINT},
            </if>
            <if test="isMaster != null">
                is_master = #{isMaster,jdbcType=TINYINT},
            </if>
            <if test="orderAmount != null">
                order_amount = #{orderAmount,jdbcType=DECIMAL},
            </if>
            <if test="buyQuantity != null">
                buy_quantity = #{buyQuantity,jdbcType=DECIMAL},
            </if>
            <if test="orderId != null">
                order_id = #{orderId,jdbcType=BIGINT},
            </if>
            <if test="orderNo != null">
                order_no = #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                MODIFIER = #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                is_deleted = #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="joinStatus != null">
                join_status = #{joinStatus},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.sandu.api.grouppurchase.model.GroupPurchaseOpenDetail">
    update group_purchase_open_detail
    set user_id = #{userId,jdbcType=BIGINT},
      purchase_activity_id = #{purchaseActivityId,jdbcType=BIGINT},
      purchase_open_id = #{purchaseOpenId,jdbcType=BIGINT},
      purchase_goods_id = #{purchaseGoodsId,jdbcType=BIGINT},
      telephone = #{telephone,jdbcType=BIGINT},
      user_type = #{userType,jdbcType=TINYINT},
      is_master = #{isMaster,jdbcType=TINYINT},
      order_amount = #{orderAmount,jdbcType=DECIMAL},
      buy_quantity = #{buyQuantity,jdbcType=DECIMAL},
      order_id = #{orderId,jdbcType=BIGINT},
      order_no = #{orderNo,jdbcType=VARCHAR},
      creator = #{creator,jdbcType=VARCHAR},
      gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
      MODIFIER = #{modifier,jdbcType=VARCHAR},
      gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
      join_status = #{joinStatus},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
</mapper>