<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nork.design.dao.DesignPlanRecommendedMapperV2">
<!--<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>-->
	<!-- **插入定义** -->
	<insert id="insertSelective" parameterType="com.nork.design.model.DesignPlanRecommended"  useGeneratedKeys="true" keyProperty="id">
		insert into design_plan_recommended
		<trim prefix="(" suffix=")" suffixOverrides=",">
		<if test="recommendedType!= null">recommended_type, </if>
		<if test="planId!= null">plan_id, </if>
		<if test="planCode!= null">plan_code, </if>
		<if test="planName!= null">plan_name, </if>
		<if test="planSource!= null">plan_source, </if>
		<if test="houseId!= null">house_id, </if>
		<if test="livingId!= null">living_id, </if>
		<if test="residentialUnitsName!= null">residential_units_name,</if>
		<if test="userId!= null">user_id, </if>
		<if test="mediaType!= null">media_type, </if>
		<if test="designSourceType!= null">design_source_type, </if>
		<if test="designId!= null">design_id, </if>
		<if test="designTemplateId!= null">design_template_id, </if>
		<if test="designStyleId!= null">design_style_id, </if>
		<if test="picId!= null">pic_id, </if>
		<if test="modelId!= null">model_id, </if>
		<if test="model3dId!= null">model_3d_id, </if>
		<if test="modelU3dId!= null">model_u3d_id, </if>
		<if test="webModelU3dId!= null">web_model_u3d_id, </if>
		<if test="iosModelU3dId!= null">ios_model_u3d_id, </if>
		<if test="ipadModelU3dId!= null">ipad_model_u3d_id, </if>
		<if test="pcModelU3dId!= null">pc_model_u3d_id, </if>
		<if test="androidModelU3dId!= null">android_model_u3d_id, </if>
		<if test="macBookpcModelU3dId!= null">macBookpc_model_u3d_id, </if>
		<if test="configFileId!= null">config_file_id, </if>
		<if test="planDesc!= null">plan_desc, </if>
		<if test="spaceCommonId!= null">space_common_id, </if>
		<if test="designPlanRenderPicIds!= null">designPlan_render_pic_ids, </if>
		<if test="sysCode!= null">sys_code, </if>
		<if test="creator!= null">creator, </if>
		<if test="gmtCreate!= null">gmt_create, </if>
		<if test="modifier!= null">modifier, </if>
		<if test="gmtModified!= null">gmt_modified, </if>
		<if test="isDeleted!= null">is_deleted, </if>
		<if test="remark!= null">remark, </if>
		<if test="shareTotal!= null">share_total, </if>
		<if test="isOpen!= null">is_open, </if>
		<if test="isChange!= null">is_change, </if>
		<if test="isDecorated!= null">is_decorated, </if>
		<if test="draftState!= null">draft_state, </if>
		<if test="baiMoState!= null">baiMo_state, </if>
		<if test="stuffFinishState!= null">stuff_finish_state, </if>
		<if test="decorateFinishState!= null">decorate_finish_state, </if>
		<if test="coverPicId!= null">cover_pic_Id, </if>
		<if test="isRelease!= null">is_release, </if>
		<if test="releaseTime!= null">release_time, </if>
		<if test="designRecommendedStyleId!= null">design_recommended_style_id, </if>
		<if test="isRecommended!= null">is_recommended, </if>
		<if test="isDefaultDecorate!= null">is_default_decorate, </if>
		<if test="planNumber!= null">plan_number, </if>
		<if test="applySpaceAreas!= null">apply_space_areas, </if>
		<if test="spellingFlowerFileId!= null">spelling_flower_file_id, </if>
		<if test="spellingFlowerProduct!= null">spelling_flower_product, </if>
		<if test="spaceLayoutType!= null">space_layout_type, </if>
		<if test="companyId!= null">company_id, </if>
		<if test="shelfStatus!= null">shelf_status, </if>
		</trim>
		
		<trim prefix="values (" suffix=")" suffixOverrides=",">
		<if test="recommendedType!= null">#{recommendedType,jdbcType=INTEGER}, </if>
		<if test="planId!= null">#{planId,jdbcType=INTEGER}, </if>
		<if test="planCode!= null">  #{planCode,jdbcType=VARCHAR}, </if>
		<if test="planName!= null">  #{planName,jdbcType=VARCHAR}, </if>
		<if test="planSource!= null"> #{planSource,jdbcType=VARCHAR},</if>
		<if test="houseId!= null">  #{houseId,jdbcType=INTEGER}, </if>
		<if test="livingId!= null">  #{livingId,jdbcType=INTEGER}, </if>
		<if test="residentialUnitsName!= null">#{residentialUnitsName,jdbcType=VARCHAR},</if>
		<if test="userId!= null">  #{userId,jdbcType=INTEGER}, </if>
		<if test="mediaType!= null">  #{mediaType,jdbcType=INTEGER}, </if>
		<if test="designSourceType!= null">  #{designSourceType,jdbcType=INTEGER}, </if>
		<if test="designId!= null">  #{designId,jdbcType=INTEGER}, </if>
		<if test="designTemplateId!= null">  #{designTemplateId,jdbcType=INTEGER}, </if>
		<if test="designStyleId!= null">  #{designStyleId,jdbcType=INTEGER}, </if>
		<if test="picId!= null">  #{picId,jdbcType=INTEGER}, </if>
		<if test="modelId!= null">  #{modelId,jdbcType=INTEGER}, </if>
		<if test="model3dId!= null">  #{model3dId,jdbcType=INTEGER}, </if>
		<if test="modelU3dId!= null">  #{modelU3dId,jdbcType=INTEGER}, </if>
		<if test="webModelU3dId!= null">  #{webModelU3dId,jdbcType=INTEGER}, </if>
		<if test="iosModelU3dId!= null">  #{iosModelU3dId,jdbcType=INTEGER}, </if>
		<if test="ipadModelU3dId!= null">  #{ipadModelU3dId,jdbcType=INTEGER}, </if>
		<if test="pcModelU3dId!= null">  #{pcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="androidModelU3dId!= null">  #{androidModelU3dId,jdbcType=INTEGER}, </if>
		<if test="macBookpcModelU3dId!= null">  #{macBookpcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="configFileId!= null">  #{configFileId,jdbcType=INTEGER}, </if>
		<if test="planDesc!= null">  #{planDesc,jdbcType=VARCHAR}, </if>
		<if test="spaceCommonId!= null">  #{spaceCommonId,jdbcType=INTEGER}, </if>
		<if test="designPlanRenderPicIds!= null">  #{designPlanRenderPicIds,jdbcType=VARCHAR}, </if>
		<if test="sysCode!= null">  #{sysCode,jdbcType=VARCHAR}, </if>
		<if test="creator!= null">  #{creator,jdbcType=VARCHAR}, </if>
		<if test="gmtCreate!= null">  #{gmtCreate,jdbcType=TIMESTAMP}, </if>
		<if test="modifier!= null">  #{modifier,jdbcType=VARCHAR}, </if>
		<if test="gmtModified!= null">  #{gmtModified,jdbcType=TIMESTAMP}, </if>
		<if test="isDeleted!= null">  #{isDeleted,jdbcType=INTEGER}, </if>
		<if test="remark!= null">  #{remark,jdbcType=VARCHAR}, </if>
		<if test="shareTotal!= null">#{shareTotal,jdbcType=INTEGER}, </if>
		<if test="isOpen!= null">#{isOpen,jdbcType=INTEGER}, </if>
		<if test="isChange!= null">#{isChange,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">#{isDecorated,jdbcType=INTEGER}, </if>
		<if test="draftState!= null">#{draftState,jdbcType=INTEGER}, </if>
		<if test="baiMoState!= null">#{baiMoState,jdbcType=INTEGER}, </if>
		<if test="stuffFinishState!= null">#{stuffFinishState,jdbcType=INTEGER}, </if>
		<if test="decorateFinishState!= null">#{decorateFinishState,jdbcType=INTEGER}, </if>
		<if test="coverPicId!= null">#{coverPicId,jdbcType=INTEGER}, </if>
		<if test="isRelease!= null">#{isRelease,jdbcType=INTEGER}, </if>
		<if test="releaseTime!= null">#{releaseTime,jdbcType=TIMESTAMP}, </if>
		<if test="designRecommendedStyleId!= null">#{designRecommendedStyleId,jdbcType=INTEGER}, </if>
 		<if test="isRecommended!= null">#{isRecommended,jdbcType=INTEGER}, </if>
		<if test="isDefaultDecorate!= null">#{isDefaultDecorate,jdbcType=INTEGER}, </if>
		<if test="planNumber!= null">#{planNumber,jdbcType=VARCHAR}, </if>
		<if test="applySpaceAreas!= null"> #{applySpaceAreas,jdbcType=VARCHAR}, </if>
		<if test="spellingFlowerFileId!= null">#{spellingFlowerFileId,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerProduct!= null">#{spellingFlowerProduct,jdbcType=VARCHAR}, </if>
		<if test="spaceLayoutType!= null">#{spaceLayoutType,jdbcType=VARCHAR}, </if>
		<if test="companyId!= null">#{companyId,jdbcType=INTEGER}, </if>
		<if test="shelfStatus!= null">#{shelfStatus,jdbcType=VARCHAR}, </if>
		</trim>
	</insert>

	<!-- **更新定义** -->
	<update id="updateByPrimaryKeySelective" parameterType="com.nork.design.model.DesignPlanRecommended">
		update design_plan_recommended
		<set>
		<if test="planId!= null">plan_id = #{planId,jdbcType=INTEGER}, </if>
		<if test="recommendedType!= null"> recommended_type = #{recommendedType,jdbcType=INTEGER}, </if>
		<if test="planCode!= null">  plan_code = #{planCode,jdbcType=VARCHAR}, </if>
		<if test="planName!= null">  plan_name = #{planName,jdbcType=VARCHAR}, </if>
		<if test="userId!= null">  user_id = #{userId,jdbcType=INTEGER}, </if>
		<if test="mediaType!= null">  media_type = #{mediaType,jdbcType=INTEGER}, </if>
		<if test="designSourceType!= null">  design_source_type = #{designSourceType,jdbcType=INTEGER}, </if>
		<if test="designId!= null">  design_id = #{designId,jdbcType=INTEGER}, </if>
		<if test="designTemplateId!= null">  design_template_id = #{designTemplateId,jdbcType=INTEGER}, </if>
		<if test="designStyleId!= null">  design_style_id = #{designStyleId,jdbcType=INTEGER}, </if>
		<if test="picId!= null">  pic_id = #{picId,jdbcType=INTEGER}, </if>
		<if test="modelId!= null">  model_id = #{modelId,jdbcType=INTEGER}, </if>
		<if test="model3dId!= null">  model_3d_id = #{model3dId,jdbcType=INTEGER}, </if>
		<if test="modelU3dId!= null">  model_u3d_id = #{modelU3dId,jdbcType=INTEGER}, </if>
		<if test="webModelU3dId!= null">  web_model_u3d_id = #{webModelU3dId,jdbcType=INTEGER}, </if>
		<if test="iosModelU3dId!= null">  ios_model_u3d_id = #{iosModelU3dId,jdbcType=INTEGER}, </if>
		<if test="pcModelU3dId!= null">  pc_model_u3d_id = #{pcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="ipadModelU3dId!= null">  ipad_model_u3d_id = #{ipadModelU3dId,jdbcType=INTEGER}, </if>
		<if test="androidModelU3dId!= null">  android_model_u3d_id = #{androidModelU3dId,jdbcType=INTEGER}, </if>
		<if test="macBookpcModelU3dId!= null">  macBookpc_model_u3d_id = #{macBookpcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="configFileId!= null">  config_file_id = #{configFileId,jdbcType=INTEGER}, </if>
		<if test="spaceCommonId!= null">  space_common_id = #{spaceCommonId,jdbcType=INTEGER}, </if>
		<if test="designPlanRenderPicIds!= null"> designPlan_render_pic_ids = #{designPlanRenderPicIds,jdbcType=VARCHAR}, </if>
		<if test="planDesc!= null">  plan_desc = #{planDesc,jdbcType=VARCHAR}, </if>
		<if test="sysCode!= null">  sys_code = #{sysCode,jdbcType=VARCHAR}, </if>
		<if test="creator!= null">  creator = #{creator,jdbcType=VARCHAR}, </if>
		<if test="gmtCreate!= null">  gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}, </if>
		<if test="modifier!= null">  modifier = #{modifier,jdbcType=VARCHAR}, </if>
		<if test="gmtModified!= null">  gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}, </if>
		<if test="isDeleted!= null">  is_deleted = #{isDeleted,jdbcType=INTEGER}, </if>
		<if test="remark!= null">  remark = #{remark,jdbcType=VARCHAR}, </if>
		<if test="shareTotal!= null">  share_total = #{shareTotal,jdbcType=INTEGER}, </if>
		<if test="isOpen!= null">  is_open = #{isOpen,jdbcType=INTEGER}, </if>
		<if test="isChange!= null">  is_change = #{isChange,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">  is_decorated = #{isDecorated,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">  is_decorated = #{isDecorated,jdbcType=INTEGER}, </if>
		<if test="draftState!= null">  draft_state = #{draftState,jdbcType=INTEGER}, </if>
		<if test="baiMoState!= null">  baiMo_state = #{baiMoState,jdbcType=INTEGER}, </if>
		<if test="stuffFinishState!= null">  stuff_finish_state = #{stuffFinishState,jdbcType=INTEGER}, </if>
		<if test="decorateFinishState!= null">  decorate_finish_state = #{decorateFinishState,jdbcType=INTEGER}, </if>
		<if test="coverPicId!= null">cover_pic_Id = #{coverPicId,jdbcType=INTEGER}, </if>
		<if test="isRelease!= null">is_release = #{isRelease,jdbcType=INTEGER}, </if>
		<if test="releaseTime!= null">release_time =#{releaseTime,jdbcType=TIMESTAMP}, </if>
		<if test="designRecommendedStyleId!= null">design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}, </if>
		<if test="effectsConfig!= null">effects_config = #{effectsConfig,jdbcType=VARCHAR}, </if>
		<if test="isRecommended!= null">is_recommended = #{isRecommended,jdbcType=INTEGER}, </if>
		<if test="isDefaultDecorate!= null">is_default_decorate = #{isDefaultDecorate,jdbcType=INTEGER}, </if>
		<if test="planNumber!= null"> plan_number = #{planNumber,jdbcType=VARCHAR}, </if>
		<if test="applySpaceAreas!= null">apply_space_areas =  #{applySpaceAreas,jdbcType=VARCHAR}, </if>
		
		<if test="spellingFlowerFileId!= null">spelling_flower_file_id = #{spellingFlowerFileId,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerProduct!= null">spelling_flower_product = #{spellingFlowerProduct,jdbcType=VARCHAR}, </if>
		<if test="spaceLayoutType!= null">space_layout_type = #{spaceLayoutType,jdbcType=VARCHAR}, </if>
		<if test="companyId!= null">company_id = #{companyId,jdbcType=INTEGER}, </if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- **删除定义** -->
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!--delete from design_plan_recommended where id = #{id,jdbcType=INTEGER}-->
		UPDATE  design_plan_recommended SET is_deleted = 1,gmt_modified = NOW() WHERE id = #{id,jdbcType=INTEGER}
	</delete>
	
	<!-- **常量定义** -->
	<sql id="All_Column_List">
 

		id,spelling_flower_product,spelling_flower_file_id,plan_id,recommended_type,is_recommended,is_default_decorate,plan_number,design_recommended_style_id,release_time,is_release,cover_pic_Id,plan_code,plan_name,plan_source,house_id,living_id,residential_units_name,user_id,media_type,design_source_type,design_id,share_total,is_open,is_change,
		is_decorated,draft_state,baiMo_state,stuff_finish_state,decorate_finish_state,design_template_id,design_style_id,pic_id,model_id,model_3d_id,model_u3d_id,web_model_u3d_id,ios_model_u3d_id,ipad_model_u3d_id,pc_model_u3d_id,
		android_model_u3d_id,macBookpc_model_u3d_id,config_file_id,space_common_id,designPlan_render_pic_ids,plan_desc,sys_code,creator,gmt_create,modifier,gmt_modified,is_deleted,remark,evening_file_id,dawn_file_id,night_file_id,effects_config,apply_space_areas,space_layout_type,company_id
 
	</sql>
	
	<!-- **结果定义** -->
	<resultMap id="AllResultMap" type="com.nork.design.model.DesignPlanRecommended">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result  column="recommended_type" property="recommendedType" jdbcType="INTEGER" />
		<result  column="plan_id" property="planId" jdbcType="INTEGER" />
		<result  column="plan_code" property="planCode" jdbcType="VARCHAR" />
		<result  column="plan_name" property="planName" jdbcType="VARCHAR" />
		<result column="plan_source" property="planSource" jdbcType="VARCHAR"/>
		<result column="house_id" property="houseId" jdbcType="INTEGER"/>
		<result column="living_id" property="livingId" jdbcType="INTEGER"/>
		<result column="residential_units_name" property="residentialUnitsName" jdbcType="VARCHAR"/>
		<result  column="user_id" property="userId" jdbcType="INTEGER" />
		<result  column="media_type" property="mediaType" jdbcType="INTEGER" />
		<result  column="design_source_type" property="designSourceType" jdbcType="INTEGER" />
		<result  column="design_id" property="designId" jdbcType="INTEGER" />
		<result  column="design_template_id" property="designTemplateId" jdbcType="INTEGER" />
		<result  column="design_style_id" property="designStyleId" jdbcType="INTEGER" />
		<result  column="pic_id" property="picId" jdbcType="INTEGER" />
		<result  column="model_id" property="modelId" jdbcType="INTEGER" />
		<result  column="model_3d_id" property="model3dId" jdbcType="INTEGER" />
		<result  column="model_u3d_id" property="modelU3dId" jdbcType="INTEGER" />
		<result  column="web_model_u3d_id" property="webModelU3dId" jdbcType="INTEGER" />
		<result  column="ios_model_u3d_id" property="iosModelU3dId" jdbcType="INTEGER" />
		<result  column="ipad_model_u3d_id" property="ipadModelU3dId" jdbcType="INTEGER" />
		<result  column="pc_model_u3d_id" property="pcModelU3dId" jdbcType="INTEGER" />
		<result  column="android_model_u3d_id" property="androidModelU3dId" jdbcType="INTEGER" />
		<result  column="macBookpc_model_u3d_id" property="macBookpcModelU3dId" jdbcType="INTEGER" />
		<result  column="config_file_id" property="configFileId" jdbcType="INTEGER" />
		<result  column="space_common_id" property="spaceCommonId" jdbcType="INTEGER" />
		<result  column="designPlan_render_pic_ids" property="designPlanRenderPicIds" jdbcType="VARCHAR" />
		<result  column="space_function_id" property="spaceFunctionId" jdbcType="INTEGER" />
		<result  column="space_areas" property="spaceAreas" jdbcType="VARCHAR" />
		<result  column="plan_desc" property="planDesc" jdbcType="VARCHAR" />
		<result  column="sys_code" property="sysCode" jdbcType="VARCHAR" />
		<result  column="creator" property="creator" jdbcType="VARCHAR" />
		<result  column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
		<result  column="modifier" property="modifier" jdbcType="VARCHAR" />
		<result  column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
		<result  column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
		<result  column="remark" property="remark" jdbcType="VARCHAR" />
		<result  column="share_total" property="shareTotal" jdbcType="INTEGER" />
		<result  column="is_open" property="isOpen" jdbcType="INTEGER" />
		<result  column="is_change" property="isChange" jdbcType="INTEGER" />
		<result  column="is_decorated" property="isDecorated" jdbcType="INTEGER" />
		<result  column="draft_state" property="draftState" jdbcType="INTEGER" />
		<result  column="baiMo_state" property="baiMoState" jdbcType="INTEGER" />
		<result  column="stuff_finish_state" property="stuffFinishState" jdbcType="INTEGER" />
		<result  column="decorate_finish_state" property="decorateFinishState" jdbcType="INTEGER" />
		<result  column="cover_pic_Id" property="coverPicId" jdbcType="INTEGER" />
		<result  column="is_release" property="isRelease" jdbcType="INTEGER" />
		<result  column="release_time" property="releaseTime" jdbcType="TIMESTAMP" />
		<result  column="design_recommended_style_id" property="designRecommendedStyleId" jdbcType="INTEGER" />
 		<result  column="effects_config" property="effectsConfig" jdbcType="VARCHAR" />
 		<result  column="is_recommended" property="isRecommended" jdbcType="INTEGER" />
 		<result  column="is_default_decorate" property="isDefaultDecorate" jdbcType="INTEGER" />
 		<result  column="plan_number" property="planNumber" jdbcType="VARCHAR" />
		<result  column="apply_space_areas" property="applySpaceAreas" jdbcType="VARCHAR" />
		
		<result  column="spelling_flower_file_id" property="spellingFlowerFileId" jdbcType="INTEGER" />
		<result  column="spelling_flower_product" property="spellingFlowerProduct" jdbcType="INTEGER" />
		<result  column="space_layout_type" property="spaceLayoutType" jdbcType="VARCHAR" />
		<result  column="company_id" property="companyId" jdbcType="INTEGER" />
	</resultMap>
	
	<!-- **查询定义** -->
	<!-- 按主键查询 -->
	<select id="selectByPrimaryKey" resultMap="AllResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="All_Column_List" />
		from design_plan_recommended
		where id = #{id,jdbcType=INTEGER}
	</select>
	

	
	<!-- 查询所有，可排序 -->
    <select id="selectList" resultMap="AllResultMap"
		parameterType="com.nork.design.model.DesignPlanRecommended">
		select
		<include refid="All_Column_List" />
		from design_plan_recommended
        where 1=1
        <if test="spellingFlowerProduct!= null">and spelling_flower_product = #{spellingFlowerProduct,jdbcType=VARCHAR} </if>
        <if test="spellingFlowerFileId!= null">and spelling_flower_file_id = #{spellingFlowerFileId,jdbcType=INTEGER}  </if>
        
        <if test="planId!= null">and plan_id = #{planId,jdbcType=INTEGER} </if>
        <if test="recommendedType!= null">and recommended_type = #{recommendedType,jdbcType=INTEGER} </if>
 		<if test="isRecommended!= null">and is_recommended = #{isRecommended,jdbcType=INTEGER}  </if>
		<if test="isDefaultDecorate!= null">and is_default_decorate = #{isDecorate,jdbcType=INTEGER}  </if>
		<if test="planNumber!= null">and plan_number = #{planNumber,jdbcType=VARCHAR}  </if>
        <if test="designRecommendedStyleId!= null">and   design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} </if>
        <if test="releaseTime!= null">and release_time =#{releaseTime,jdbcType=TIMESTAMP}  </if>
        <if test="isRelease!= null"> and is_release = #{isRelease,jdbcType=INTEGER}  </if>
        <if test="coverPicId!= null">and cover_pic_Id = #{coverPicId,jdbcType=INTEGER} </if>
		<if test="id!= null">  and id = #{id,jdbcType=INTEGER} </if>
		<if test="planCode!= null">  and plan_code = #{planCode,jdbcType=VARCHAR} </if>
		<if test="planName!= null">  and plan_name = #{planName,jdbcType=VARCHAR} </if>
		<if test="userId!= null">  and user_id = #{userId,jdbcType=INTEGER} </if>
		<if test="mediaType!= null">  and media_type = #{mediaType,jdbcType=INTEGER} </if>
		<if test="designSourceType!= null">  and design_source_type = #{designSourceType,jdbcType=INTEGER} </if>
		<if test="designId!= null">  and design_id = #{designId,jdbcType=INTEGER} </if>
		<if test="designStyleId!= null">  and design_style_id = #{designStyleId,jdbcType=INTEGER} </if>
		<if test="picId!= null">  and pic_id = #{picId,jdbcType=INTEGER} </if>
		<if test="modelId!= null">  and model_id = #{modelId,jdbcType=INTEGER} </if>
		<if test="model3dId!= null">  and model_3d_id = #{model3dId,jdbcType=INTEGER} </if>
		<if test="modelU3dId!= null">  and model_u3d_id = #{modelU3dId,jdbcType=INTEGER} </if>
		<if test="webModelU3dId!= null">  and web_model_u3d_id = #{webModelU3dId,jdbcType=INTEGER} </if>
		<if test="configFileId!= null">  and config_file_id = #{configFileId,jdbcType=INTEGER} </if>
		<if test="spaceCommonId!= null">  and space_common_id = #{spaceCommonId,jdbcType=INTEGER} </if>
		<if test="designPlanRenderPicIds!= null">  and LOCATE(#{designPlanRenderPicIds,jdbcType=VARCHAR},designPlan_render_pic_ids) > 0, </if>
		<if test="planDesc!= null">  and plan_desc = #{planDesc,jdbcType=VARCHAR} </if>
		<if test="draftState!= null">  and draft_state = #{draftState,jdbcType=INTEGER} </if>
		<if test="baiMoState!= null">  and baiMo_state = #{baiMoState,jdbcType=INTEGER} </if>
		<if test="stuffFinishState!= null">  and stuff_finish_state = #{stuffFinishState,jdbcType=INTEGER} </if>
		<if test="decorateFinishState!= null">  and decorate_finish_state = #{decorateFinishState,jdbcType=INTEGER} </if>
		<if test="sysCode!= null">  and sys_code = #{sysCode,jdbcType=VARCHAR} </if>
		<if test="creator!= null">  and creator = #{creator,jdbcType=VARCHAR} </if>
		<if test="gmtCreate!= null">  and gmt_create = #{gmtCreate,jdbcType=TIMESTAMP} </if>
		<if test="modifier!= null">  and modifier = #{modifier,jdbcType=VARCHAR} </if>
		<if test="gmtModified!= null">  and gmt_modified = #{gmtModified,jdbcType=TIMESTAMP} </if>
		<if test="isDeleted!= null">  and is_deleted = #{isDeleted,jdbcType=INTEGER} </if>
		
		<if test="order != null and  order !=''  ">
			order by ${order}
			<if test="orderNum != null and  orderNum !='' ">
				${orderNum}
			</if>
		</if>
		<if test="orders != null and  orders !=''  ">
		   order by ${orders}
		</if>
	</select>
	
	<!-- 分页汇总 -->
	<select id="selectCount" resultType="int"
		parameterType="com.nork.design.model.DesignPlanRecommended">
		select count(*)
		from design_plan_recommended
		where 1=1
		<if test="spellingFlowerProduct!= null">and spelling_flower_product = #{spellingFlowerProduct,jdbcType=VARCHAR} </if>
        <if test="spellingFlowerFileId!= null">and spelling_flower_file_id = #{spellingFlowerFileId,jdbcType=INTEGER}  </if>
        
		<if test="planId!= null">and plan_id = #{planId,jdbcType=INTEGER} </if>
		<if test="recommendedType!= null">and recommended_type = #{recommendedType,jdbcType=INTEGER} </if>
 		<if test="isRecommended!= null">and is_recommended = #{isRecommended,jdbcType=INTEGER}  </if>
		<if test="isDefaultDecorate!= null">and is_default_decorate = #{isDecorate,jdbcType=INTEGER}  </if>
		<if test="planNumber!= null">and plan_number = #{planNumber,jdbcType=VARCHAR}  </if>
        <if test="designRecommendedStyleId!= null">and   design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} </if>
        <if test="releaseTime!= null">and release_time =#{releaseTime,jdbcType=TIMESTAMP}  </if>
        <if test="isRelease!= null"> and is_release = #{isRelease,jdbcType=INTEGER}  </if>
        <if test="coverPicId!= null">and cover_pic_Id = #{coverPicId,jdbcType=INTEGER} </if>
		<if test="id!= null">  and id = #{id,jdbcType=INTEGER} </if>
		<if test="planCode!= null">  and plan_code = #{planCode,jdbcType=VARCHAR} </if>
		<if test="planName!= null">  and plan_name = #{planName,jdbcType=VARCHAR} </if>
		<if test="userId!= null">  and user_id = #{userId,jdbcType=INTEGER} </if>
		<if test="mediaType!= null">  and media_type = #{mediaType,jdbcType=INTEGER} </if>
		<if test="designSourceType!= null">  and design_source_type = #{designSourceType,jdbcType=INTEGER} </if>
		<if test="designId!= null">  and design_id = #{designId,jdbcType=INTEGER} </if>
		<if test="designStyleId!= null">  and design_style_id = #{designStyleId,jdbcType=INTEGER} </if>
		<if test="picId!= null">  and pic_id = #{picId,jdbcType=INTEGER} </if>
		<if test="modelId!= null">  and model_id = #{modelId,jdbcType=INTEGER} </if>
		<if test="model3dId!= null">  and model_3d_id = #{model3dId,jdbcType=INTEGER} </if>
		<if test="modelU3dId!= null">  and model_u3d_id = #{modelU3dId,jdbcType=INTEGER} </if>
		<if test="webModelU3dId!= null">  and web_model_u3d_id = #{webModelU3dId,jdbcType=INTEGER} </if>
		<if test="configFileId!= null">  and config_file_id = #{configFileId,jdbcType=INTEGER} </if>
		<if test="spaceCommonId!= null">  and space_common_id = #{spaceCommonId,jdbcType=INTEGER} </if>
		<if test="designPlanRenderPicIds!= null">  and LOCATE(#{designPlanRenderPicIds,jdbcType=VARCHAR},designPlan_render_pic_ids) > 0, </if>
		<if test="planDesc!= null">  and plan_desc = #{planDesc,jdbcType=VARCHAR} </if>
		<if test="draftState!= null">  and draft_state = #{draftState,jdbcType=INTEGER} </if>
		<if test="baiMoState!= null">  and baiMo_state = #{baiMoState,jdbcType=INTEGER} </if>
		<if test="stuffFinishState!= null">  and stuff_finish_state = #{stuffFinishState,jdbcType=INTEGER} </if>
		<if test="decorateFinishState!= null">  and decorate_finish_state = #{decorateFinishState,jdbcType=INTEGER} </if>
		<if test="sysCode!= null">  and sys_code = #{sysCode,jdbcType=VARCHAR} </if>
		<if test="creator!= null">  and creator = #{creator,jdbcType=VARCHAR} </if>
		<if test="gmtCreate!= null">  and gmt_create = #{gmtCreate,jdbcType=TIMESTAMP} </if>
		<if test="modifier!= null">  and modifier = #{modifier,jdbcType=VARCHAR} </if>
		<if test="gmtModified!= null">  and gmt_modified = #{gmtModified,jdbcType=TIMESTAMP} </if>
		<if test="isDeleted!= null">  and is_deleted = #{isDeleted,jdbcType=INTEGER} </if>
	</select>
 
 	<!-- 方案推荐总条数 -->
	<select id="getPlanRecommendedCount" resultType="int" parameterType="com.nork.design.model.DesignPlanRecommended">
			select  COUNT(DISTINCT dp.id) 
			from design_plan_recommended AS dp
			<!-- LEFT JOIN 
			(SELECT fid,recommendId,bid from design_plan_recommend_favorite_ref where fid in (SELECT bid from sys_business_favorite where userId =#{userId}) ) AS fr ON(fr.recommendId = dp.id) -->
			LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
			LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
			
			LEFT JOIN (SELECT id,plan_id,is_deleted,brand_id,company_id from design_plan_brand ) AS dpb ON (dp.id = dpb.plan_id)
			
			LEFT JOIN (SELECT id,brand_name from base_brand  where is_deleted = 0 ) AS bb ON (dpb.brand_id = bb.id)
			LEFT JOIN design_templet AS dt ON (dp.design_template_id = dt.id)
			LEFT JOIN (SELECT id,space_function_id,space_areas from space_common 
			<!-- where is_deleted = 0 -->
			) AS sc on(sc.id = dt.space_common_id)
			
			<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> start -->
			<if test="platformId != null">
				left join design_plan_2b_platform dp2p on dp2p.plan_id = dp.id
				and dp2p.is_deleted = 0 and dp2p.allot_state = 1 and dp2p.putaway_state = 1
				and dp2p.platform_id = #{platformId,jdbcType=INTEGER}
			</if>
			<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> end -->
			
			<if test="livingName != null and livingName !='' ">
				LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
				LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
				LEFT JOIN (SELECT id,living_name FROM base_living ) as bl ON (bl.id = bh.living_id)
			</if>
			LEFT JOIN base_product_style AS bps ON (bps.id = dp.design_recommended_style_id)
			LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE dp.is_deleted = 0
				
				<!-- update by huangsongbo 2018.4.14 品牌已非必填 -->
				<!-- AND dpb.is_deleted = 0 -->
				
				<!-- 	如果是审核管理员	 -->
		<if test="checkAdministrator != null and checkAdministrator == 'yes' ">
			<if test="spaceFunctionIds != null and spaceFunctionIds.size() >0">
				AND	sc.space_function_id in 
				<foreach collection="spaceFunctionIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<!-- 	如果不是审核管理员	 -->
		<if test="checkAdministrator == null or checkAdministrator != 'yes'">
			<if test="userType != -1">
				<!-- AND dpb.brand_id in   
				<foreach collection="brandIds" index="index" item="item" open="(" separator="," close=")">
						#{item}
				</foreach> -->
			</if>
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<if test="planNumber!= null and planNumber!= '' ">
			AND	dp.plan_number = #{planNumber,jdbcType=VARCHAR}
		</if>
		<if test="isRelease != null">
			AND dp.is_release =  #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="isReleases != null and isReleases.size() >0">
				AND	dp.is_release in 
				<foreach collection="isReleases" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
		</if>
		<if test="recommendedType != null">
			AND dp.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId!= null">
			AND dp.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
		</if>
		<if test="areaValue!= null and areaValue!='' and displayType!='dragDecorate'">
			<choose>
				<when test=" displayType == 'mobile' ">
					AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
				</when>
				<otherwise>
					AND sc.space_areas = #{areaValue,jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		<if test="areaValue!= null and areaValue!='' and displayType =='dragDecorate'">
			AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
		</if>
		<if test="spaceLayoutType != null and spaceLayoutType != ''">
			AND dp.space_layout_type = #{spaceLayoutType,jdbcType=VARCHAR}
		</if>
		<choose>

			<when test="creator != null and creator != '' and brandName != null and brandName != '' and livingName != null and livingName !='' and planName != null and planName != '' ">

                AND (
                	dp.plan_name like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
                    or su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
                    or bb.brand_name like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
                    or bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
                    or dp.plan_code like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
                )
            </when>
			<otherwise>
				<if test="planName!= null and planName!= '' ">
					AND dp.plan_name like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="creator!= null and creator!= '' ">
					AND su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
				</if>
				<if test="brandName != null and brandName != '' ">
					AND bb.brand_name   like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="livingName != null and livingName !='' ">
					AND bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
				</if>
				<!-- <if test="planName != null and planName !='' ">
					AND dp.plan_name   like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if> -->
			</otherwise>
		</choose>
		<if test="idList != null">
			AND dp.id IN
			<foreach item="item" collection="idList" separator="," open="(" close=")" index="">
				#{item}
			</foreach>
		</if>
		<if test="shelfStatus!= null and shelfStatus!= '' ">
			AND dp.shelf_status like CONCAT(CONCAT('%',#{shelfStatus,jdbcType=VARCHAR}),'%')
		</if>

		<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> start -->
		<if test="platformId != null">
			<if test="displayType != null  and displayType !='dragDecorate'">
				and (dp2p.id is not null
				<!-- 添加逻辑:有平台的或者(没有平台但是是测试方案) update by huangsongbo 2018.4.17 -->
				or dp.is_release = 2)
			</if>
		</if>
		<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> end -->

		<if test="companyId != null">
			<if test="displayType == null  or displayType !='dragDecorate'">
				<!-- and dp.company_id = #{companyId,jdbcType=INTEGER} -->
				and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dp.company_id = #{companyId,jdbcType=INTEGER})
			</if>
		</if>
		
		<if test="userIdFilter != null">
			<if test="displayType == null  or displayType !='dragDecorate'">
				and dp.user_id = #{userIdFilter,jdbcType=INTEGER}
			</if>
		</if>

		<if test="shelfStatusLike != null and shelfStatusLike != ''">
			and concat(",",dp.shelf_status,",") like concat ("%,",#{shelfStatusLike,jdbcType=VARCHAR},",%")
		</if>
		<!-- COMMON-898 开始设计中方案显示变更   chenm 20180516 begin-->
		<if test="displayType != null  and displayType =='dragDecorate'">
		  AND    (
				(dp.is_release = 1 
				<if test="companyId != null">
					AND (dpb.company_id = #{companyId,jdbcType=INTEGER} OR dp.company_id = #{companyId,jdbcType=INTEGER})
				</if>
				<if test="platformId != null">
					AND dp2p.id IS NOT NULL
				</if>
				)
				<if test ="planrecommendedConner != null and planrecommendedConner == 'yes'"> 
				<!-- 如果有查看“测试方案”菜单权限 -->  
				OR (
				dp.is_release = 2 
				<if test="userIdFilter != null">
				   AND dp.user_id =  #{userIdFilter,jdbcType=INTEGER}
				</if>
				)
				</if>
				<if test ="planrecommendedChecker != null and planrecommendedChecker == 'yes'"> 
				  <!-- 如果有查看“审核方案”菜单权限且有审核方案权限 -->
				OR (
				dp.is_release = 3 
				<if test="companyId != null">
					AND (dpb.company_id = #{companyId,jdbcType=INTEGER} OR dp.company_id = #{companyId,jdbcType=INTEGER})
				</if>		
				)
				</if>
			)
		
		</if>
		<!-- COMMON-898 开始设计中方案显示变更   chenm 20180516 end-->
	  	<!-- and dpb.id is not null -->
	</select>
 	
 	<!-- 方案推荐总条数 -->
	<select id="getPlanRecommendedCountMobile" resultType="int" parameterType="com.nork.design.model.DesignPlanRecommended">
	select  COUNT(DISTINCT dp.id) 
			from design_plan_recommended AS dp
			LEFT JOIN 
			(SELECT fid,recommendId,bid from design_plan_recommend_favorite_ref where fid in (SELECT bid from sys_business_favorite where userId =#{userId}) ) AS fr ON(fr.recommendId = dp.id)
			LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
			LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
			LEFT JOIN (SELECT plan_id,is_deleted,brand_id from design_plan_brand ) AS dpb ON (dp.id = dpb.plan_id)
			LEFT JOIN (SELECT id,brand_name from base_brand  where is_deleted = 0 ) AS bb ON (dpb.brand_id = bb.id)
			LEFT JOIN design_templet AS dt ON (dp.design_template_id = dt.id)
			LEFT JOIN (SELECT id,space_function_id,space_areas from space_common where is_deleted = 0) AS sc on(sc.id = dt.space_common_id)
			<if test="livingName != null and livingName !='' ">
				LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
				LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
				LEFT JOIN (SELECT id,living_name FROM base_living ) as bl ON (bl.id = bh.living_id)
			</if>
			LEFT JOIN base_product_style AS bps ON (bps.id = dp.design_recommended_style_id)
			LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE
				dp.is_deleted = 0
				AND dpb.is_deleted = 0
				<!-- 	如果是审核管理员	 -->
		<if test="checkAdministrator != null and checkAdministrator == 'yes' ">
			<if test="spaceFunctionIds != null and spaceFunctionIds.size() >0">
				AND	sc.space_function_id in 
				<foreach collection="spaceFunctionIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
		</if>
		<!-- 	如果不是审核管理员	 -->
		<if test="checkAdministrator == null or checkAdministrator != 'yes' ">
			<!-- AND dpb.brand_id in   
			<foreach collection="brandIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
			</foreach> -->
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<if test="planNumber!= null and planNumber!= '' ">
			AND	dp.plan_number = #{planNumber,jdbcType=VARCHAR}
		</if>
		<if test="isRelease != null">
			AND dp.is_release =  #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="isReleases != null and isReleases.size() >0">
				AND	dp.is_release in 
				<foreach collection="isReleases" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
		</if>
		<if test="recommendedType != null">
			AND dp.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId!= null">
			AND dp.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
		</if>
		<!--<if test="areaValue!= null and areaValue!='' ">
			AND sc.space_areas = #{areaValue,jdbcType=VARCHAR} 
		</if>-->
		<if test="areaValue!= null and areaValue!='' ">
			AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
		</if>
		<choose>

			<when test="creator != null and creator != '' and brandName != null and brandName != '' and livingName != null and livingName !=''  and planName != null and planName != '' ">

                AND (
                    su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
                    or bb.brand_name like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
                    or bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
                    or dp.plan_name like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
                )
            </when>
			<otherwise>
				<if test="planName != null and planName !='' ">
					AND su.planName like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="creator!= null and creator!= '' ">
					AND su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
				</if>
				<if test="brandName != null and brandName != '' ">
					AND bb.brand_name   like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="livingName != null and livingName !='' ">
					AND bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="planName != null and planName !='' ">
					AND dp.plan_name   like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if>
			</otherwise>
		</choose>
		
	</select>
 	<!--  方案推荐数据 -->
 	<select id="getPlanRecommendedList" resultMap="planRecommendedResultMap" parameterType="com.nork.design.model.DesignPlanRecommended">
			
			<if test="designRecommendedStyleIdTop!= null and designRecommendedStyleIdTop!= 0 ">
				SELECT * FROM (
			</if>
						SELECT DISTINCT
				dp.id AS planRecommendedId,
				dp.plan_id,
				rrp.pic_path AS cover_path,
				dp.plan_name,
				dp.is_release,
				dp.gmt_modified,
				dp.gmt_create,
				su.user_name AS 'creator',
				sc.space_areas,
				bps. NAME AS 'style_name',
				sc.space_function_id,
				dp.release_time,
				dp.living_id,
				dp.house_id,
				dp.remark,
				dp.plan_source,
				dp.is_default_decorate,
				dp.apply_space_areas,
				sd. NAME AS houseTypeName,
			    fr.bid,
			    dp.design_recommended_style_id,
			    scs.space_code AS space_code,
				CASE WHEN dp.id is null THEN 1
				<if test="areaValue!= null and areaValue!='' ">
					WHEN sc.space_areas+0 &gt;  #{areaValue,jdbcType=VARCHAR} THEN (sc.space_areas+0 - #{areaValue,jdbcType=VARCHAR})
				</if>
				ELSE 2 END AS sort_type,
				dp.recommended_type
			from design_plan_recommended AS dp
			LEFT JOIN 
			(SELECT fid,recommendId,bid from design_plan_recommend_favorite_ref where fid in (SELECT bid from sys_business_favorite where userId =#{userId}) ) AS fr ON(fr.recommendId = dp.id)
			LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
			LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
			
			LEFT JOIN (SELECT id,plan_id,is_deleted,brand_id,company_id from design_plan_brand ) AS dpb ON (dp.id = dpb.plan_id)
			
			LEFT JOIN (SELECT id,brand_name from base_brand  where is_deleted = 0 ) AS bb ON (dpb.brand_id = bb.id)
			LEFT JOIN design_templet AS dt ON (dp.design_template_id = dt.id)
			LEFT JOIN (SELECT id,space_function_id,space_areas from space_common 
			<!-- where is_deleted = 0 -->
			) AS sc on(sc.id = dt.space_common_id)
			LEFT JOIN space_common scs ON dp.space_Common_Id =scs.id AND scs.is_deleted =0
			
			<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> start -->
			<if test="platformId != null">
				left join design_plan_2b_platform dp2p on dp2p.plan_id = dp.id
				and dp2p.is_deleted = 0 and dp2p.allot_state = 1 and dp2p.putaway_state = 1
				and dp2p.platform_id = #{platformId,jdbcType=INTEGER}
			</if>
			<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> end -->
			
			<if test="livingName != null and livingName !='' ">
				LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
				LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
				LEFT JOIN (SELECT id,living_name FROM base_living ) as bl ON (bl.id = bh.living_id)
			</if>
			LEFT JOIN base_product_style AS bps ON (bps.id = dp.design_recommended_style_id)
			LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE
				dp.is_deleted = 0
				
				<!-- update by huangsongbo 2018.4.14 品牌已非必填 -->
				<!-- AND dpb.is_deleted = 0 -->

		<!-- 	如果是审核管理员	 -->
		<if test="checkAdministrator != null and checkAdministrator == 'yes' ">
			<if test="spaceFunctionIds != null and spaceFunctionIds.size() >0">
				AND	sc.space_function_id in 
				<foreach collection="spaceFunctionIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<!-- 	如果不是审核管理员	 -->
		<if test="checkAdministrator == null or checkAdministrator != 'yes'">
			<if test="userType != -1">
				<!-- AND dpb.brand_id in   
				<foreach collection="brandIds" index="index" item="item" open="(" separator="," close=")">
						#{item}
				</foreach> -->
			</if>
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<if test="planNumber!= null and planNumber!= '' ">
			AND	dp.plan_number = #{planNumber,jdbcType=VARCHAR}
		</if>
		<if test="isRelease != null">
			AND dp.is_release =  #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="isReleases != null and isReleases.size() >0">
				AND	dp.is_release in 
				<foreach collection="isReleases" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
		</if>
		<if test="recommendedType != null">
			AND dp.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId!= null">
			AND dp.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
		</if>
		<if test="areaValue!= null and areaValue!='' and displayType!='dragDecorate'">
			<choose>
				<when test=" displayType == 'mobile' ">
					AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
				</when>
				<otherwise>
					AND sc.space_areas = #{areaValue,jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		<if test="areaValue!= null and areaValue!='' and displayType =='dragDecorate'">
			AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
		</if>
		<if test="spaceLayoutType != null and spaceLayoutType != ''">
			AND dp.space_layout_type = #{spaceLayoutType,jdbcType=VARCHAR}
		</if>
		<choose>

			<when test="creator != null and creator != '' and brandName != null and brandName != '' and livingName != null and livingName !='' and planName != null and planName != '' ">
                AND (
                	dp.plan_name like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
                    or su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
                    or bb.brand_name like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
                    or bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
                    or dp.plan_code like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
                )
            </when>
			<otherwise>
				<if test="planName!= null and planName!= '' ">
					AND dp.plan_name like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="creator!= null and creator!= '' ">
					AND su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
				</if>
				<if test="brandName != null and brandName != '' ">
					AND bb.brand_name   like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="livingName != null and livingName !='' ">
					AND bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
				</if>
				<!-- <if test="planName != null and planName !='' ">
					AND dp.plan_name   like CONCAT(CONCAT('%',#{planName,jdbcType=VARCHAR}),'%')
				</if> -->
			</otherwise>
		</choose>
		<if test="idList != null">
			AND dp.id IN
			<foreach item="item" collection="idList" separator="," open="(" close=")" index="">
				#{item}
			</foreach>
		</if>
		<if test="shelfStatus!= null and shelfStatus!= '' ">
			<if test="displayType == null  or displayType !='dragDecorate'">
				AND dp.shelf_status like CONCAT(CONCAT('%',#{shelfStatus,jdbcType=VARCHAR}),'%')
			</if>
		</if>
		
		<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> start -->
		<if test="platformId != null">
			<if test="displayType != null  and displayType !='dragDecorate'">
				and (dp2p.id is not null
				<!-- 添加逻辑:有平台的或者(没有平台但是是测试方案) update by huangsongbo 2018.4.17 -->
				or dp.is_release = 2)
			</if>
		</if>
		<!-- 添加平台过滤查询条件,update by huangsongbo 2018.4.14 -> end -->

		<if test="companyId != null">
			<if test="displayType == null  or displayType !='dragDecorate'">
				<!-- and dp.company_id = #{companyId,jdbcType=INTEGER} -->
				and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dp.company_id = #{companyId,jdbcType=INTEGER})
			</if>
		</if>

		<!--xiaoxc_20180418注释，说明：推荐方案本是设计师制作，无需用户与之关联查询-->
		<if test="userIdFilter != null">
			<if test="displayType == null  or displayType !='dragDecorate'">
				and dp.user_id = #{userIdFilter,jdbcType=INTEGER}
			</if>
		</if>
		
		<if test="shelfStatusLike != null and shelfStatusLike != ''">
			  <if test="displayType == null  or displayType !='dragDecorate'">
				and concat(",",dp.shelf_status,",") like concat ("%,",#{shelfStatusLike,jdbcType=VARCHAR},",%")
		 	</if>
		</if>
		<!-- COMMON-898 开始设计中方案显示变更   chenm 20180516 begin-->
		<if test="displayType != null  and displayType =='dragDecorate'">
		  AND    (
				(dp.is_release = 1 
				<if test="companyId != null">
					and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dp.company_id = #{companyId,jdbcType=INTEGER})
				</if>
				<if test="platformId != null">
					AND dp2p.id IS NOT NULL
				</if>
				)
				<if test ="planrecommendedConner != null and planrecommendedConner == 'yes'"> 
				<!-- 如果有查看“测试方案”菜单权限 -->  
				OR (
				dp.is_release = 2 
				<if test="userIdFilter != null">
				   AND dp.user_id =  #{userIdFilter,jdbcType=INTEGER}  
				</if>
				)
				</if>
				<if test ="planrecommendedChecker != null and planrecommendedChecker == 'yes'"> 
				  <!-- 如果有查看“审核方案”菜单权限且有审核方案权限 -->
				OR (
				dp.is_release = 3 
				<if test="companyId != null">
					AND (dpb.company_id = #{companyId,jdbcType=INTEGER} OR dp.company_id = #{companyId,jdbcType=INTEGER})
				</if>	
				)
				</if>
			)
		
		</if>
		<!-- COMMON-898 开始设计中方案显示变更   chenm 20180516 end-->
		<!-- and dpb.id is not null -->
		<if test="designRecommendedStyleIdTop== null or designRecommendedStyleIdTop == 0 ">
			ORDER BY
			<if test="displayType != null  and displayType =='dragDecorate'">
			<!-- 开始设计 菜单项下推荐方案 按发布状态逆序排序 -->
			    dp.is_release DESC,
			</if>
			<choose>
				<when test="areaValue!= null and areaValue!=''">
					sort_type ASC ,sc.space_areas+0 DESC ,dp.release_time DESC
				</when>
				<otherwise>
					dp.release_time DESC
				</otherwise>
			</choose>
		</if>

		<if test="designRecommendedStyleIdTop!= null and designRecommendedStyleIdTop!= 0 ">
				) as dpTop order by  case when (dpTop.design_recommended_style_id = #{designRecommendedStyleIdTop} )  
				then 0 else 1 end , dpTop.design_recommended_style_id desc
		</if>
		
		<if test="start !=-1 and limit !=-1"> LIMIT #{start}, #{limit}</if>
 	</select>
 	
	 <!--  方案推荐数据 -->
 	<select id="getPlanRecommendedListMobile" resultMap="planRecommendedResultMap" parameterType="com.nork.design.model.DesignPlanRecommended">
									SELECT DISTINCT
				dp.id AS planRecommendedId,
				dp.plan_id,
				rrp.pic_path AS cover_path,
				dp.plan_name,
				dp.is_release,
				dp.gmt_modified,
				dp.gmt_create,
				su.user_name AS 'creator',
				sc.space_areas,
				bps. NAME AS 'style_name',
				sc.space_function_id,
				dp.release_time,
				dp.living_id,
				dp.house_id,
				dp.remark,
				dp.plan_source,
				dp.is_default_decorate,
				dp.apply_space_areas,
				sd. NAME AS houseTypeName,
			    fr.bid,
				CASE WHEN dp.id is null THEN 1
				<if test="areaValue!= null and areaValue!='' ">
					WHEN sc.space_areas &gt;  #{areaValue,jdbcType=VARCHAR} THEN (sc.space_areas - #{areaValue,jdbcType=VARCHAR})
				</if>
				ELSE 2 END AS sort_type
			from design_plan_recommended AS dp
			LEFT JOIN 
			(SELECT fid,recommendId,bid from design_plan_recommend_favorite_ref where fid in (SELECT bid from sys_business_favorite where userId =#{userId}) ) AS fr ON(fr.recommendId = dp.id)
			LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
			LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
			LEFT JOIN (SELECT plan_id,is_deleted,brand_id from design_plan_brand ) AS dpb ON (dp.id = dpb.plan_id)
			LEFT JOIN (SELECT id,brand_name from base_brand  where is_deleted = 0 ) AS bb ON (dpb.brand_id = bb.id)
			LEFT JOIN design_templet AS dt ON (dp.design_template_id = dt.id)
			LEFT JOIN (SELECT id,space_function_id,space_areas from space_common where is_deleted = 0) AS sc on(sc.id = dt.space_common_id)
			<if test="livingName != null and livingName !='' ">
				LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
				LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
				LEFT JOIN (SELECT id,living_name FROM base_living ) as bl ON (bl.id = bh.living_id)
			</if>
			LEFT JOIN base_product_style AS bps ON (bps.id = dp.design_recommended_style_id)
			LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE
				dp.is_deleted = 0
				AND dpb.is_deleted = 0

		<!-- 	如果是审核管理员	 -->
		<if test="checkAdministrator != null and checkAdministrator == 'yes' ">
			<if test="spaceFunctionIds != null and spaceFunctionIds.size() >0">
				AND	sc.space_function_id in 
				<foreach collection="spaceFunctionIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
			</if>
		</if>
		<!-- 	如果不是审核管理员	 -->
		<if test="checkAdministrator == null or checkAdministrator != 'yes' ">
			<!-- AND dpb.brand_id in   
			<foreach collection="brandIds" index="index" item="item" open="(" separator="," close=")">
					#{item}
			</foreach> -->
			<if test="spaceFunctionId!= null">
				AND	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
			</if>
		</if>
		<if test="planNumber!= null and planNumber!= '' ">
			AND	dp.plan_number = #{planNumber,jdbcType=VARCHAR}
		</if>
		<if test="isRelease != null">
			AND dp.is_release =  #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="isReleases != null and isReleases.size() >0">
				AND	dp.is_release in 
				<foreach collection="isReleases" index="index" item="item" open="(" separator="," close=")">
					#{item}
				</foreach>
		</if>
		<if test="recommendedType != null">
			AND dp.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId!= null">
			AND dp.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
		</if>
		<!--<if test="areaValue!= null and areaValue!='' ">
			AND sc.space_areas = #{areaValue,jdbcType=VARCHAR}
		</if>-->
		<if test="areaValue!= null and areaValue!='' ">
			AND (FIND_IN_SET(#{areaValue,jdbcType=VARCHAR},dp.apply_space_areas) or dp.apply_space_areas = '')
		</if>
		<choose>
			<when test="creator != null and creator != '' and brandName != null and brandName != '' and livingName != null and livingName !='' ">
                AND (
                    su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
                    or bb.brand_name like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
                    or bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
                )
            </when>
			<otherwise>
				<if test="creator!= null and creator!= '' ">
					AND su.user_name like CONCAT(CONCAT('%',#{creator,jdbcType=VARCHAR}),'%')
				</if>
				<if test="brandName != null and brandName != '' ">
					AND bb.brand_name   like CONCAT(CONCAT('%',#{brandName,jdbcType=VARCHAR}),'%')
				</if>
				<if test="livingName != null and livingName !='' ">
					AND bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
				</if>
			</otherwise>
		</choose>
			ORDER BY
		<choose>
			<when test="areaValue!= null and areaValue!=''">
				sort_type ASC ,sc.space_areas DESC ,dp.release_time DESC
			</when>
			<otherwise>
				dp.release_time DESC
			</otherwise>
		</choose>
		
		
 	</select>
	 	<resultMap id="planRecommendedResultMap" type="com.nork.design.model.DesignPlanRecommendedResult">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result  column="planRecommendedId" property="planRecommendedId" jdbcType="INTEGER" />
		<result  column="design_template_id" property="designTemplateId" jdbcType="INTEGER" />
		<result  column="plan_id" property="planId" jdbcType="INTEGER" />
		<result  column="plan_name" property="planName" jdbcType="VARCHAR" />
		<result  column="cover_path" property="coverPath" jdbcType="VARCHAR" />
		<result  column="is_release" property="isRelease" jdbcType="INTEGER" /> 
		<result  column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" /> 
		<result  column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" /> 
		<result  column="creator" property="creator" jdbcType="VARCHAR" /> 
		<result  column="space_areas" property="spaceAreas" jdbcType="VARCHAR" /> 
		<result  column="style_name" property="styleName" jdbcType="VARCHAR" /> 
		<result  column="release_time" property="releaseTime" jdbcType="TIMESTAMP" /> 
		<result  column="space_function_id" property="spaceFunctionId" jdbcType="INTEGER" /> 
		<result  column="living_id" property="livingId" jdbcType="INTEGER" /> 
		<result  column="house_id" property="houseId" jdbcType="INTEGER" /> 
		<result  column="remark" property="remark" jdbcType="VARCHAR" /> 
		<result  column="plan_source" property="planSource" jdbcType="VARCHAR" /> 
 		<result  column="is_default_decorate" property="isDefaultDecorate" jdbcType="INTEGER" /> 
 		<result  column="bid" property="bid" jdbcType="VARCHAR" /> 
 		<result  column="favoriteName" property="favoriteName" jdbcType="VARCHAR" />
		<result  column="apply_space_areas" property="applySpaceAreas" jdbcType="VARCHAR" />
		<result  column="space_code" property="spaceCode" jdbcType="VARCHAR" />
		<result  column="plan_recommended_id" property="planRecommendedId" jdbcType="INTEGER" />
		<result  column="recommended_type" property="recommendedType" jdbcType="INTEGER" />
	</resultMap>
	 <select id="getStatusByIds"   resultType="com.nork.design.model.DesignPlanRecommended">
	 	SELECT plan_id planId,recommended_type recommendedType,is_release isRelease FROM design_plan_recommended where plan_id IN
	 	<foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
 			#{item}  
		</foreach> AND is_deleted=0
	 </select>
	 
	 
	 <!-- 获取该方案推荐的白膜产品的数量，如果大于0那么是m+3 未装修完成的推荐（m+3 是不装修直接渲染的快捷键） -->
     <select id="recommendedDecorateState" resultType="int" parameterType="java.lang.Integer">
	     SELECT count(*) from design_plan_recommended_product  as a 
	     LEFT JOIN  base_product as b on(a.product_id=b.id) where a.plan_recommended_id = #{id}  
	     and a.is_deleted = 0 
	     and b.product_code like  'baimo%'
	     
     </select>
     
     
     <select id="getFavoritePlanRecommendedList" resultMap="planRecommendedResultMap" parameterType="com.nork.design.model.DesignPlanRecommended">
		 SELECT DISTINCT
					dp.id as planRecommendedId,
					dp.plan_id,
					rrp.pic_path AS cover_path,
					dp.plan_name,
					dp.is_release,
					dp.gmt_modified,
					dp.gmt_create,
					su.user_name AS 'creator',
					sc.space_areas,
					bps. NAME AS 'style_name',
					sc.space_function_id,
					dp.release_time,
					dp.living_id,
					dp.house_id,
					dp.remark,
					dp.plan_source,
					dp.is_default_decorate,
					sd.name as houseTypeName,
					fr.bid,
					fr.name as 'favoriteName'
				FROM  (select dprfr.id,dprfr.bid,sbf.name,dprfr.recommendId from design_plan_recommend_favorite_ref as dprfr
				LEFT JOIN	sys_business_favorite as sbf on(dprfr.fid = sbf.bid) where sbf.userId = #{userId} 
				<if test="favoriteBid!= null and favoriteBid!='' ">
					AND dprfr.fid = #{favoriteBid,jdbcType=VARCHAR}
				</if>
				) AS fr
				LEFT JOIN	(SELECT * from design_plan_recommended where is_deleted = 0  
				<if test="isInternalUser!= null and isInternalUser == 'yes' ">
					AND	is_release in (1,2)
				</if>
				<if test="isInternalUser == null or isInternalUser != 'yes' ">
					AND	is_release = 1
				</if>
				<if test="designRecommendedStyleId!= null">
					AND design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
				</if>
				) AS dp on(fr.recommendId = dp.id)
				LEFT JOIN (SELECT plan_id,brand_id from design_plan_brand where is_deleted = 0 )AS dpb ON (dp.id = dpb.plan_id)
				LEFT JOIN base_brand AS bb ON (dpb.brand_id = bb.id) 
				LEFT JOIN design_templet AS dt ON ( dp.design_template_id = dt.id )
				LEFT JOIN space_common AS sc ON (sc.id = dt.space_common_id)
				<if test="livingName != null and livingName !='' ">
					LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
					LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
					LEFT JOIN (SELECT id FROM base_living ) as bl ON (bl.id = bh.living_id)
				</if>
				LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
				LEFT JOIN base_product_style AS bps ON ( bps.id = dp.design_recommended_style_id )
				LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
				LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE 1=1
		<if test="spaceFunctionId!= null">
			and	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
		</if>
		<if test="livingName!= null and livingName!='' ">
			and bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
		</if>
		<if test="areaValue!= null and areaValue!='' ">
			and sc.space_areas = #{areaValue,jdbcType=VARCHAR} 
		</if>
		order by fr.id desc
		<if test="start !=-1 and limit !=-1"> LIMIT #{start}, #{limit}</if>
     </select>
     
     
     
     
     
     <select id="getFavoritePlanRecommendedCount" resultType="int" parameterType="com.nork.design.model.DesignPlanRecommended">
	     SELECT DISTINCT
				count(DISTINCT fr.id)
				FROM  (select dprfr.id,dprfr.bid,sbf.name,dprfr.recommendId from design_plan_recommend_favorite_ref as dprfr
				LEFT JOIN	sys_business_favorite as sbf on(dprfr.fid = sbf.bid) where sbf.userId = #{userId} 
				<if test="favoriteBid!= null and favoriteBid!='' ">
					AND dprfr.fid = #{favoriteBid,jdbcType=VARCHAR}
				</if>
				) AS fr
				LEFT JOIN	(SELECT * from design_plan_recommended where is_deleted = 0  
				<if test="isInternalUser!= null and isInternalUser == 'yes' ">
					AND	is_release in (1,2)
				</if>
				<if test="isInternalUser == null or isInternalUser != 'yes' ">
					AND	is_release = 1
				</if>
				<if test="designRecommendedStyleId!= null">
					AND design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} 
				</if>
				) AS dp on(fr.recommendId = dp.id)
				LEFT JOIN (SELECT plan_id,brand_id from design_plan_brand where is_deleted = 0 )AS dpb ON (dp.id = dpb.plan_id)
				LEFT JOIN base_brand AS bb ON (dpb.brand_id = bb.id) 
				LEFT JOIN design_templet AS dt ON ( dp.design_template_id = dt.id )
				LEFT JOIN space_common AS sc ON (sc.id = dt.space_common_id)
				<if test="livingName != null and livingName !='' ">
					LEFT JOIN (SELECT standard_space_id,house_id from house_space where is_deleted = 0)as hs ON (hs.standard_space_id = sc.id)
					LEFT JOIN (SELECT id,living_id from base_house where is_deleted = 0) AS bh ON (hs.house_id = bh.id)
					LEFT JOIN (SELECT id FROM base_living ) as bl ON (bl.id = bh.living_id)
				</if>
				LEFT JOIN (SELECT id,pic_path from res_render_pic where is_deleted = 0 and plan_recommended_id is not null)  AS rrp ON (dp.cover_pic_id = rrp.id)
				LEFT JOIN base_product_style AS bps ON ( bps.id = dp.design_recommended_style_id )
				LEFT JOIN (SELECT id,user_name from sys_user where is_deleted = 0) AS su ON (dp.user_id = su.id)
				LEFT JOIN (SELECT NAME,VALUE FROM sys_dictionary WHERE is_deleted = 0 AND type = 'houseType' ) AS sd ON (sc.space_function_id = sd.VALUE)
				WHERE 1=1

		<if test="spaceFunctionId!= null">
			and	sc.space_function_id = #{spaceFunctionId,jdbcType=INTEGER}
		</if>
		<if test="livingName!= null and livingName!='' ">
			and bl.living_name   like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
		</if>
		<if test="areaValue!= null and areaValue!='' ">
			and sc.space_areas = #{areaValue,jdbcType=VARCHAR} 
		</if>
     
     </select>

	<select id="findRecommendedPlanIdListBySpaceFunctionId" resultType="java.lang.Integer">
		select dpr.id from design_plan_recommended dpr
		left join space_common sc on sc.id = dpr.space_common_id and sc.is_deleted = 0
		where sc.`space_function_id` = #{spaceFunctionId,jdbcType=INTEGER} and dpr.`is_deleted` = 0
	</select>

	<select id="findListBySceneId" resultType="java.lang.String">
		SELECT sd2.valuekey FROM design_plan_product_render_scene d
		LEFT JOIN base_product b ON b.id = d.product_id AND b.`is_deleted` = 0
		LEFT JOIN sys_dictionary sd1 ON sd1.type = 'productType' AND sd1.value = b.`product_type_value` AND sd1.is_deleted = 0
		LEFT JOIN sys_dictionary sd2 ON sd1.valuekey = sd2.type AND sd2.value = b.`product_small_type_value` AND sd2.is_deleted = 0
		WHERE d.plan_id = #{designPlanRenderSceneId,jdbcType=INTEGER} AND d.is_deleted = 0
	</select>

	<!-- getPlanRecommendedListSize -->
	<select id="getPlanRecommendedListSizeByDTO" resultType="int" parameterType="com.nork.design.model.input.PlanRecommendedListForFranchiserDTO">
		select count(distinct(dpr.id)) from design_plan_recommended dpr
		left join design_plan_2b_platform dp2p on dp2p.plan_id = dpr.id 
		and dp2p.is_deleted = 0 and dp2p.allot_state = 1 and dp2p.putaway_state = 1
		<if test="platformId != null">
			and dp2p.platform_id = #{platformId,jdbcType=INTEGER}
		</if>
		<if test="houseType != null or (areaValue != null and areaValue != '')">
			left join space_common sc on sc.id = dpr.space_common_id
		</if>
		<if test="companyId != null">
			left join design_plan_brand dpb on dpb.plan_id = dpr.id
		</if>
		where 1 = 1 and dpr.is_deleted = 0
		and dpr.is_deleted = 0
		<if test="platformId != null">
			and dp2p.id is not null
		</if>
		<if test="shelfStatus != null and shelfStatus != ''">
			and concat(",",dpr.shelf_status,",") like 
			concat ("%,",#{shelfStatus,jdbcType=VARCHAR},",%")
		</if>
		<if test="planName != null and planName != ''">
			and dpr.plan_name like concat ("%",#{planName,jdbcType=VARCHAR},"%")
		</if>
		<if test="houseType != null">
			and sc.space_function_id = #{houseType,jdbcType=INTEGER}
		</if>
		<if test="areaValue != null and areaValue != ''">
			and sc.space_areas = #{areaValue,jdbcType=VARCHAR}
		</if>
		<if test="designRecommendedStyleId != null">
			and dpr.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}
		</if>
		<if test="isRelease != null">
			and dpr.is_release = #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="recommendedType != null">
			and dpr.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="companyId != null">
			<!-- and company_id = #{companyId,jdbcType=INTEGER} -->
			and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dpr.company_id = #{companyId,jdbcType=INTEGER})
		</if>
	</select>

	<!-- getPlanRecommendedList -->
	<select id="getPlanRecommendedListByDTO" resultMap="planRecommendedResultMap" parameterType="com.nork.design.model.input.PlanRecommendedListForFranchiserDTO">
		select 
		distinct(dpr.id) as plan_recommended_id,
		dpr.plan_id,
		dpr.plan_name,
		rrp.pic_path as cover_path,
		dpr.is_release,
		dpr.gmt_modified,
		dpr.gmt_create,
		sc.space_areas,
		bps.name as style_name,
		su.user_name as creator,
		sd.name as house_type_name,
		sc.space_function_id,
		dpr.release_time,
		dpr.living_id,
		dpr.house_id,
		dpr.remark,
		dpr.plan_source,
		dpr.is_default_decorate,
		sc.space_code,
		case
		
		<!-- when dprfr.bid is null then 0 -->
		when dprfrT.bid is null then 0
		
		<!-- else dprfr.bid end as bid -->
		else dprfrT.bid end as bid
		
		<!-- "resRenderPicPath": null,
		"favoriteName": null,
		"applySpaceAreas": "15,20,25,30,35,40,45,47",
		"applySpaceAreasList": [], -->
		from design_plan_recommended dpr
		left join design_plan_2b_platform dp2p on dp2p.plan_id = dpr.id
		and dp2p.is_deleted = 0 and dp2p.allot_state = 1 and dp2p.putaway_state = 1
		<if test="platformId != null">
			and dp2p.platform_id = #{platformId,jdbcType=INTEGER}
		</if>
		left join res_render_pic rrp on rrp.id = dpr.cover_pic_Id
		left join space_common sc on sc.id = dpr.space_common_id
		left join base_product_style bps on bps.id = dpr.design_recommended_style_id
		left join sys_user su on su.id = dpr.user_id
		left join sys_dictionary sd on sd.type = "houseType" and sd.value = sc.space_function_id
		<!-- left join sys_business_favorite sbf on sbf.userId = #{userId,jdbcType=INTEGER}
		left join design_plan_recommend_favorite_ref dprfr on dprfr.fid = sbf.bid and dprfr.recommendId = dpr.id -->
		
		left join (
		select dprfr.recommendId,dprfr.bid from sys_business_favorite sbf 
		left join design_plan_recommend_favorite_ref dprfr on dprfr.fid = sbf.bid
		where sbf.userId = #{userId,jdbcType=INTEGER} and dprfr.id is not null
		) dprfrT on dprfrT.recommendId = dpr.id
		
		<if test="companyId != null">
			left join design_plan_brand dpb on dpb.plan_id = dpr.id
		</if>
		where 1 = 1 and dpr.is_deleted = 0
		and dpr.is_deleted = 0
		<if test="platformId != null">
			and dp2p.id is not null
		</if>
		<if test="shelfStatus != null and shelfStatus != ''">
			and concat(",",dpr.shelf_status,",") like 
			concat ("%,",#{shelfStatus,jdbcType=VARCHAR},",%")
		</if>
		<if test="planName != null and planName != ''">
			and dpr.plan_name like concat ("%",#{planName,jdbcType=VARCHAR},"%")
		</if>
		<if test="houseType != null">
			and sc.space_function_id = #{houseType,jdbcType=INTEGER}
		</if>
		<if test="areaValue != null and areaValue != ''">
			and sc.space_areas = #{areaValue,jdbcType=VARCHAR}
		</if>
		<if test="designRecommendedStyleId != null">
			and dpr.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}
		</if>
		<if test="isRelease != null">
			and dpr.is_release = #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="recommendedType != null">
			and dpr.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<if test="companyId != null">
			<!-- and company_id = #{companyId,jdbcType=INTEGER} -->
			and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dpr.company_id = #{companyId,jdbcType=INTEGER})
		</if>
		
		order by
		dpr.release_time desc
		
		<if test="start != null and limit != null">
			limit #{start,jdbcType=INTEGER},#{limit,jdbcType=INTEGER}
		</if>
	</select>

	<!-- getFranchiserPlanListSizeByDTO -->
	<select id="getFranchiserPlanListSizeByDTO" parameterType="com.nork.design.model.input.FranchiserPlanListDTO" resultType="int">
		select count(distinct(dpr.id)) from 
		design_plan_recommended dpr
		<if test="platformTypeList != null and platformTypeList.size > 0">
			<if test="platformTypeList.indexOf('2b') != -1">
				<!-- left join design_plan_2b_platform dp2bp on dp2bp.plan_id = dpr.id and dp2bp.platform_id = #{platformId,jdbcType=INTEGER}
				and dp2bp.is_deleted = 0 and dp2bp.allot_state = 1 and dp2bp.putaway_state = 1 -->
				left join design_plan_2b_platform dp2bp on dp2bp.plan_id = dpr.id 
				and dp2bp.is_deleted = 0 and dp2bp.allot_state = 1 
			</if>
			<if test="platformTypeList.indexOf('2c') != -1">
				<!-- left join design_plan_2c_platform dp2cp on dp2cp.plan_id = dpr.id and dp2cp.platform_id = #{platformId,jdbcType=INTEGER}
				and dp2cp.is_deleted = 0 and dp2cp.allot_state = 1 and dp2cp.putaway_state = 1 -->
				left join design_plan_2c_platform dp2cp on dp2cp.plan_id = dpr.id 
				and dp2cp.is_deleted = 0 and dp2cp.allot_state = 1 
			</if>
		</if>
		<if test="houseType != null">
			left join space_common sc on sc.id = dpr.space_common_id
		</if>
		<if test="companyId != null">
			left join design_plan_brand dpb on dpb.plan_id = dpr.id
		</if>
		where 
		1 = 1
		and dpr.is_deleted = 0
		<if test="companyId != null">
			<!-- and dpr.company_id = #{companyId,jdbcType=INTEGER} -->
			and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dpr.company_id = #{companyId,jdbcType=INTEGER})
		</if>
		<if test="planSource != null and planSource != ''">
			<choose>
				<when test="planSource == 'diy'">
					and (dpr.plan_source = #{planSource,jdbcType=VARCHAR} or dpr.plan_source is null or dpr.plan_source = "" or dpr.plan_source = "huxing")
				</when>
				<otherwise>
					and dpr.plan_source = #{planSource,jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		<if test="baseCompanyIdList != null and baseCompanyIdList.size > 0">
			and dpr.company_id in
			<foreach collection="baseCompanyIdList" item="baseCompanyIdListItem" separator="," open="(" close=")">
				#{baseCompanyIdListItem,jdbcType=INTEGER}
			</foreach>
		</if>
		<if test="planName != null and planName != ''">
			and dpr.plan_name like concat ("%",#{planName,jdbcType=VARCHAR},"%")
		</if>
		<if test="houseType != null">
			and sc.space_function_id = #{houseType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId != null">
			and dpr.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}
		</if>
		<if test="shelfStatusLike != null and shelfStatusLike != ''">
			<!-- and dpr.shelf_status like concat ("%",#{shelfStatusLike,jdbcType=VARCHAR},"%") -->
			and concat(",",dpr.shelf_status,",") like concat ("%,",#{shelfStatusLike,jdbcType=VARCHAR},",%")
		</if>
		<if test="shelfStatusNotLike != null and shelfStatusNotLike != ''">
			<!-- and dpr.shelf_status not like concat ("%",#{shelfStatusNotLike,jdbcType=VARCHAR},"%") -->
			and concat(",",dpr.shelf_status,",") not like concat ("%,",#{shelfStatusNotLike,jdbcType=VARCHAR},",%")
		</if>
		<if test="platformTypeList != null and platformTypeList.size > 0">
			<if test="platformTypeList.indexOf('2b') != -1">
				<choose>
					<when test="platformTypeButton == true">
						and dp2bp.id is not null
					</when>
					<otherwise>
						and dp2bp.id is null
					</otherwise>
				</choose>
			</if>
			<if test="platformTypeList.indexOf('2c') != -1">
				<choose>
					<when test="platformTypeButton == true">
						and dp2cp.id is not null
					</when>
					<otherwise>
						and dp2cp.id is null
					</otherwise>
				</choose>
			</if>
		</if>
		<if test="isRelease != null">
			and dpr.is_release = #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="recommendedType != null">
			and dpr.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
	</select>

	<!-- getFranchiserPlanListByDTO -->
	<select id="getFranchiserPlanListByDTO" parameterType="com.nork.design.model.input.FranchiserPlanListDTO" resultType="com.nork.design.model.output.FranchiserPlanListVO">
		select 
		distinct(dpr.id) as id,
		dpr.id as planRecommendedId,
		dpr.plan_id as planId,
		dpr.plan_code as planCode,
		dpr.plan_name as planName,
		sc.space_areas as spaceAreas,
		dpr.release_time as releaseTime,
		dpr.gmt_create as gmtCreate, 
		su.user_name as creator,
		rrp.pic_path as coverPath,
		sd.name as houseTypeName,
		bps.name as styleName,
		case when dp2bp.id is null then 0 else 1 end as toBStatus,
		case when dp2cp.id is null then 0 else 1 end as toCStatus,
		dpr.shelf_status as shelfStatus,
		bc.company_name as companyName,
		dpr.recommended_type as recommendedType
		from 
		design_plan_recommended dpr
		left join space_common sc on sc.id = dpr.space_common_id
		left join sys_user su on su.id = dpr.user_id
		left join res_render_pic rrp on rrp.id = dpr.cover_pic_Id
		left join sys_dictionary sd on sd.type = "houseType" and value = sc.space_function_id
		left join base_product_style bps on bps.id = dpr.design_recommended_style_id
		left join base_company bc on bc.id = dpr.company_id
		<!-- <if test="platformTypeList != null and platformTypeList.size > 0">
			<if test="platformTypeList.indexOf('2b') != -1"> -->
				left join design_plan_2b_platform dp2bp on dp2bp.plan_id = dpr.id 
				<!-- and dp2bp.platform_id = #{platformId,jdbcType=INTEGER} -->
				and dp2bp.is_deleted = 0 and dp2bp.allot_state = 1 
				<!-- and dp2bp.putaway_state = 1 -->
			<!-- </if>
			<if test="platformTypeList.indexOf('2c') != -1"> -->
				left join design_plan_2c_platform dp2cp on dp2cp.plan_id = dpr.id 
				<!-- and dp2cp.platform_id = #{platformId,jdbcType=INTEGER} -->
				and dp2cp.is_deleted = 0 and dp2cp.allot_state = 1 
				<!-- and dp2cp.putaway_state = 1 -->
			<!-- </if>
		</if> -->
		<if test="companyId != null">
			left join design_plan_brand dpb on dpb.plan_id = dpr.id
		</if>
		where 
		1 = 1
		and dpr.is_deleted = 0
		<if test="companyId != null">
			<!-- and dpr.company_id = #{companyId,jdbcType=INTEGER} -->
			and (dpb.company_id = #{companyId,jdbcType=INTEGER} or dpr.company_id = #{companyId,jdbcType=INTEGER})
		</if>
		<!-- <if test="planSource != null and planSource != ''">
			and dpr.plan_source = #{planSource,jdbcType=VARCHAR}
		</if> -->
		<if test="planSource != null and planSource != ''">
			<choose>
				<when test="planSource == 'diy'">
					and (dpr.plan_source = #{planSource,jdbcType=VARCHAR} or dpr.plan_source is null or dpr.plan_source = "" or dpr.plan_source = "huxing")
				</when>
				<otherwise>
					and dpr.plan_source = #{planSource,jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		<if test="baseCompanyIdList != null and baseCompanyIdList.size > 0">
			and dpr.company_id in
			<foreach collection="baseCompanyIdList" item="baseCompanyIdListItem" separator="," open="(" close=")">
				#{baseCompanyIdListItem,jdbcType=INTEGER}
			</foreach>
		</if>
		<if test="planName != null and planName != ''">
			and dpr.plan_name like concat ("%",#{planName,jdbcType=VARCHAR},"%")
		</if>
		<if test="houseType != null">
			and sc.space_function_id = #{houseType,jdbcType=INTEGER}
		</if>
		<if test="designRecommendedStyleId != null">
			and dpr.design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}
		</if>
		<if test="shelfStatusLike != null and shelfStatusLike != ''">
			<!-- and dpr.shelf_status like concat ("%",#{shelfStatusLike,jdbcType=VARCHAR},"%") -->
			and concat(",",dpr.shelf_status,",") like concat ("%,",#{shelfStatusLike,jdbcType=VARCHAR},",%")
		</if>
		<if test="shelfStatusNotLike != null and shelfStatusNotLike != ''">
			<!-- and dpr.shelf_status not like concat ("%",#{shelfStatusNotLike,jdbcType=VARCHAR},"%") -->
			and concat(",",dpr.shelf_status,",") not like concat ("%,",#{shelfStatusNotLike,jdbcType=VARCHAR},",%")
		</if>
		<if test="platformTypeList != null and platformTypeList.size > 0">
			<if test="platformTypeList.indexOf('2b') != -1">
				<choose>
					<when test="platformTypeButton == true">
						and dp2bp.id is not null
					</when>
					<otherwise>
						and dp2bp.id is null
					</otherwise>
				</choose>
			</if>
			<if test="platformTypeList.indexOf('2c') != -1">
				<choose>
					<when test="platformTypeButton == true">
						and dp2cp.id is not null
					</when>
					<otherwise>
						and dp2cp.id is null
					</otherwise>
				</choose>
			</if>
		</if>
		<if test="isRelease != null">
			and dpr.is_release = #{isRelease,jdbcType=INTEGER}
		</if>
		<if test="recommendedType != null">
			and dpr.recommended_type = #{recommendedType,jdbcType=INTEGER}
		</if>
		<!-- 要按照方案发布顺序排序 -->
		<if test="order != null and  order !=''  ">
			order by ${order}
			<if test="orderNum != null and  orderNum !='' ">
				${orderNum}
			</if>
		</if>
		<if test="order == null or order == ''">
			order by dpr.id desc
		</if>
		<if test="start != null and limit != null">
			limit #{start,jdbcType=INTEGER},#{limit,jdbcType=INTEGER}
		</if>
	</select>

</mapper>
