<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nork.design.dao.ReleaseDesignPlanMapper">
<!--<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/>-->

	<sql id="All_Column_List">
		id,spelling_flower_product,spelling_flower_file_id,plan_id,recommended_type,is_recommended,is_default_decorate,plan_number,design_recommended_style_id,release_time,is_release,cover_pic_Id,plan_code,plan_name,plan_source,house_id,living_id,residential_units_name,user_id,media_type,design_source_type,design_id,share_total,is_open,is_change,
		is_decorated,draft_state,baiMo_state,stuff_finish_state,decorate_finish_state,design_template_id,design_style_id,pic_id,model_id,model_3d_id,model_u3d_id,web_model_u3d_id,ios_model_u3d_id,ipad_model_u3d_id,pc_model_u3d_id,
		android_model_u3d_id,macBookpc_model_u3d_id,config_file_id,space_common_id,designPlan_render_pic_ids,plan_desc,sys_code,creator,gmt_create,modifier,gmt_modified,is_deleted,remark,evening_file_id,dawn_file_id,night_file_id,effects_config,apply_space_areas,space_layout_type,company_id
	</sql>
	<!-- **结果定义** -->
	<resultMap id="AllResultMap" type="com.nork.design.model.DesignPlanRecommended">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result  column="recommended_type" property="recommendedType" jdbcType="INTEGER" />
		<result  column="plan_id" property="planId" jdbcType="INTEGER" />
		<result  column="plan_code" property="planCode" jdbcType="VARCHAR" />
		<result  column="plan_name" property="planName" jdbcType="VARCHAR" />
		<result column="plan_source" property="planSource" jdbcType="VARCHAR"/>
		<result column="house_id" property="houseId" jdbcType="INTEGER"/>
		<result column="living_id" property="livingId" jdbcType="INTEGER"/>
		<result column="residential_units_name" property="residentialUnitsName" jdbcType="VARCHAR"/>
		<result  column="user_id" property="userId" jdbcType="INTEGER" />
		<result  column="media_type" property="mediaType" jdbcType="INTEGER" />
		<result  column="design_source_type" property="designSourceType" jdbcType="INTEGER" />
		<result  column="design_id" property="designId" jdbcType="INTEGER" />
		<result  column="design_template_id" property="designTemplateId" jdbcType="INTEGER" />
		<result  column="design_style_id" property="designStyleId" jdbcType="INTEGER" />
		<result  column="pic_id" property="picId" jdbcType="INTEGER" />
		<result  column="model_id" property="modelId" jdbcType="INTEGER" />
		<result  column="model_3d_id" property="model3dId" jdbcType="INTEGER" />
		<result  column="model_u3d_id" property="modelU3dId" jdbcType="INTEGER" />
		<result  column="web_model_u3d_id" property="webModelU3dId" jdbcType="INTEGER" />
		<result  column="ios_model_u3d_id" property="iosModelU3dId" jdbcType="INTEGER" />
		<result  column="ipad_model_u3d_id" property="ipadModelU3dId" jdbcType="INTEGER" />
		<result  column="pc_model_u3d_id" property="pcModelU3dId" jdbcType="INTEGER" />
		<result  column="android_model_u3d_id" property="androidModelU3dId" jdbcType="INTEGER" />
		<result  column="macBookpc_model_u3d_id" property="macBookpcModelU3dId" jdbcType="INTEGER" />
		<result  column="config_file_id" property="configFileId" jdbcType="INTEGER" />
		<result  column="space_common_id" property="spaceCommonId" jdbcType="INTEGER" />
		<result  column="designPlan_render_pic_ids" property="designPlanRenderPicIds" jdbcType="VARCHAR" />
		<result  column="space_function_id" property="spaceFunctionId" jdbcType="INTEGER" />
		<result  column="space_areas" property="spaceAreas" jdbcType="VARCHAR" />
		<result  column="plan_desc" property="planDesc" jdbcType="VARCHAR" />
		<result  column="sys_code" property="sysCode" jdbcType="VARCHAR" />
		<result  column="creator" property="creator" jdbcType="VARCHAR" />
		<result  column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
		<result  column="modifier" property="modifier" jdbcType="VARCHAR" />
		<result  column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
		<result  column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
		<result  column="remark" property="remark" jdbcType="VARCHAR" />
		<result  column="share_total" property="shareTotal" jdbcType="INTEGER" />
		<result  column="is_open" property="isOpen" jdbcType="INTEGER" />
		<result  column="is_change" property="isChange" jdbcType="INTEGER" />
		<result  column="is_decorated" property="isDecorated" jdbcType="INTEGER" />
		<result  column="draft_state" property="draftState" jdbcType="INTEGER" />
		<result  column="baiMo_state" property="baiMoState" jdbcType="INTEGER" />
		<result  column="stuff_finish_state" property="stuffFinishState" jdbcType="INTEGER" />
		<result  column="decorate_finish_state" property="decorateFinishState" jdbcType="INTEGER" />
		<result  column="cover_pic_Id" property="coverPicId" jdbcType="INTEGER" />
		<result  column="is_release" property="isRelease" jdbcType="INTEGER" />
		<result  column="release_time" property="releaseTime" jdbcType="TIMESTAMP" />
		<result  column="design_recommended_style_id" property="designRecommendedStyleId" jdbcType="INTEGER" />
		<result  column="effects_config" property="effectsConfig" jdbcType="VARCHAR" />
		<result  column="is_recommended" property="isRecommended" jdbcType="INTEGER" />
		<result  column="is_default_decorate" property="isDefaultDecorate" jdbcType="INTEGER" />
		<result  column="plan_number" property="planNumber" jdbcType="VARCHAR" />
		<result  column="apply_space_areas" property="applySpaceAreas" jdbcType="VARCHAR" />

		<result  column="spelling_flower_file_id" property="spellingFlowerFileId" jdbcType="INTEGER" />
		<result  column="spelling_flower_product" property="spellingFlowerProduct" jdbcType="INTEGER" />
		<result  column="space_layout_type" property="spaceLayoutType" jdbcType="VARCHAR" />
		<result  column="company_id" property="companyId" jdbcType="INTEGER" />
	</resultMap>

	<!-- 查询所有，可排序 -->
	<select id="getDesignPlanRecommendedList" resultMap="AllResultMap"
			parameterType="com.nork.design.model.DesignPlanRecommended">
		select
		<include refid="All_Column_List" />
		from design_plan_recommended
		where 1=1
		<if test="spellingFlowerProduct!= null">and spelling_flower_product = #{spellingFlowerProduct,jdbcType=VARCHAR} </if>
		<if test="spellingFlowerFileId!= null">and spelling_flower_file_id = #{spellingFlowerFileId,jdbcType=INTEGER}  </if>

		<if test="planId!= null">and plan_id = #{planId,jdbcType=INTEGER} </if>
		<if test="recommendedType!= null">and recommended_type = #{recommendedType,jdbcType=INTEGER} </if>
		<if test="recommendedTypes != null and recommendedTypes.size() >0">
			AND	recommended_type in
			<foreach collection="recommendedTypes" index="index" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="isRecommended!= null">and is_recommended = #{isRecommended,jdbcType=INTEGER}  </if>
		<if test="isDefaultDecorate!= null">and is_default_decorate = #{isDecorate,jdbcType=INTEGER}  </if>
		<if test="planNumber!= null">and plan_number = #{planNumber,jdbcType=VARCHAR}  </if>
		<if test="designRecommendedStyleId!= null">and   design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER} </if>
		<if test="releaseTime!= null">and release_time =#{releaseTime,jdbcType=TIMESTAMP}  </if>
		<if test="isRelease!= null"> and is_release = #{isRelease,jdbcType=INTEGER}  </if>
		<if test="coverPicId!= null">and cover_pic_Id = #{coverPicId,jdbcType=INTEGER} </if>
		<if test="id!= null">  and id = #{id,jdbcType=INTEGER} </if>
		<if test="planCode!= null">  and plan_code = #{planCode,jdbcType=VARCHAR} </if>
		<if test="planName!= null">  and plan_name = #{planName,jdbcType=VARCHAR} </if>
		<if test="userId!= null">  and user_id = #{userId,jdbcType=INTEGER} </if>
		<if test="mediaType!= null">  and media_type = #{mediaType,jdbcType=INTEGER} </if>
		<if test="designSourceType!= null">  and design_source_type = #{designSourceType,jdbcType=INTEGER} </if>
		<if test="designId!= null">  and design_id = #{designId,jdbcType=INTEGER} </if>
		<if test="designStyleId!= null">  and design_style_id = #{designStyleId,jdbcType=INTEGER} </if>
		<if test="picId!= null">  and pic_id = #{picId,jdbcType=INTEGER} </if>
		<if test="modelId!= null">  and model_id = #{modelId,jdbcType=INTEGER} </if>
		<if test="model3dId!= null">  and model_3d_id = #{model3dId,jdbcType=INTEGER} </if>
		<if test="modelU3dId!= null">  and model_u3d_id = #{modelU3dId,jdbcType=INTEGER} </if>
		<if test="webModelU3dId!= null">  and web_model_u3d_id = #{webModelU3dId,jdbcType=INTEGER} </if>
		<if test="configFileId!= null">  and config_file_id = #{configFileId,jdbcType=INTEGER} </if>
		<if test="spaceCommonId!= null">  and space_common_id = #{spaceCommonId,jdbcType=INTEGER} </if>
		<if test="designPlanRenderPicIds!= null">  and LOCATE(#{designPlanRenderPicIds,jdbcType=VARCHAR},designPlan_render_pic_ids) > 0, </if>
		<if test="planDesc!= null">  and plan_desc = #{planDesc,jdbcType=VARCHAR} </if>
		<if test="draftState!= null">  and draft_state = #{draftState,jdbcType=INTEGER} </if>
		<if test="baiMoState!= null">  and baiMo_state = #{baiMoState,jdbcType=INTEGER} </if>
		<if test="stuffFinishState!= null">  and stuff_finish_state = #{stuffFinishState,jdbcType=INTEGER} </if>
		<if test="decorateFinishState!= null">  and decorate_finish_state = #{decorateFinishState,jdbcType=INTEGER} </if>
		<if test="sysCode!= null">  and sys_code = #{sysCode,jdbcType=VARCHAR} </if>
		<if test="creator!= null">  and creator = #{creator,jdbcType=VARCHAR} </if>
		<if test="gmtCreate!= null">  and gmt_create = #{gmtCreate,jdbcType=TIMESTAMP} </if>
		<if test="modifier!= null">  and modifier = #{modifier,jdbcType=VARCHAR} </if>
		<if test="gmtModified!= null">  and gmt_modified = #{gmtModified,jdbcType=TIMESTAMP} </if>
		<if test="isDeleted!= null">  and is_deleted = #{isDeleted,jdbcType=INTEGER} </if>

		<if test="order != null and  order !=''  ">
			order by ${order}
			<if test="orderNum != null and  orderNum !='' ">
				${orderNum}
			</if>
		</if>
		<if test="orders != null and  orders !=''  ">
			order by ${orders}
		</if>
	</select>



	<select id="getIsReleasedPlan" resultMap="AllResultMap"
			parameterType="com.nork.design.model.DesignPlanRecommended">
		select
		<include refid="All_Column_List" />
		from design_plan_recommended
		where 1=1
		and is_release IN (1,2,3)
		<if test="planId!= null">and plan_id = #{planId,jdbcType=INTEGER} </if>
		<if test="recommendedType!= null">and recommended_type = #{recommendedType,jdbcType=INTEGER} </if>
		<if test="recommendedTypes != null and recommendedTypes.size() >0">
			AND	recommended_type in
			<foreach collection="recommendedTypes" index="index" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="search_CompanyId != null"> and (company_id = #{search_CompanyId,jdbcType=INTEGER} or company_id = 0)</if>
		<if test="isDeleted!= null">  and is_deleted = #{isDeleted,jdbcType=INTEGER} </if>
	</select>

	<resultMap id="DesignPlanProductMap" type="com.nork.design.model.DesignPlanProduct">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result  column="product_code" property="productCode" jdbcType="VARCHAR" />
	</resultMap>

	<select id="getDesignPlanProductList" resultType="java.lang.String" parameterType="java.lang.Integer">
		select bp.product_code
		from design_plan_product_render_scene dpprc, base_product bp
		where dpprc.plan_id = #{planId,jdbcType=INTEGER} and dpprc.is_deleted=0
		      AND dpprc.product_id = bp.id and bp.putaway_state in (0,4)
	</select>

	<update id="markIsDeletedForCheckFailurePlan" parameterType="com.nork.design.model.Favorite">
		update design_plan_recommended
			SET is_deleted = 1
		WHERE plan_id = #{planId,jdbcType=INTEGER} and is_deleted = 0 and is_release = 4
	</update>

</mapper>
