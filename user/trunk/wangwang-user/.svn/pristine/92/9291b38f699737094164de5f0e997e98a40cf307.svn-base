<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.user.dao.SysUserRoleDao">
	<insert id="batchNewUserRole" useGeneratedKeys="true" keyProperty="id">
		insert into sys_user_role (
			user_id, role_id, is_deleted,
			creator, modifier, gmt_create,
			gmt_modified
		)
		values
		<foreach collection="list" item="item" separator=",">
			<trim prefix="(" suffix=")" suffixOverrides=",">
				#{item.userId}, #{item.roleId}, #{item.isDeleted},
				#{item.creator}, #{item.modifier}, #{item.gmtCreate},
				#{item.gmtModified}
			</trim>
		</foreach>
	</insert>
	<update id="updateUserRole">
		update sys_user_role
		<set>
			<if test="isDeleted != null"> is_deleted = #{isDeleted} </if>
		</set>
		where id in
		<foreach collection="list" item="item" open="(" separator="," close=")">
			#{item.id}
		</foreach>
	</update>

	<select id="listUserRole" resultType="com.sandu.api.user.model.bo.UserRoleDetailBO">
		SELECT
		  p.id platform_id,
		  p.platform_name,
		  GROUP_CONCAT(DISTINCT r.id) AS roleIds,
		  GROUP_CONCAT(DISTINCT r.name) AS roleNames
		FROM
		  base_platform p,
		  sys_role r,
		  sys_user_role ur
		WHERE p.id = r.platform_id
		  AND r.id = ur.role_id
		  AND p.is_deleted = 0
		  AND r.is_deleted = 0
		  AND ur.is_deleted = 0
		  AND ur.user_id = #{userId}
		GROUP BY p.id
		ORDER BY p.id,
		  r.id ;
	</select>

    <select id="listAvailableUserRole" resultType="com.sandu.api.user.model.SysUserRole">
		select id, user_id, role_id, is_deleted from sys_user_role r where r.user_id = #{userId}
	</select>
</mapper>
