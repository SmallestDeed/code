package com.sandu.search.controller;

import com.sandu.search.common.constant.IndexInfoQueryConfig;
import com.sandu.search.common.tools.JsonUtil;
import com.sandu.search.entity.elasticsearch.index.CategoryProductIndexMappingData;
import com.sandu.search.entity.elasticsearch.response.SearchObjectResponse;
import com.sandu.search.exception.ProductStyleSearchException;
import com.sandu.search.service.product.ProductStyleSearchService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * 产品风格
 *
 * @date 20171218
 * @auth pengxuangang
 */
@Slf4j
@RestController
@EnableAutoConfiguration
@RequestMapping("/product/style")
public class ProductStyleController {

    private final static String CLASS_LOG_PREFIX = "产品风格:";

    @Autowired
    private ProductStyleSearchService productStyleSearchService;

    /**
     * 根据风格名搜索产品列表
     *
     * @param styleName 产品风格名
     * @return
     */
    @RequestMapping("/{styleName}")
    List<CategoryProductIndexMappingData> productByProductStyle(@PathVariable String styleName) {

        SearchObjectResponse searchObjectResponse;
        log.info(CLASS_LOG_PREFIX + "根据风格名搜索产品列表:ProductStyle:{}.", styleName);
        try {
            searchObjectResponse = productStyleSearchService.queryProductListByProductStyleName(styleName, IndexInfoQueryConfig.DEFAULT_SEARCH_DATA_SIZE);
        } catch (ProductStyleSearchException e) {
            log.error(CLASS_LOG_PREFIX + "根据风格名搜索产品列表失败! ProductStyleSearchException:{}.", e);
            return null;
        }
        log.info(CLASS_LOG_PREFIX + "根据风格名搜索产品列表完成!List<CategoryProductIndexMappingData>:{}.", JsonUtil.toJson(searchObjectResponse));

        if (null == searchObjectResponse) {
            log.warn(CLASS_LOG_PREFIX + "根据风格名搜索产品列表完成!SearchObjectResponse is null,styleName:{}.", styleName);
            return null;
        }

        return (List<CategoryProductIndexMappingData>) searchObjectResponse.getHitResult();
    }

}