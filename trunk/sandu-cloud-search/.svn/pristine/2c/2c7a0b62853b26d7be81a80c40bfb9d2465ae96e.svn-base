<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.search.dao.MetaDataDao">

    <!-- 查询产品分类元数据 -->
    <select id="queryProductCategoryMetaData" resultType="com.sandu.search.entity.elasticsearch.po.ProductCategoryPo">
        SELECT
            id        AS id,
            code      AS productCategoryCode,
            long_code AS productCategoryLongCode,
            pid       AS parentCategoryId,
            name      AS categoryName,
            level     AS categoryLevel,
            ordering  AS categoryOrder,
            sys_code  AS categorySystemCode
        FROM
            pro_category
        WHERE
            is_deleted = 0
    </select>

    <!-- 查询产品风格元数据 -->
    <select id="queryProductStyleMetaData" resultType="com.sandu.search.entity.elasticsearch.po.ProductStylePo">
        SELECT
          id          AS id,
          pid         AS parentStyleId,
          name        AS styleName,
          code        AS styleCode,
          long_code   AS styleLongCode,
          value       AS styleValue,
          is_leaf     AS isLeaf,
          level       AS styleLevel,
          sys_code    AS styleSystemCode
        FROM
          base_product_style
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询产品材质元数据 -->
    <select id="queryProductTextureMetaData" resultType="com.sandu.search.entity.elasticsearch.po.ProductTexturePo">
        SELECT
            T.id    AS id,
            D.name  AS textureName
        FROM
            res_texture T,
            sys_dictionary D
        WHERE
            D.TYPE = 'texture'
        AND T.texture = D.VALUE
        AND T.is_deleted = 0
        AND D.is_deleted = 0
    </select>

    <!-- 查询品牌元数据 -->
    <select id="queryBrandMetaData" resultType="com.sandu.search.entity.elasticsearch.po.BrandPo">
        SELECT
            id             AS id,
            brand_name     AS brandName,
            company_id     AS companyId,
            brand_logo     AS brandLogoPicId,
            brand_desc     AS brandDesc,
            status_show_wu AS showNoBrand
        FROM
            base_brand
        WHERE
            is_deleted = 0
    </select>

    <!-- 查询产品分类关联信息-->
    <select id="queryProductCategoryRelMetaData"
            resultType="com.sandu.search.entity.elasticsearch.po.ProductCategoryRelPo">
        SELECT
            product_id      AS productId,
            category_id     AS categoryId
        FROM
            product_category_rel
        WHERE
            is_deleted = 0
    </select>

    <!-- 查询图片资源元数据-->
    <select id="queryResPicMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ResPicPo">
        SELECT
          id          AS id,
          pic_path    AS picPath
        FROM
          res_pic
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询图片资源元数据-->
    <select id="getResPicMetaDataById" parameterType="int" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ResPicPo">
        SELECT
          id          AS id,
          pic_path    AS picPath
        FROM
          res_pic
        WHERE
          is_deleted = 0
        AND
          id = #{id}
    </select>

    <!-- 查询产品组合关联元数据 -->
    <select id="queryProductGroupRelMetaData"
            resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductGroupRelPo">
        SELECT
          id          AS id,
          group_id    AS productGroupId,
          product_id  AS productId,
          is_main     AS productIsMain,
          sys_code    AS systemCode
        FROM
          group_product_details
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询产品组合元数据 -->
    <select id="queryProductGroupMetaData"
            resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductGroupPo">
        SELECT
          id                      AS id,
          group_code              AS productGroupCode,
          group_name              AS productGroupName,
          type                    AS productGroupType,
          pic_id                  AS productGroupPicId,
          sys_code                AS systemCode,
          design_templet_id       AS productGroupTmelateId,
          location                AS productGroupLocationData,
          group_price             AS productGroupTotalPrice,
          structure_id            AS productGroupStructureId,
          group_width             AS productGroupWidth,
          group_length            AS productGroupLength,
          group_high              AS productGroupHeight,
          space_function_value    AS spaceFunctionValue,
          space_area_value        AS spaceAreaValue,
          brand_id                AS brandId,
          group_type              AS productBusinessGroupType,
          composite_type          AS productCompositeType
        FROM
          group_product
        WHERE
          is_deleted = 0
        AND
          state = 0
    </select>

    <!-- 查询草稿设计方案产品元数据 -->
    <select id="queryTempDesignPlanProductMetaData" resultType="com.sandu.search.entity.designplan.po.DesignPlanProductPo">
        SELECT
         id                AS id,
         init_product_id   AS initProductId
        FROM
          design_plan_product
        WHERE
          is_deleted = 0
        AND
          init_product_id &lt;&gt; 0
        ORDER BY
          id
        DESC
        LIMIT 0,600000
        <!-- 优化性能，只查询60W数据 -->
    </select>

    <!-- 查询推荐设计方案产品元数据 -->
    <select id="queryRecommendDesignPlanProductMetaData" resultType="com.sandu.search.entity.designplan.po.DesignPlanProductPo">
        SELECT
          id                AS id,
          init_product_id   AS initProductId
        FROM
          design_plan_recommended_product
        WHERE
          is_deleted = 0
        AND
          init_product_id &lt;&gt; 0
    </select>

    <!-- 查询自定义设计方案产品元数据 -->
    <select id="queryDiyDesignPlanProductMetaData" resultType="com.sandu.search.entity.designplan.po.DesignPlanProductPo">
        SELECT
          id                AS id,
          init_product_id   AS initProductId
        FROM
          design_plan_product_render_scene
        WHERE
          is_deleted = 0
        AND
          init_product_id &lt;&gt; 0
    </select>

    <!-- 查询产品组合元数据 -->
    <select id="querySystemDictionaryMetaData"
            resultType="com.sandu.search.entity.elasticsearch.po.metadate.SystemDictionaryPo">
        SELECT
          id        AS id,
          sys_code  AS systemCode,
          type      AS dictionaryType,
          valuekey  AS dictionaryKey,
          value     AS dictionaryValue,
          name      AS dictionaryName,
          ordering  AS dictionaryOrder
        FROM
          sys_dictionary
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询户型小区元数据 -->
    <select id="queryHouseLivingMetaData" resultType="com.sandu.search.entity.elasticsearch.po.house.HouseLivingPo">
        SELECT
          id              AS  livingId,
          living_type     AS  livingType,
          living_code     AS  livingCode,
          living_name     AS  livingName,
          living_address  AS  livingAddress,
          living_desc     AS  livingDesc,
          area_id         AS  livingAreaId,
          build_area      AS  livingBuildArea,
          cover_area      AS  livingCoverArea,
          area_long_code  AS  livingAreaLongCode
        FROM
          base_living
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询区域元数据 -->
    <select id="queryAreaMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.AreaPo">
        SELECT
          id          AS areaId,
          area_code   AS areaCode,
          area_name   AS areaName,
          pid         AS areaParentId,
          level_id    AS areaLevelId,
          zip_code    AS areaZipCode
        FROM
          base_area
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询公司元数据 -->
    <select id="queryCompanyMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.CompanyPo">
        SELECT
            C.id                        AS companyId,
            C.company_code              AS companyCode,
            C.company_name              AS companyName,
            C.company_desc              AS companyDesc,
            C.company_address           AS companyAddress,
            C.company_domain_name       AS companyDomainName,
            C.industry                  AS companyIndustry,
            C.product_visibility_range  AS companyProductVisibilityRange,
            C.brand_id                  AS dealerBrands,
            N.app_id                    AS miniProgramAppId
        FROM
            base_company C
        LEFT JOIN (
            SELECT
                M.company_id,
                M.app_id
            FROM
                base_company_mini_program_config M
            WHERE
                M.is_deleted = 0
        ) N ON C.id = N.company_id
        WHERE
            C.is_deleted = 0
    </select>

    <!-- 查询公司分类关联元数据 -->
    <select id="queryCompanyCategoryRelMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.CompanyCategoryRelPo">
        SELECT
          company_id    AS companyId,
          category_id   AS categoryId
        FROM
          company_category_rel
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询设计方案样板房元数据 -->
    <select id="queryDesignTemplatePoMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.DesignTemplatePo">
        SELECT
          id                    AS id,
          space_common_id       AS spaceCommonId
        FROM
          design_templet
        WHERE
          is_deleted = 0
    </select>

    <!-- 查询2B平台产品数据-->
    <select id="queryToBPlatformProductMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductPlatformRelPo">
        SELECT
            PRO.product_id                                                                  AS productId,
            PLA.platform_code	    													    AS platformCode,
            CONVERT(IF(ISNULL(PRO.sale_price),0,PRO.sale_price),SIGNED)                     AS platformProductSalePrice,
            PRO.advice_price                                                                AS platformProductAdvicePrice,
            PRO.description                                                                 AS platformProductDesc,
            PRO.putaway_state                                                               AS platformPutawatStatus,
            PRO.allot_state                                                                 AS platformStatus,
            PRO.pic_id                                                                      AS platformCoverPicId,
            PRO.pic_ids                                                                     AS platformPicIds
        FROM
          platform2b_product_rel PRO
        LEFT JOIN
		  base_platform PLA
		ON
		  PRO.platform_id = PLA.id
        WHERE
          PRO.is_deleted = 0
          AND
          PLA.is_deleted = 0
    </select>

    <!-- 查询2C平台产品数据-->
    <select id="queryToCPlatformProductMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductPlatformRelPo">
        SELECT
            PRO.product_id                                                                  AS productId,
            PLA.platform_code	    													    AS platformCode,
            CONVERT(IF(ISNULL(PRO.sale_price),0,PRO.sale_price),SIGNED)                     AS platformProductSalePrice,
            PRO.advice_price                                                                AS platformProductAdvicePrice,
            PRO.description                                                                 AS platformProductDesc,
            PRO.putaway_state                                                               AS platformPutawatStatus,
            PRO.allot_state                                                                 AS platformStatus,
            PRO.pic_id                                                                      AS platformCoverPicId,
            PRO.pic_ids                                                                     AS platformPicIds
        FROM
          platform2c_product_rel PRO
        LEFT JOIN
		  base_platform PLA
		ON
		  PRO.platform_id = PLA.id
        WHERE
          PRO.is_deleted = 0
          AND
          PLA.is_deleted = 0
    </select>

    <!-- 查询三度平台产品数据-->
    <select id="querySanduPlatformProductMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductPlatformRelPo">
        SELECT
            PRO.product_id                                                              	AS productId,
            PLA.platform_code	    													    AS platformCode,
            CONVERT(IF(ISNULL(PRO.sale_price),0,PRO.sale_price),SIGNED)                     AS platformProductSalePrice,
            PRO.description                                                                 AS platformProductDesc,
            PRO.putaway_state                                                               AS platformPutawatStatus,
            PRO.allot_state                                                                 AS platformStatus
        FROM
          platformsandu_product_rel PRO
		LEFT JOIN
		  base_platform PLA
		ON
		  PRO.platform_id = PLA.id
        WHERE
          PRO.is_deleted = 0
          AND
          PLA.is_deleted = 0
    </select>

    <!-- 查询产品属性元信息 -->
    <select id="queryProductAttrMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductAttributePo">
        SELECT
            bp.id               AS productId,
            ppp.`code`          AS attributeCode,
            pp.prop_value       AS attributeValue,
            ppp.filter_order     AS attributeType
        FROM
            base_product bp
        LEFT JOIN product_attribute pa ON pa.product_id = bp.id
        LEFT JOIN product_props pp ON pp.id = pa.attribute_value_id
        LEFT JOIN product_props ppp ON ppp.id = pp.pid
        WHERE
            bp.is_deleted = 0
        AND
            ppp.`code` IS NOT NULL;
    </select>

    <!-- 查询产品使用次数统计-->
    <select id="queryProductUsageCountSatatistics" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ProductUsagePo">
        SELECT
            product_id    AS productId,
            user_id       AS userId,
            count         AS productUsageCount
        FROM
            product_usage_count
        WHERE
            is_deleted = 0;
    </select>

    <!-- 查询联盟品牌元数据 -->
    <select id="queryUnionBrandMetaData" resultType="com.sandu.search.entity.elasticsearch.po.UnionBrandPo">
        SELECT
            R.union_id  AS unionId,
            R.brand_id  AS brandId
        FROM
            union_brand_ref R
        LEFT JOIN union_brand U ON R.union_id = U.id
        WHERE
            R.is_deleted = 0
        AND U.is_deleted = 0
        AND U.`status` = 1;
    </select>

    <!-- 查询渲染图片资源元数据-->
    <select id="queryRenderPicMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.ResPicPo">
        SELECT
            id          AS id,
            pic_path    AS picPath
        FROM
            res_render_pic
        WHERE
            is_deleted = 0
    </select>

    <!-- 查询设计方案品牌元数据-->
    <select id="queryDesignPlanBrandMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.DesignPlanBrandPo">
        SELECT
            plan_id          AS designPlanId,
            brand_id         AS brandId,
            company_id       AS companyId
        FROM
            design_plan_brand
        WHERE
            is_deleted = 0
    </select>

    <!-- 查询空间元数据-->
    <select id="querySpaceCommonMetaData" resultType="com.sandu.search.entity.elasticsearch.po.metadate.SpaceCommonPo">
        SELECT
            id                  AS id,
            space_function_id   AS spaceFunctionId,
            space_areas         AS spaceAreas,
            space_shape         AS spaceShape
        FROM
            space_common
        WHERE
            is_deleted = 0
    </select>

</mapper>
