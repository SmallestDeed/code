package com.sandu.search.controller;

import com.sandu.search.common.constant.IndexInfoQueryConfig;
import com.sandu.search.common.tools.JsonUtil;
import com.sandu.search.entity.elasticsearch.index.CategoryProductIndexMappingData;
import com.sandu.search.entity.elasticsearch.response.SearchObjectResponse;
import com.sandu.search.exception.BrandSearchException;
import com.sandu.search.service.product.ProductBrandSearchService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * 产品品牌
 *
 * @date 20171218
 * @auth pengxuangang
 */
@Slf4j
@RestController
@EnableAutoConfiguration
@RequestMapping("/product/brand")
public class ProductBrandController {

    private final static String CLASS_LOG_PREFIX = "产品品牌:";

    @Autowired
    private ProductBrandSearchService productBrandSearchService;

    /**
     * 根据品牌名搜索产品列表
     *
     * @param brandName 品牌名
     * @return
     */
    @RequestMapping("/{brandName}")
    List<CategoryProductIndexMappingData> productByBrandName(@PathVariable String brandName) {

        log.info(CLASS_LOG_PREFIX + "根据品牌名搜索产品列表:BrandName:{}.", brandName);
        SearchObjectResponse searchObjectResponse;
        try {
            searchObjectResponse = productBrandSearchService.queryProductListByBrandName(brandName, IndexInfoQueryConfig.DEFAULT_SEARCH_DATA_SIZE);
        } catch (BrandSearchException e) {
            log.error(CLASS_LOG_PREFIX + "根据品牌名搜索产品列表失败! BrandSearchException:{}.", e);
            return null;
        }
        log.info(CLASS_LOG_PREFIX + "根据品牌名搜索产品列表完成!List<CategoryProductIndexMappingData>:{}.", JsonUtil.toJson(searchObjectResponse));

        if (null == searchObjectResponse) {
            log.warn(CLASS_LOG_PREFIX + "根据品牌名搜索产品列表完成!SearchObjectResponse is null,brandName:{}.", brandName);
            return null;
        }

        return (List<CategoryProductIndexMappingData>) searchObjectResponse.getHitResult();
    }

}