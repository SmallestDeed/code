package com.sandu.web.user;


import com.sandu.common.model.ResponseEnvelope;
import com.sandu.common.util.StringUtils;
import com.sandu.user.model.view.UserBehaviorVO;
import com.sandu.user.service.UserBehaviorService;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;

@RestController
@RequestMapping("/v1/behavior")
public class UserBehaviorController {

    @Resource
    private UserBehaviorService userBehaviorService;

    @GetMapping
    public ResponseEnvelope saveBehaviors(String type, Boolean wx, Boolean pyq) {
        ResponseEnvelope responseEnvelope = new ResponseEnvelope();
        if (wx != null && wx) {
            type = type + UserBehaviorVO.WX_MARK + UserBehaviorVO.FIELD_SUFFIX;
        } else if (pyq != null && pyq) {
            type = type + UserBehaviorVO.PYQ_MARK + UserBehaviorVO.FIELD_SUFFIX;
        } else {
            type = type + UserBehaviorVO.FIELD_SUFFIX;
        }
        if (StringUtils.isBlank(type) || !UserBehaviorVO.keyMap.containsKey(type)) {
            responseEnvelope.setMessage("参数错误");
            return responseEnvelope;
        }
        userBehaviorService.cacheCount(type);
        responseEnvelope.setMessage("success");
        return responseEnvelope;
    }

    @GetMapping("/sync")
    public Object syncCache() {
        userBehaviorService.syncToDB();
        return "success";
    }
}
