package com.sandu.web.user;

import com.sandu.api.base.model.UserCard;
import com.sandu.api.base.service.UserCardService;
import com.sandu.common.LoginContext;
import com.sandu.common.model.LoginUser;
import com.sandu.common.model.ResponseEnvelope;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
@RequestMapping("/v1/core/userCard")
public class UserCardController {

    private final String CLASS_LOG_PREFIX = "【用户电子名片】";

    private final UserCardService userCardService;

    @Autowired
    public UserCardController(UserCardService userCardService) {
        this.userCardService = userCardService;
    }

    @RequestMapping("/getUserCard")
    public ResponseEnvelope getUserCard() {
        LoginUser loginUser = LoginContext.getLoginUser(LoginUser.class);
        if (null == loginUser) {
            return new ResponseEnvelope(false, "请登录");
        }

        UserCard userCard;
        try {
            userCard = userCardService.getUserCardByUserId(loginUser.getId());
        } catch (Exception e) {
            log.error(CLASS_LOG_PREFIX + "获取用户电子名片异常，exception：{}", e);
            userCard = null;
        }

        return new ResponseEnvelope(true, userCard);
    }
}
