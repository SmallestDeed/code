package com.sandu.web.InteractiveZone;

import com.sandu.api.base.common.ResponseEnvelope;
import com.sandu.api.base.common.exception.BizException;
import com.sandu.api.base.input.InteractiveZoneTopicQuery;
import com.sandu.api.base.model.InteractiveZoneTopic;
import com.sandu.api.base.service.InteractiveZoneTopicService;
import com.sandu.api.user.model.SysUser;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

/**
 * @ClassName: InteractiveZoneTopicController
 * @Auther: gaoj
 * @Date: 2019/3/13 10:06
 * @Description:
 * @Version 1.0
 */
@RequestMapping("/v1/core/interactiveZone")
@Slf4j
@RestController
public class InteractiveZoneTopicController {

    private final String CLASS_LOG_PREFIX = "【互动区主题控制层】";

    @Autowired
    private InteractiveZoneTopicService interactiveZoneTopicService;

    @RequestMapping("/list")
    public ResponseEnvelope list(@RequestBody InteractiveZoneTopicQuery interactiveZoneTopicQuery, SysUser sysUser) {

        if (null == interactiveZoneTopicQuery || StringUtils.isBlank(interactiveZoneTopicQuery.getBlockTypeValueKey())) {
            return new ResponseEnvelope(false, "参数缺失");
        }

        try {
            Integer count = interactiveZoneTopicService.totalCount(interactiveZoneTopicQuery);
            if (null == count || 0 >= count) {
                return new ResponseEnvelope(false, "没有找到相关数据");
            }
            List<InteractiveZoneTopic> list = interactiveZoneTopicService.list(interactiveZoneTopicQuery);
            return new ResponseEnvelope(true, "查询成功", count, list);
        } catch (BizException e) {
            log.warn(CLASS_LOG_PREFIX + "列表数据异常，bizException={}", e);
            return new ResponseEnvelope(false, e.getMessage());
        } catch (Exception e) {
            log.warn(CLASS_LOG_PREFIX + "列表数据异常，exception={}", e);
            return new ResponseEnvelope(false, "系统异常");
        }
    }
}
