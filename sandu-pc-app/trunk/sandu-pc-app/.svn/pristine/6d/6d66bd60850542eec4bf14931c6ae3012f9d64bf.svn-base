<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.design.dao.DesignPlanMapper">
	
	<resultMap id="designPlanModelMap" type="com.sandu.design.model.DesignPlanModel">
		<id column="id" property="designPlanId" jdbcType="INTEGER"/>
		<result column="plan_code" property="planCode" jdbcType="VARCHAR"/>
		<result column="plan_name" property="planName" jdbcType="VARCHAR"/>
		<result column="plan_source" property="planSource" jdbcType="VARCHAR"/>
		<result column="residential_units_name" property="residentialUnitsName" jdbcType="VARCHAR"/>
		<result column="model_id" property="modelId" jdbcType="INTEGER"/>
		<result column="space_function_id" property="spaceFunctionId" jdbcType="INTEGER"/>
		<result column="config_file_id" property="configFileId" jdbcType="INTEGER"/>
		<result column="space_common_id" property="spaceCommonId" jdbcType="INTEGER"/>
		<result column="design_template_id" property="designTemplateId" jdbcType="INTEGER"/>
		<result column="model_path" property="modelPath" jdbcType="VARCHAR"/>
		<result column="file_path" property="filePath" jdbcType="VARCHAR"/>
		<result column="design_code" property="designTempletCode" jdbcType="VARCHAR"/>
		<result column="space_code" property="spaceCode" jdbcType="VARCHAR"/>
		<result column="space_name" property="spaceName" jdbcType="VARCHAR"/>
		<result column="space_areas" property="spaceAreas" jdbcType="VARCHAR"/>
		<result column="value" property="houseTypeValue" jdbcType="INTEGER"/>
		<result column="name" property="houseTypeName" jdbcType="VARCHAR"/>
		<result  column="spelling_flower_product" property="spellingFlowerProduct" jdbcType="INTEGER" />
		<result column="spelling_flower_file_id" property="spellingFlowerFileId" jdbcType="INTEGER"/>
		<result column="daylight_u3d_model_id" property="daylightU3dModelId" jdbcType="INTEGER"/>
		<result column="dusklight_u3d_model_id" property="dusklightU3dModelId" jdbcType="INTEGER"/>
		<result column="nightlight_u3d_model_id" property="nightlightU3dModelId" jdbcType="INTEGER"/>
		<result  column="spelling_flower_file_id" property="spellingFlowerFileId" jdbcType="INTEGER" />
		<result  column="spelling_flower_product" property="spellingFlowerProduct" jdbcType="INTEGER" />
	</resultMap>
	
	<!-- **插入定义** -->
	<insert id="insertSelective" parameterType="com.sandu.design.model.DesignPlan" useGeneratedKeys="true" keyProperty="id">
		insert into design_plan
		<trim prefix="(" suffix=")" suffixOverrides=",">
		<if test="planCode!= null">plan_code, </if>
		<if test="planName!= null">plan_name, </if>
		<if test="planSource!= null">plan_source, </if>
		<if test="houseId!= null">house_id, </if>
		<if test="livingId!= null">living_id, </if>
		<if test="residentialUnitsName!= null">residential_units_name,</if>
		<if test="userId!= null">user_id, </if>
		<if test="mediaType!= null">media_type, </if>
		<if test="designSourceType!= null">design_source_type, </if>
		<if test="designId!= null">design_id, </if>
		<if test="designTemplateId!= null">design_template_id, </if>
		<if test="designStyleId!= null">design_style_id, </if>
		<if test="picId!= null">pic_id, </if>
		<if test="modelId!= null">model_id, </if>
		<if test="model3dId!= null">model_3d_id, </if>
		<if test="modelU3dId!= null">model_u3d_id, </if>
		<if test="webModelU3dId!= null">web_model_u3d_id, </if>
		<if test="iosModelU3dId!= null">ios_model_u3d_id, </if>
		<if test="ipadModelU3dId!= null">ipad_model_u3d_id, </if>
		<if test="pcModelU3dId!= null">pc_model_u3d_id, </if>
		<if test="androidModelU3dId!= null">android_model_u3d_id, </if>
		<if test="macBookpcModelU3dId!= null">macBookpc_model_u3d_id, </if>
		<if test="configFileId!= null">config_file_id, </if>
		<if test="planDesc!= null">plan_desc, </if>
		<if test="spaceCommonId!= null">space_common_id, </if>
		<if test="sysCode!= null">sys_code, </if>
		<if test="creator!= null">creator, </if>
		<if test="gmtCreate!= null">gmt_create, </if>
		<if test="modifier!= null">modifier, </if>
		<if test="gmtModified!= null">gmt_modified, </if>
		<if test="isDeleted!= null">is_deleted, </if>
		<if test="remark!= null">remark, </if>
		<if test="shareTotal!= null">share_total, </if>
		<if test="isOpen!= null">is_open, </if>
		<if test="isChange!= null">is_change, </if>
		<if test="isDecorated!= null">is_decorated, </if>
		<if test="draftState!= null">draft_state, </if>
		<if test="baiMoState!= null">baiMo_state, </if>
		<if test="stuffFinishState!= null">stuff_finish_state, </if>
		<if test="decorateFinishState!= null">decorate_finish_state, </if>
		<if test="coverPicId!= null">cover_pic_Id, </if>
		<if test="releaseTime!= null">release_time, </if>
		<if test="designRecommendedStyleId!= null">design_recommended_style_id, </if>
		<if test="isRecommended!= null">is_recommended, </if>
		<if test="isDefaultDecorate!= null">is_default_decorate, </if>
		<if test="planNumber!= null">plan_number, </if>
		<if test="designSceneId!= null">design_scene_id, </if>
		<if test="visible!= null">visible, </if>
		<if test="sceneModified!= null">scene_modified,</if>
		<if test="recommendedPlanId!= null">recommended_plan_id, </if>
		<if test="businessType != null">business_type, </if>
		<if test="spellingFlowerFileId!= null">spelling_flower_file_id, </if>
		<if test="spellingFlowerProduct!= null">spelling_flower_product, </if>
 
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
		<if test="planCode!= null">  #{planCode,jdbcType=VARCHAR}, </if>
		<if test="planName!= null">  #{planName,jdbcType=VARCHAR}, </if>
		<if test="planSource!= null"> #{planSource,jdbcType=VARCHAR},</if>
		<if test="houseId!= null">  #{houseId,jdbcType=INTEGER}, </if>
		<if test="livingId!= null">  #{livingId,jdbcType=INTEGER}, </if>
		<if test="residentialUnitsName!= null">#{residentialUnitsName,jdbcType=VARCHAR},</if>
		<if test="userId!= null">  #{userId,jdbcType=INTEGER}, </if>
		<if test="mediaType!= null">  #{mediaType,jdbcType=INTEGER}, </if>
		<if test="designSourceType!= null">  #{designSourceType,jdbcType=INTEGER}, </if>
		<if test="designId!= null">  #{designId,jdbcType=INTEGER}, </if>
		<if test="designTemplateId!= null">  #{designTemplateId,jdbcType=INTEGER}, </if>
		<if test="designStyleId!= null">  #{designStyleId,jdbcType=INTEGER}, </if>
		<if test="picId!= null">  #{picId,jdbcType=INTEGER}, </if>
		<if test="modelId!= null">  #{modelId,jdbcType=INTEGER}, </if>
		<if test="model3dId!= null">  #{model3dId,jdbcType=INTEGER}, </if>
		<if test="modelU3dId!= null">  #{modelU3dId,jdbcType=INTEGER}, </if>
		<if test="webModelU3dId!= null">  #{webModelU3dId,jdbcType=INTEGER}, </if>
		<if test="iosModelU3dId!= null">  #{iosModelU3dId,jdbcType=INTEGER}, </if>
		<if test="ipadModelU3dId!= null">  #{ipadModelU3dId,jdbcType=INTEGER}, </if>
		<if test="pcModelU3dId!= null">  #{pcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="androidModelU3dId!= null">  #{androidModelU3dId,jdbcType=INTEGER}, </if>
		<if test="macBookpcModelU3dId!= null">  #{macBookpcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="configFileId!= null">  #{configFileId,jdbcType=INTEGER}, </if>
		<if test="spaceCommonId!= null">  #{spaceCommonId,jdbcType=INTEGER}, </if>
		<if test="planDesc!= null">  #{planDesc,jdbcType=VARCHAR}, </if>
		<if test="sysCode!= null">  #{sysCode,jdbcType=VARCHAR}, </if>
		<if test="creator!= null">  #{creator,jdbcType=VARCHAR}, </if>
		<if test="gmtCreate!= null">  #{gmtCreate,jdbcType=TIMESTAMP}, </if>
		<if test="modifier!= null">  #{modifier,jdbcType=VARCHAR}, </if>
		<if test="gmtModified!= null">  #{gmtModified,jdbcType=TIMESTAMP}, </if>
		<if test="isDeleted!= null">  #{isDeleted,jdbcType=INTEGER}, </if>
		<if test="remark!= null">  #{remark,jdbcType=VARCHAR}, </if>
		<if test="shareTotal!= null">#{shareTotal,jdbcType=INTEGER}, </if>
		<if test="isOpen!= null">#{isOpen,jdbcType=INTEGER}, </if>
		<if test="isChange!= null">#{isChange,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">#{isDecorated,jdbcType=INTEGER}, </if>
		<if test="draftState!= null">#{draftState,jdbcType=INTEGER}, </if>
		<if test="baiMoState!= null">#{baiMoState,jdbcType=INTEGER}, </if>
		<if test="stuffFinishState!= null">#{stuffFinishState,jdbcType=INTEGER}, </if>
		<if test="decorateFinishState!= null">#{decorateFinishState,jdbcType=INTEGER}, </if>
		<if test="coverPicId!= null">#{coverPicId,jdbcType=INTEGER}, </if>
		<if test="releaseTime!= null">#{releaseTime,jdbcType=TIMESTAMP}, </if>
		<if test="designRecommendedStyleId!= null">#{designRecommendedStyleId,jdbcType=INTEGER}, </if>
 		<if test="isRecommended!= null">#{isRecommended,jdbcType=INTEGER}, </if>
		<if test="isDefaultDecorate!= null">#{isDefaultDecorate,jdbcType=INTEGER}, </if>
		<if test="planNumber!= null">#{planNumber,jdbcType=VARCHAR}, </if>
		<if test="designSceneId!= null">#{designSceneId,jdbcType=INTEGER}, </if>
		<if test="visible!= null">#{visible,jdbcType=INTEGER}, </if>
		<if test="sceneModified!= null">#{sceneModified,jdbcType=INTEGER}, </if>
		<if test="recommendedPlanId!= null">  #{recommendedPlanId,jdbcType=INTEGER}, </if>
		<if test="businessType != null">  #{businessType,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerFileId!= null">#{spellingFlowerFileId,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerProduct!= null">#{spellingFlowerProduct,jdbcType=VARCHAR}, </if>
		</trim>
	</insert>

	<!-- **更新定义** -->
	<update id="updateByPrimaryKeySelective" parameterType="com.sandu.design.model.DesignPlan">
		update design_plan
		<set>
		<if test="planCode!= null">  plan_code = #{planCode,jdbcType=VARCHAR}, </if>
		<if test="planName!= null">  plan_name = #{planName,jdbcType=VARCHAR}, </if>
		<if test="userId!= null">  user_id = #{userId,jdbcType=INTEGER}, </if>
		<if test="mediaType!= null">  media_type = #{mediaType,jdbcType=INTEGER}, </if>
		<if test="designSourceType!= null">  design_source_type = #{designSourceType,jdbcType=INTEGER}, </if>
		<if test="designId!= null">  design_id = #{designId,jdbcType=INTEGER}, </if>
		<if test="designTemplateId!= null">  design_template_id = #{designTemplateId,jdbcType=INTEGER}, </if>
		<if test="designStyleId!= null">  design_style_id = #{designStyleId,jdbcType=INTEGER}, </if>
		<if test="picId!= null">  pic_id = #{picId,jdbcType=INTEGER}, </if>
		<if test="modelId!= null">  model_id = #{modelId,jdbcType=INTEGER}, </if>
		<if test="model3dId!= null">  model_3d_id = #{model3dId,jdbcType=INTEGER}, </if>
		<if test="modelU3dId!= null">  model_u3d_id = #{modelU3dId,jdbcType=INTEGER}, </if>
		<if test="webModelU3dId!= null">  web_model_u3d_id = #{webModelU3dId,jdbcType=INTEGER}, </if>
		<if test="iosModelU3dId!= null">  ios_model_u3d_id = #{iosModelU3dId,jdbcType=INTEGER}, </if>
		<if test="pcModelU3dId!= null">  pc_model_u3d_id = #{pcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="ipadModelU3dId!= null">  ipad_model_u3d_id = #{ipadModelU3dId,jdbcType=INTEGER}, </if>
		<if test="androidModelU3dId!= null">  android_model_u3d_id = #{androidModelU3dId,jdbcType=INTEGER}, </if>
		<if test="macBookpcModelU3dId!= null">  macBookpc_model_u3d_id = #{macBookpcModelU3dId,jdbcType=INTEGER}, </if>
		<if test="configFileId!= null">  config_file_id = #{configFileId,jdbcType=INTEGER}, </if>
		<if test="spaceCommonId!= null">  space_common_id = #{spaceCommonId,jdbcType=INTEGER}, </if>
		<if test="planDesc!= null">  plan_desc = #{planDesc,jdbcType=VARCHAR}, </if>
		<if test="sysCode!= null">  sys_code = #{sysCode,jdbcType=VARCHAR}, </if>
		<if test="creator!= null">  creator = #{creator,jdbcType=VARCHAR}, </if>
		<if test="gmtCreate!= null">  gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}, </if>
		<if test="modifier!= null">  modifier = #{modifier,jdbcType=VARCHAR}, </if>
		<if test="gmtModified!= null">  gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}, </if>
		<if test="isDeleted!= null">  is_deleted = #{isDeleted,jdbcType=INTEGER}, </if>
		<if test="remark!= null">  remark = #{remark,jdbcType=VARCHAR}, </if>
		<if test="shareTotal!= null">  share_total = #{shareTotal,jdbcType=INTEGER}, </if>
		<if test="isOpen!= null">  is_open = #{isOpen,jdbcType=INTEGER}, </if>
		<if test="isChange!= null">  is_change = #{isChange,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">  is_decorated = #{isDecorated,jdbcType=INTEGER}, </if>
		<if test="isDecorated!= null">  is_decorated = #{isDecorated,jdbcType=INTEGER}, </if>
		<if test="draftState!= null">  draft_state = #{draftState,jdbcType=INTEGER}, </if>
		<if test="baiMoState!= null">  baiMo_state = #{baiMoState,jdbcType=INTEGER}, </if>
		<if test="stuffFinishState!= null">  stuff_finish_state = #{stuffFinishState,jdbcType=INTEGER}, </if>
		<if test="decorateFinishState!= null">  decorate_finish_state = #{decorateFinishState,jdbcType=INTEGER}, </if>
		<if test="coverPicId!= null">cover_pic_Id = #{coverPicId,jdbcType=INTEGER}, </if>
		<if test="releaseTime!= null">release_time =#{releaseTime,jdbcType=TIMESTAMP}, </if>
		<if test="designRecommendedStyleId!= null">design_recommended_style_id = #{designRecommendedStyleId,jdbcType=INTEGER}, </if>
		<if test="effectsConfig!= null">effects_config = #{effectsConfig,jdbcType=VARCHAR}, </if>
		<if test="isRecommended!= null">is_recommended = #{isRecommended,jdbcType=INTEGER}, </if>
		<if test="isDefaultDecorate!= null">is_default_decorate = #{isDefaultDecorate,jdbcType=INTEGER}, </if>
		<if test="planNumber!= null">plan_number = #{planNumber,jdbcType=VARCHAR}, </if>
		<if test="designSceneId!= null">design_scene_id = #{designSceneId,jdbcType=INTEGER}, </if>
		<if test="visible!= null">visible = #{visible,jdbcType=INTEGER}, </if>
		<if test="sceneModified!= null and sceneModified > 0 ">scene_modified = #{sceneModified,jdbcType=INTEGER}, </if>
		<if test="planType!= null and planType > 0 "> plan_type = #{planType,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerFileId!= null">spelling_flower_file_id = #{spellingFlowerFileId,jdbcType=INTEGER}, </if>
		<if test="spellingFlowerProduct!= null">spelling_flower_product = #{spellingFlowerProduct,jdbcType=VARCHAR}, </if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- **删除定义** -->
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from design_plan
		where id = #{id,jdbcType=INTEGER}
	</delete>
	
	<!-- **常量定义** -->
	<sql id="All_Column_List">
		id,spelling_flower_product,spelling_flower_file_id,is_recommended,is_default_decorate,plan_number,design_recommended_style_id,release_time,cover_pic_Id,plan_code,plan_name,plan_source,house_id,living_id,residential_units_name,user_id,media_type,design_source_type,design_id,share_total,is_open,is_change,
		is_decorated,draft_state,baiMo_state,stuff_finish_state,decorate_finish_state,design_template_id,design_style_id,pic_id,model_id,model_3d_id,model_u3d_id,web_model_u3d_id,ios_model_u3d_id,ipad_model_u3d_id,pc_model_u3d_id,
		android_model_u3d_id,macBookpc_model_u3d_id,config_file_id,space_common_id,plan_desc,sys_code,creator,gmt_create,modifier,gmt_modified,is_deleted,remark,evening_file_id,dawn_file_id,night_file_id,effects_config,
		design_scene_id,visible,scene_modified,recommended_plan_id,business_type
	</sql>
	
	<!-- **结果定义** -->
	<resultMap id="AllResultMap" type="com.sandu.design.model.DesignPlan">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result  column="plan_code" property="planCode" jdbcType="VARCHAR" />
		<result  column="plan_name" property="planName" jdbcType="VARCHAR" />
		<result column="plan_source" property="planSource" jdbcType="VARCHAR"/>
		<result column="house_id" property="houseId" jdbcType="INTEGER"/>
		<result column="living_id" property="livingId" jdbcType="INTEGER"/>
		<result column="residential_units_name" property="residentialUnitsName" jdbcType="VARCHAR"/>
		<result  column="user_id" property="userId" jdbcType="INTEGER" />
		<result  column="media_type" property="mediaType" jdbcType="INTEGER" />
		<result  column="design_source_type" property="designSourceType" jdbcType="INTEGER" />
		<result  column="design_id" property="designId" jdbcType="INTEGER" />
		<result  column="design_template_id" property="designTemplateId" jdbcType="INTEGER" />
		<result  column="design_style_id" property="designStyleId" jdbcType="INTEGER" />
		<result  column="pic_id" property="picId" jdbcType="INTEGER" />
		<result  column="model_id" property="modelId" jdbcType="INTEGER" />
		<result  column="model_3d_id" property="model3dId" jdbcType="INTEGER" />
		<result  column="model_u3d_id" property="modelU3dId" jdbcType="INTEGER" />
		<result  column="web_model_u3d_id" property="webModelU3dId" jdbcType="INTEGER" />
		<result  column="ios_model_u3d_id" property="iosModelU3dId" jdbcType="INTEGER" />
		<result  column="ipad_model_u3d_id" property="ipadModelU3dId" jdbcType="INTEGER" />
		<result  column="pc_model_u3d_id" property="pcModelU3dId" jdbcType="INTEGER" />
		<result  column="android_model_u3d_id" property="androidModelU3dId" jdbcType="INTEGER" />
		<result  column="macBookpc_model_u3d_id" property="macBookpcModelU3dId" jdbcType="INTEGER" />
		<result  column="config_file_id" property="configFileId" jdbcType="INTEGER" />
		<result  column="space_common_id" property="spaceCommonId" jdbcType="INTEGER" />
		<result  column="space_function_id" property="spaceFunctionId" jdbcType="INTEGER" />
		<result  column="space_areas" property="spaceAreas" jdbcType="VARCHAR" />
		<result  column="plan_desc" property="planDesc" jdbcType="VARCHAR" />
		<result  column="sys_code" property="sysCode" jdbcType="VARCHAR" />
		<result  column="creator" property="creator" jdbcType="VARCHAR" />
		<result  column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
		<result  column="modifier" property="modifier" jdbcType="VARCHAR" />
		<result  column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
		<result  column="is_deleted" property="isDeleted" jdbcType="INTEGER" />
		<result  column="remark" property="remark" jdbcType="VARCHAR" />
		<result  column="share_total" property="shareTotal" jdbcType="INTEGER" />
		<result  column="is_open" property="isOpen" jdbcType="INTEGER" />
		<result  column="is_change" property="isChange" jdbcType="INTEGER" />
		<result  column="is_decorated" property="isDecorated" jdbcType="INTEGER" />
		<result  column="draft_state" property="draftState" jdbcType="INTEGER" />
		<result  column="baiMo_state" property="baiMoState" jdbcType="INTEGER" />
		<result  column="stuff_finish_state" property="stuffFinishState" jdbcType="INTEGER" />
		<result  column="decorate_finish_state" property="decorateFinishState" jdbcType="INTEGER" />
		<result  column="spelling_flower_file_id" property="spellingFlowerFileId" jdbcType="INTEGER" />
		<result  column="spelling_flower_product" property="spellingFlowerProduct" jdbcType="INTEGER" />
		<result  column="cover_pic_Id" property="coverPicId" jdbcType="INTEGER" />
		<result  column="release_time" property="releaseTime" jdbcType="TIMESTAMP" />
		<result  column="design_recommended_style_id" property="designRecommendedStyleId" jdbcType="INTEGER" />
 		<result  column="effects_config" property="effectsConfig" jdbcType="VARCHAR" />
 		<result  column="is_recommended" property="isRecommended" jdbcType="INTEGER" />
 		<result  column="is_default_decorate" property="isDefaultDecorate" jdbcType="INTEGER" />
 		<result  column="plan_number" property="planNumber" jdbcType="VARCHAR" />
 		<result  column="design_scene_id" property="designSceneId" jdbcType="INTEGER" />
 		<result  column="visible" property="visible" jdbcType="INTEGER" />
 		<result  column="scene_modified" property="sceneModified" jdbcType="INTEGER" />
 		<result  column="recommended_plan_id" property="recommendedPlanId" jdbcType="INTEGER" />
 		<result  column="business_type" property="businessType" jdbcType="INTEGER" />
	</resultMap>
	
	<!-- **查询定义** -->
	<!-- 按主键查询 -->
	<select id="selectByPrimaryKey" resultMap="AllResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="All_Column_List" />
		from design_plan
		where id = #{id,jdbcType=INTEGER}
	</select>
	
	<select id="getProductDTOList" resultType="com.sandu.product.model.dto.ProductDTO" parameterType="java.lang.Integer">
		SELECT d.product_id as productId, d.product_type_value as productTypeValue, ssd.valuekey as valueKey,d.pos_index_path as posIndexPath FROM
		(SELECT c.*,b.product_type_value,b.product_small_type_value  FROM (select a.* FROM  design_plan_product a WHERE a.plan_id = #{designPlanId} AND a.is_deleted = 0) c 
 		LEFT JOIN base_product b ON b.is_deleted = 0 AND c.init_product_id = b.id ) d 
		LEFT JOIN sys_dictionary bsd ON bsd.type='productType' AND bsd.value=d.product_type_value AND bsd.is_deleted=0
		INNER JOIN sys_dictionary ssd ON ssd.type=bsd.valuekey AND ssd.value= d.product_small_type_value AND ssd.is_deleted=0
	</select>
	
	<select id="getDesignPlanSource" resultType="int">
		 SELECT 
		  dt.origin 
		FROM
		  design_plan dp 
		  LEFT JOIN design_templet dt 
		    ON dp.design_template_id = dt.id 
		WHERE 
		  dp.id = #{designPlanId}
	</select>
	
	<select id="countGroundStructure" resultType="int">
		SELECT 
		  COUNT(sp.id)
		FROM
		  design_plan dp,
		  design_templet_product dtp,
		  structure_product sp
		WHERE dp.design_template_id = dtp.design_templet_id 
		  AND sp.id = dtp.product_group_id 
		  AND dtp.group_type = 1 
		  AND sp.structure_type = 'DJ' 
		  AND dp.is_deleted = 0 
		  AND dtp.is_deleted = 0 
		  AND sp.is_deleted = 0 
		  AND dp.id = #{designPlanId}
	</select>
	
	<select id="countGroundStructureProduct" resultType="int">
		SELECT 
		  COUNT(spd.product_id) 
		FROM
		  design_plan dp 
		  LEFT JOIN design_plan_product dpp 
		    ON dp.id = dpp.plan_id 
		  LEFT JOIN structure_product sp 
		    ON sp.id = dpp.plan_group_id 
		  LEFT JOIN structure_product_details spd 
		    ON sp.id = spd.structure_id 
		WHERE dpp.group_type = 1 
		  AND sp.structure_type = 'DJ' 
		  AND dp.is_deleted = 0 
		  AND dpp.is_deleted = 0 
		  AND sp.is_deleted = 0 
		  AND spd.is_deleted = 0 
		  AND dp.id = #{designPlanId}
	</select>
	
	<select id="selectIosDesignPlanInfo" resultMap="designPlanModelMap" parameterType="java.lang.Integer">
		SELECT
		dp.id,dp.residential_units_name,dp.plan_source,dp.`plan_code`,dp.`plan_name`,dp.`model_id`,dp.`config_file_id`,
		dp.`space_common_id`,dp.`design_template_id`,rm.`model_path`,rf.`file_path`,
		dt.`design_code`,sc.space_code,sc.space_name,sc.space_areas,sc.daylight_ios_u3d_model_id AS daylight_u3d_model_id,sc.dusklight_ios_u3d_model_id AS dusklight_u3d_model_id,sc.nightlight_ios_u3d_model_id AS nightlight_u3d_model_id,
		sd.`value`,sd.`name`,dp.spelling_flower_file_id,dp.spelling_flower_product
		FROM design_plan dp

		LEFT JOIN res_model rm ON rm.`id` = dp.`model_id` AND rm.`is_deleted` = 0

		LEFT JOIN res_design rf ON rf.`id` = dp.`config_file_id` AND rf.`is_deleted` = 0

		LEFT JOIN design_templet dt ON dt.`id` = dp.`design_template_id` 
		<!-- 注释掉 by huangsongbo 2018.5.4,应对情况:样板房删除,关联的设计方案应该也能正常进入 -->
		<!-- AND dt.`is_deleted` = 0 -->

		LEFT JOIN space_common sc ON sc.`id` = dp.`space_common_id` 
		<!-- 注释掉 by huangsongbo 2018.5.4,应对情况:样板房删除,关联的设计方案应该也能正常进入 -->
		<!-- AND sc.`is_deleted` = 0 -->

		LEFT JOIN sys_dictionary sd ON (sc.`space_function_id` = sd.`value` AND sd.`type` = 'houseType' AND sd.`is_deleted` = 0)

		WHERE dp.is_deleted = 0 and dp.id = #{id,jdbcType=INTEGER}
	</select>
	
	<select id="selectAndroidDesignPlanInfo" resultMap="designPlanModelMap" parameterType="java.lang.Integer">
		SELECT
		dp.id,dp.residential_units_name,dp.plan_source,dp.`plan_code`,dp.`plan_name`,dp.`model_id`,dp.`config_file_id`,
		dp.`space_common_id`,dp.`design_template_id`,rm.`model_path`,rf.`file_path`,
		dt.`design_code`,sc.space_code,sc.space_name,sc.space_areas,sc.daylight_android_u3d_model_id AS daylight_u3d_model_id,sc.dusklight_android_u3d_model_id AS dusklight_u3d_model_id,sc.nightlight_android_u3d_model_id AS nightlight_u3d_model_id,
		sd.`value`,sd.`name`,dp.spelling_flower_file_id,dp.spelling_flower_product
		FROM design_plan dp

		LEFT JOIN res_model rm ON rm.`id` = dp.`model_id` AND rm.`is_deleted` = 0

		LEFT JOIN res_design rf ON rf.`id` = dp.`config_file_id` AND rf.`is_deleted` = 0

		LEFT JOIN design_templet dt ON dt.`id` = dp.`design_template_id` 
		<!-- 注释掉 by huangsongbo 2018.5.4,应对情况:样板房删除,关联的设计方案应该也能正常进入 -->
		<!-- AND dt.`is_deleted` = 0 -->

		LEFT JOIN space_common sc ON sc.`id` = dp.`space_common_id` 
		<!-- 注释掉 by huangsongbo 2018.5.4,应对情况:样板房删除,关联的设计方案应该也能正常进入 -->
		<!-- AND sc.`is_deleted` = 0 -->

		LEFT JOIN sys_dictionary sd ON (sc.`space_function_id` = sd.`value` AND sd.`type` = 'houseType' AND sd.`is_deleted` = 0)

		WHERE dp.is_deleted = 0 and dp.id = #{id,jdbcType=INTEGER}
	</select>
	
</mapper>
