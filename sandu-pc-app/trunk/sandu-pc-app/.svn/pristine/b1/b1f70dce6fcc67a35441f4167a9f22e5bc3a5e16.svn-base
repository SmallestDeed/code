<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.living.dao.BaseLivingMapper">

    <resultMap id="listMap" type="com.sandu.living.model.output.BaseLivingVo">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="living_name" property="livingName" jdbcType="VARCHAR"/>
        <result column="area_name" property="areaName" jdbcType="VARCHAR"/>
        <result column="living_address" property="livingAddress" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 查询小区数量 -->
    <select id="count" resultType="java.lang.Integer"
            parameterType="com.sandu.living.model.input.BaseLivingSearch">
        select count(bl.id) from base_living bl
        left join base_area ba on bl.area_id = ba.area_code
        where bl.is_deleted = 0 and ba.is_deleted = 0
        <if test="livingName != null and livingName != ''">
            and bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
        </if>
        <if test="areaId != null and areaId != ''">
            and ba.long_code like CONCAT(CONCAT('%.',#{areaId,jdbcType=VARCHAR}),'.%')
        </if>
    </select>

    <!-- 查询小区列表 -->
    <select id="list" resultMap="listMap"
            parameterType="com.sandu.living.model.input.BaseLivingSearch">
        select bl.id,bl.living_name,ba.area_name,bl.living_address from base_living bl
        left join base_area ba on bl.area_id = ba.area_code
        where bl.is_deleted = 0 and ba.is_deleted = 0
        <if test="livingName != null and livingName != ''">
            and bl.living_name like CONCAT(CONCAT('%',#{livingName,jdbcType=VARCHAR}),'%')
        </if>
        <if test="areaId != null and areaId != ''">
            and ba.long_code like CONCAT(CONCAT('%',#{areaId,jdbcType=VARCHAR}),'%')
        </if>
        <if test="start != null and limit != null">
            LIMIT #{start}, #{limit}
        </if>
    </select>

</mapper>