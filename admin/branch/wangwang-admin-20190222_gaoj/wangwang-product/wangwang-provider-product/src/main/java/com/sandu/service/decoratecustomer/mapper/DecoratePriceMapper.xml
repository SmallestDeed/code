<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.decoratecustomer.dao.DecoratePriceMapper">
    <resultMap id="BaseResultMap" type="com.sandu.api.decoratecustomer.model.DecoratePrice">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="id" jdbcType="INTEGER" property="id"/>
        <result column="company_id" jdbcType="INTEGER" property="companyId"/>
        <result column="customer_id" jdbcType="INTEGER" property="customerId"/>
        <result column="proprietor_info_id" jdbcType="INTEGER" property="proprietorInfoId"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="bid_user_id" jdbcType="INTEGER" property="bidUserId"/>
        <result column="material_fee" jdbcType="VARCHAR" property="materialFee"/>
        <result column="check_fee" jdbcType="VARCHAR" property="checkFee"/>
        <result column="labour_fee" jdbcType="VARCHAR" property="labourFee"/>
        <result column="design_fee" jdbcType="VARCHAR" property="designFee"/>
        <result column="submit_time" jdbcType="TIMESTAMP" property="submitTime"/>
        <result column="start_time" jdbcType="TIMESTAMP" property="startTime"/>
        <result column="end_time" jdbcType="TIMESTAMP" property="endTime"/>
        <result column="creator" jdbcType="VARCHAR" property="creator"/>
        <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate"/>
        <result column="modifier" jdbcType="VARCHAR" property="modifier"/>
        <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
        <result column="is_deleted" jdbcType="INTEGER" property="isDeleted"/>
        <result column="price" jdbcType="INTEGER" property="price"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,company_id,customer_id,proprietor_info_id,status,bid_user_id,material_fee,check_fee,labour_fee,
        design_fee,submit_time,start_time,end_time,creator,gmt_create,modifier,gmt_modified,is_deleted,price
    </sql>

    <insert id="insert" keyProperty="id" useGeneratedKeys="true" keyColumn="id"
            parameterType="com.sandu.api.decoratecustomer.model.DecoratePrice">
        insert into decorate_price
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="customerId != null">
                customer_id,
            </if>
            <if test="proprietorInfoId != null">
                proprietor_info_id,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="bidUserId != null">
                bid_user_id,
            </if>
            <if test="materialFee != null">
                material_fee,
            </if>
            <if test="checkFee != null">
                check_fee,
            </if>
            <if test="labourFee != null">
                labour_fee,
            </if>
            <if test="designFee != null">
                design_fee,
            </if>
            <if test="submitTime != null">
                submit_time,
            </if>
            <if test="startTime != null">
                start_time,
            </if>
            <if test="endTime != null">
                end_time,
            </if>
            <if test="creator != null">
                creator,
            </if>
            <if test="gmtCreate != null">
                gmt_create,
            </if>
            <if test="modifier != null">
                modifier,
            </if>
            <if test="gmtModified != null">
                gmt_modified,
            </if>
            <if test="isDeleted != null">
                is_deleted,
            </if>
            <if test="price != null">
                price,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=INTEGER},
            </if>
            <if test="customerId != null">
                #{customerId,jdbcType=INTEGER},
            </if>
            <if test="proprietorInfoId != null">
                #{proprietorInfoId,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                #{status,jdbcType=TINYINT},
            </if>
            <if test="bidUserId != null">
                #{bidUserId,jdbcType=INTEGER},
            </if>
            <if test="materialFee != null">
                #{materialFee,jdbcType=VARCHAR},
            </if>
            <if test="checkFee != null">
                #{checkFee,jdbcType=VARCHAR},
            </if>
            <if test="labourFee != null">
                #{labourFee,jdbcType=VARCHAR},
            </if>
            <if test="designFee != null">
                #{designFee,jdbcType=VARCHAR},
            </if>
            <if test="submitTime != null">
                #{submitTime,jdbcType=TIMESTAMP},
            </if>
            <if test="startTime != null">
                #{startTime,jdbcType=TIMESTAMP},
            </if>
            <if test="endTime != null">
                #{endTime,jdbcType=TIMESTAMP},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="price != null">
                #{price},
            </if>
        </trim>
    </insert>

    <update id="updateByPrimaryKey" parameterType="com.sandu.api.decoratecustomer.model.DecoratePrice">
        update decorate_price
        <set>
            <if test="id != null">
                id = #{id,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                company_id = #{companyId,jdbcType=INTEGER},
            </if>
            <if test="customerId != null">
                customer_id = #{customerId,jdbcType=INTEGER},
            </if>
            <if test="proprietorInfoId != null">
                proprietor_info_id = #{proprietorInfoId,jdbcType=INTEGER},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=TINYINT},
            </if>
            <if test="bidUserId != null">
                bid_user_id = #{bidUserId,jdbcType=INTEGER},
            </if>
            <if test="materialFee != null">
                material_fee = #{materialFee,jdbcType=VARCHAR},
            </if>
            <if test="checkFee != null">
                check_fee = #{checkFee,jdbcType=VARCHAR},
            </if>
            <if test="labourFee != null">
                labour_fee = #{labourFee,jdbcType=VARCHAR},
            </if>
            <if test="designFee != null">
                design_fee = #{designFee,jdbcType=VARCHAR},
            </if>
            <if test="submitTime != null">
                submit_time = #{submitTime,jdbcType=TIMESTAMP},
            </if>
            <if test="startTime != null">
                start_time = #{startTime,jdbcType=TIMESTAMP},
            </if>
            <if test="endTime != null">
                end_time = #{endTime,jdbcType=TIMESTAMP},
            </if>
            <if test="creator != null">
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                is_deleted = #{isDeleted,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>

    <update id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        update decorate_price set is_deleted = 1
        where id IN
        <foreach separator="," open="(" close=")" collection="decoratePriceIds" item="decoratePriceId">
            #{decoratePriceId}
        </foreach>
    </update>

    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from decorate_price
        where id = #{decoratePriceId,jdbcType=INTEGER}
    </select>


    <select id="listByCustomerIds" resultType="com.sandu.api.decoratecustomer.model.DecoratePrice">
        select
        <include refid="Base_Column_List"/>
        from decorate_price
        where is_deleted = 0 and customer_id in
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>

    </select>
    <select id="listCompanyIdForDispatchPrice" resultType="java.lang.Integer">

         select bc.id  from base_company bc
         inner  join proprietor_info pi on bc.city_code =pi.city_code
          left join  decorate_price dp on bc.id = dp.company_id
        where bc.business_type = 5 and bc.is_deleted = 0
        and bc.is_receive_platform_dispatch = 1
        and pi.id = #{proprietorInfoId}
        group by bc.id order by id,count(1)
        limit #{limit}
    </select>
    <select id="findDispatchCustomerIds" resultType="java.lang.Integer">
        select distinct customer_id from decorate_price
        where is_deleted = 0 and
        customer_id in
        <foreach collection="ids" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>

    </select>


</mapper>