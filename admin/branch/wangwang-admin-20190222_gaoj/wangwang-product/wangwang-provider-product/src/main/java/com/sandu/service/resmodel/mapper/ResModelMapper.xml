<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.resmodel.dao.ResModelDao">

    <sql id="Base_Column_List">
        id, model_code, model_name, model_file_name, model_type, model_size, model_suffix,
        model_level, model_path, model_desc, sys_code, creator, gmt_create, modifier, gmt_modified,
        is_deleted, model_ordering, file_key, file_keys, business_ids, att4, att5, att6,

        date_att1, date_att2, business_id, num_att2, num_att3, num_att4, remark, LENGTH,
        height, width, min_height, is_model_share, is_decompress, category_names, category_ids, trans_status, model_model_num, thumb_pic_path, file_3du_path as file3duPath
    </sql>
    <insert id="addResModel" parameterType="com.sandu.api.resmodel.model.ResModel"
            useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        insert into res_model
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="modelCode != null">
                model_code,
            </if>
            <if test="modelName != null">
                model_name,
            </if>
            <if test="modelFileName != null">
                model_file_name,
            </if>
            <if test="modelType != null">
                model_type,
            </if>
            <if test="modelSize != null">
                model_size,
            </if>
            <if test="modelSuffix != null">
                model_suffix,
            </if>
            <if test="modelLevel != null">
                model_level,
            </if>
            <if test="modelPath != null">
                model_path,
            </if>
            <if test="modelDesc != null">
                model_desc,
            </if>
            <if test="sysCode != null">
                sys_code,
            </if>
            <if test="creator != null">
                creator,
            </if>
            <if test="gmtCreate != null">
                gmt_create,
            </if>
            <if test="modifier != null">
                modifier,
            </if>
            <if test="gmtModified != null">
                gmt_modified,
            </if>
            <if test="isDeleted != null">
                is_deleted,
            </if>
            <if test="modelOrdering != null">
                model_ordering,
            </if>
            <if test="fileKey != null">
                file_key,
            </if>
            <if test="fileKeys != null">
                file_keys,
            </if>
            <if test="businessIds != null">
                business_ids,
            </if>
            <if test="att4 != null">
                att4,
            </if>
            <if test="att5 != null">
                att5,
            </if>
            <if test="att6 != null">
                att6,
            </if>
            <if test="dateAtt1 != null">
                date_att1,
            </if>
            <if test="dateAtt2 != null">
                date_att2,
            </if>
            <if test="businessId != null">
                business_id,
            </if>
            <if test="numAtt2 != null">
                num_att2,
            </if>
            <if test="numAtt3 != null">
                num_att3,
            </if>
            <if test="numAtt4 != null">
                num_att4,
            </if>
            <if test="remark != null">
                remark,
            </if>
            <if test="length != null">
                LENGTH,
            </if>
            <if test="height != null">
                height,
            </if>
            <if test="width != null">
                width,
            </if>
            <if test="minHeight != null">
                min_height,
            </if>
            <if test="isModelShare != null">
                is_model_share,
            </if>
            <if test="isDecompress != null">
                is_decompress,
            </if>
            <if test="modelModelNum != null">
                model_model_num,
            </if>
            <if test="categoryIds != null">
                category_ids,
            </if>
            <if test="categoryNames != null">
                category_names,
            </if>
            <if test="transStatus != null">
                trans_status,
            </if>
            <if test="thumbPicPath != null">
                thumb_pic_path,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="file3duPath != null">
                file_3du_path,
            </if>
            <if test="originId !=null">
                origin_id,
            </if>
            <if test="typeMark !=null">
                type_mark,
            </if>
            <if test="smallTypeMark !=null">
                small_type_mark,
            </if>
            <if test="mainModelFlag !=null">
                main_model_flag,
            </if>
            <if test="transMachineIp !=null">
                trans_machine_ip,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="modelCode != null">
                #{modelCode,jdbcType=VARCHAR},
            </if>
            <if test="modelName != null">
                #{modelName,jdbcType=VARCHAR},
            </if>
            <if test="modelFileName != null">
                #{modelFileName,jdbcType=VARCHAR},
            </if>
            <if test="modelType != null">
                #{modelType,jdbcType=VARCHAR},
            </if>
            <if test="modelSize != null">
                #{modelSize,jdbcType=VARCHAR},
            </if>
            <if test="modelSuffix != null">
                #{modelSuffix,jdbcType=VARCHAR},
            </if>
            <if test="modelLevel != null">
                #{modelLevel,jdbcType=VARCHAR},
            </if>
            <if test="modelPath != null">
                #{modelPath,jdbcType=VARCHAR},
            </if>
            <if test="modelDesc != null">
                #{modelDesc,jdbcType=VARCHAR},
            </if>
            <if test="sysCode != null">
                #{sysCode,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="modelOrdering != null">
                #{modelOrdering,jdbcType=INTEGER},
            </if>
            <if test="fileKey != null">
                #{fileKey,jdbcType=VARCHAR},
            </if>
            <if test="fileKeys != null">
                #{fileKeys,jdbcType=VARCHAR},
            </if>
            <if test="businessIds != null">
                #{businessIds,jdbcType=VARCHAR},
            </if>
            <if test="att4 != null">
                #{att4,jdbcType=VARCHAR},
            </if>
            <if test="att5 != null">
                #{att5,jdbcType=VARCHAR},
            </if>
            <if test="att6 != null">
                #{att6,jdbcType=VARCHAR},
            </if>
            <if test="dateAtt1 != null">
                #{dateAtt1,jdbcType=TIMESTAMP},
            </if>
            <if test="dateAtt2 != null">
                #{dateAtt2,jdbcType=TIMESTAMP},
            </if>
            <if test="businessId != null">
                #{businessId,jdbcType=INTEGER},
            </if>
            <if test="numAtt2 != null">
                #{numAtt2,jdbcType=INTEGER},
            </if>
            <if test="numAtt3 != null">
                #{numAtt3,jdbcType=DECIMAL},
            </if>
            <if test="numAtt4 != null">
                #{numAtt4,jdbcType=DECIMAL},
            </if>
            <if test="remark != null">
                #{remark,jdbcType=VARCHAR},
            </if>
            <if test="length != null">
                #{length,jdbcType=INTEGER},
            </if>
            <if test="height != null">
                #{height,jdbcType=INTEGER},
            </if>
            <if test="width != null">
                #{width,jdbcType=INTEGER},
            </if>
            <if test="minHeight != null">
                #{minHeight,jdbcType=INTEGER},
            </if>
            <if test="isModelShare != null">
                #{isModelShare,jdbcType=INTEGER},
            </if>
            <if test="isDecompress != null">
                #{isDecompress,jdbcType=INTEGER},
            </if>
            <if test="modelModelNum != null">
                #{modelModelNum,jdbcType=INTEGER},
            </if>
            <if test="categoryIds != null">
                #{categoryIds},
            </if>
            <if test="categoryNames != null">
                #{categoryNames},
            </if>
            <if test="transStatus != null">
                #{transStatus},
            </if>
            <if test="thumbPicPath != null">
                #{thumbPicPath},
            </if>
            <if test="companyId != null">
                #{companyId},
            </if>
            <if test="file3duPath != null">
                #{file3duPath},
            </if>
            <if test="originId != null">
                #{originId},
            </if>
            <if test="typeMark !=null">
                #{typeMark},
            </if>
            <if test="smallTypeMark !=null">
                #{smallTypeMark},
            </if>
            <if test="mainModelFlag !=null">
                #{mainModelFlag},
            </if>
            <if test="transMachineIp !=null">
                #{transMachineIp},
            </if>
        </trim>
    </insert>

    <insert id="addResModelList" parameterType="com.sandu.api.resmodel.model.ResModel" useGeneratedKeys="true"
            keyProperty="id" keyColumn="id">
        INSERT INTO res_model
        (model_code, model_name, model_file_name, model_type, model_size, model_suffix, model_level,
        model_path, model_desc, sys_code, creator, gmt_create, modifier, gmt_modified, is_deleted,
        model_ordering, file_key, file_keys, business_ids, att4, att5, att6,
        business_id, num_att2, num_att3, num_att4, remark, LENGTH, height, width, min_height, is_model_share,
        is_decompress, category_ids, thumb_pic_path, category_names, trans_status, model_model_num, company_id,
        product_id, file_3du_path, origin_id)
        VALUES
        <foreach collection="models" separator="," item="model">
            (
            #{model.modelCode},
            #{model.modelName},
            #{model.modelFileName},
            #{model.modelType},
            #{model.modelSize},
            #{model.modelSuffix},
            #{model.modelLevel},
            #{model.modelPath},
            #{model.modelDesc},
            #{model.sysCode},
            #{model.creator},
            #{model.gmtCreate},
            #{model.modifier},
            #{model.gmtModified},
            #{model.isDeleted},
            #{model.modelOrdering},
            #{model.fileKey},
            #{model.fileKeys},
            #{model.businessIds},
            #{model.att4},
            #{model.att5},
            #{model.att6},
            #{model.businessId},
            #{model.numAtt2},
            #{model.numAtt3},
            #{model.numAtt4},
            #{model.remark},
            #{model.length},
            #{model.height},
            #{model.width},
            #{model.minHeight},
            #{model.isModelShare},
            #{model.isDecompress},
            #{model.categoryIds},
            #{model.thumbPicPath},
            #{model.categoryNames},
            #{model.transStatus},
            #{model.modelModelNum},
            #{model.companyId},
            #{model.productId},
            #{model.file3duPath},
            #{model.originId}
            )
        </foreach>
    </insert>


    <update id="saveResModel" parameterType="com.sandu.api.resmodel.model.ResModel">
        update res_model
        <set>
            <if test="modelCode != null">
                model_code = #{modelCode,jdbcType=VARCHAR},
            </if>
            <if test="modelName != null">
                model_name = #{modelName,jdbcType=VARCHAR},
            </if>
            <if test="modelFileName != null">
                model_file_name = #{modelFileName,jdbcType=VARCHAR},
            </if>
            <if test="modelType != null">
                model_type = #{modelType,jdbcType=VARCHAR},
            </if>
            <if test="modelSize != null">
                model_size = #{modelSize,jdbcType=VARCHAR},
            </if>
            <if test="modelSuffix != null">
                model_suffix = #{modelSuffix,jdbcType=VARCHAR},
            </if>
            <if test="modelLevel != null">
                model_level = #{modelLevel,jdbcType=VARCHAR},
            </if>
            <if test="modelPath != null">
                model_path = #{modelPath,jdbcType=VARCHAR},
            </if>
            <if test="modelDesc != null">
                model_desc = #{modelDesc,jdbcType=VARCHAR},
            </if>
            <if test="sysCode != null">
                sys_code = #{sysCode,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                is_deleted = #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="modelOrdering != null">
                model_ordering = #{modelOrdering,jdbcType=INTEGER},
            </if>
            <if test="fileKey != null">
                file_key = #{fileKey,jdbcType=VARCHAR},
            </if>
            <if test="fileKeys != null">
                file_keys = #{fileKeys,jdbcType=VARCHAR},
            </if>
            <if test="businessIds != null">
                business_ids = #{businessIds,jdbcType=VARCHAR},
            </if>
            <if test="att4 != null">
                att4 = #{att4,jdbcType=VARCHAR},
            </if>
            <if test="att5 != null">
                att5 = #{att5,jdbcType=VARCHAR},
            </if>
            <if test="att6 != null">
                att6 = #{att6,jdbcType=VARCHAR},
            </if>
            <if test="dateAtt1 != null">
                date_att1 = #{dateAtt1,jdbcType=TIMESTAMP},
            </if>
            <if test="dateAtt2 != null">
                date_att2 = #{dateAtt2,jdbcType=TIMESTAMP},
            </if>
            <if test="businessId != null">
                business_id = #{businessId,jdbcType=INTEGER},
            </if>
            <if test="numAtt2 != null">
                num_att2 = #{numAtt2,jdbcType=INTEGER},
            </if>
            <if test="numAtt3 != null">
                num_att3 = #{numAtt3,jdbcType=DECIMAL},
            </if>
            <if test="numAtt4 != null">
                num_att4 = #{numAtt4,jdbcType=DECIMAL},
            </if>
            <if test="remark != null">
                remark = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="length != null">
                LENGTH = #{length,jdbcType=INTEGER},
            </if>
            <if test="height != null">
                height = #{height,jdbcType=INTEGER},
            </if>
            <if test="width != null">
                width = #{width,jdbcType=INTEGER},
            </if>
            <if test="minHeight != null">
                min_height = #{minHeight,jdbcType=INTEGER},
            </if>
            <if test="isModelShare != null">
                is_model_share = #{isModelShare,jdbcType=INTEGER},
            </if>
            <if test="isDecompress != null">
                is_decompress = #{isDecompress,jdbcType=INTEGER},
            </if>
            <if test="modelModelNum != null">
                model_model_num = #{modelModelNum},
            </if>
            <if test="categoryIds != null">
                category_ids = #{categoryIds},
            </if>
            <if test="categoryNames != null">
                category_names = #{categoryNames},
            </if>
            <if test="transStatus != null">
                trans_status = #{transStatus},
            </if>
            <if test="thumbPicPath != null">
                thumb_pic_path = #{thumbPicPath},
            </if>
            <if test="companyId != null">
                company_id = #{companyId},
            </if>
            <if test="productId != null">
                product_id = #{productId},
            </if>
            <if test="file3duPath != null">
                file_3du_path = #{file3duPath},
            </if>
            <if test="smallTypeMark != null">
                small_Type_Mark = #{smallTypeMark},
            </if>
            <if test="typeMark != null">
                type_Mark = #{typeMark},
            </if>
            <if test="mainModelFlag !=null">
                main_Model_Flag = #{mainModelFlag},
            </if>
            <if test="transMachineIp !=null">
                trans_machine_ip = #{transMachineIp},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateByPrimaryKeySelective" parameterType="com.sandu.api.resmodel.model.ResModel">
        update res_model
        <set>
            <if test="modelCode != null">
                model_code = #{modelCode,jdbcType=VARCHAR},
            </if>
            <if test="modelFileName != null">
                model_file_name = #{modelFileName,jdbcType=VARCHAR},
            </if>
            <if test="modelType != null">
                model_type = #{modelType,jdbcType=VARCHAR},
            </if>
            <if test="modelSize != null">
                model_size = #{modelSize,jdbcType=VARCHAR},
            </if>
            <if test="modelSuffix != null">
                model_suffix = #{modelSuffix,jdbcType=VARCHAR},
            </if>
            <if test="modelLevel != null">
                model_level = #{modelLevel,jdbcType=VARCHAR},
            </if>
            <if test="modelPath != null and modelPath != ''">
                model_path = #{modelPath,jdbcType=VARCHAR},
            </if>
            <if test="file3duPath != null and file3duPath != ''">
                file_3du_Path = #{file3duPath,jdbcType=VARCHAR},
            </if>
            <if test="modelDesc != null">
                model_desc = #{modelDesc,jdbcType=VARCHAR},
            </if>
            <if test="sysCode != null">
                sys_code = #{sysCode,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
            </if>
            <if test="modifier != null">
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
            <if test="gmtModified != null">
                gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
            </if>
            <if test="isDeleted != null">
                is_deleted = #{isDeleted,jdbcType=INTEGER},
            </if>
            <if test="modelOrdering != null">
                model_ordering = #{modelOrdering,jdbcType=INTEGER},
            </if>
            <if test="fileKey != null">
                file_key = #{fileKey,jdbcType=VARCHAR},
            </if>
            <if test="fileKeys != null">
                file_keys = #{fileKeys,jdbcType=VARCHAR},
            </if>
            <if test="businessIds != null">
                business_ids = #{businessIds,jdbcType=VARCHAR},
            </if>
            <if test="att4 != null">
                att4 = #{att4,jdbcType=VARCHAR},
            </if>
            <if test="att5 != null">
                att5 = #{att5,jdbcType=VARCHAR},
            </if>
            <if test="att6 != null">
                att6 = #{att6,jdbcType=VARCHAR},
            </if>
            <if test="dateAtt1 != null">
                date_att1 = #{dateAtt1,jdbcType=TIMESTAMP},
            </if>
            <if test="dateAtt2 != null">
                date_att2 = #{dateAtt2,jdbcType=TIMESTAMP},
            </if>
            <if test="businessId != null">
                business_id = #{businessId,jdbcType=INTEGER},
            </if>
            <if test="numAtt2 != null">
                num_att2 = #{numAtt2,jdbcType=INTEGER},
            </if>
            <if test="numAtt3 != null">
                num_att3 = #{numAtt3,jdbcType=DECIMAL},
            </if>
            <if test="numAtt4 != null">
                num_att4 = #{numAtt4,jdbcType=DECIMAL},
            </if>
            <if test="remark != null">
                remark = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="length != null">
                LENGTH = #{length,jdbcType=INTEGER},
            </if>
            <if test="height != null">
                height = #{height,jdbcType=INTEGER},
            </if>
            <if test="width != null">
                width = #{width,jdbcType=INTEGER},
            </if>
            <if test="minHeight != null">
                min_height = #{minHeight,jdbcType=INTEGER},
            </if>
            <if test="isModelShare != null">
                is_model_share = #{isModelShare,jdbcType=INTEGER},
            </if>
            <if test="isDecompress != null">
                is_decompress = #{isDecompress,jdbcType=INTEGER},
            </if>
            <if test="transStatus != null">
                trans_status = #{transStatus,jdbcType=INTEGER},
            </if>
            <if test="thumbPicPath != null">
                thumb_pic_path = #{thumbPicPath},
            </if>
            <if test="transMachineIp !=null">
                trans_machine_ip = #{transMachineIp},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="deleteResModel" parameterType="java.lang.Long">
        UPDATE res_model
        SET is_deleted = 1,
         gmt_modified = now()
        WHERE id = #{id}
    </update>
    <delete id="deleteResModelsByProductIds">
        UPDATE res_model
        SET is_deleted = 1
        WHERE product_id in
        <foreach collection="ids" item="id" separator="," close=")" open="(">
            #{id}
        </foreach>
    </delete>

    <select id="getResModelDetail" resultType="com.sandu.api.resmodel.model.ResModel" parameterType="java.lang.Long">
        select
        *
        from res_model
        where id = #{id,jdbcType=BIGINT}
    </select>

    <!--  bak  -->
    <!--<select id="listResModel" resultType="com.sandu.api.resmodel.model.bo.ModelListBO"-->
    <!--parameterType="com.sandu.api.resmodel.input.ResModelQuery">-->
    <!--select-->
    <!--rm.id as id,-->
    <!--rm.model_name as modelName,-->
    <!--rm.category_ids as categoryIds,-->
    <!--rm.category_names as categoryNames,-->
    <!--rm.model_code as modelCode,-->
    <!--rm.trans_status as transStatus,-->
    <!--rm.gmt_modified as gmtModified,-->
    <!--rm.model_desc as modelDesc,-->
    <!--rm.remark as remark,-->
    <!--rm.thumb_pic_path,-->
    <!--rm.creator as author,-->
    <!--rm.model_model_num as modelModelNum,-->
    <!--rm.LENGTH ,-->
    <!--rm.width,-->
    <!--rm.height,-->
    <!--rm.small_type_mark,-->
    <!--rm.type_mark,-->
    <!--rm.main_model_flag,-->
    <!--trm.company_id as originId,-->
    <!--ifnull(bc.company_name,'内部制作') as modelOrigin-->
    <!--from res_model rm-->
    <!--left join res_model trm on rm.origin_id = trm.id-->
    <!--left join base_company bc on bc.id = trm.company_id-->
    <!--where rm.is_deleted = 0-->

    <!--<if test="companyId !=null">-->
    <!--and rm.company_id = #{companyId}-->
    <!--</if>-->
    <!--<if test="isUsed == 1">-->
    <!--and rm.product_id > 0-->
    <!--</if>-->
    <!--<if test="modelModelNum != null and modelModelNum != ''">-->
    <!--and rm.model_model_num like concat('%',#{modelModelNum},'%')-->
    <!--</if>-->
    <!--<if test="isUsed == 0">-->
    <!--and rm.product_id = 0-->
    <!--</if>-->
    <!--&lt;!&ndash;<if test="categoryCodes !=null and categoryCodes !=''">&ndash;&gt;-->
    <!--&lt;!&ndash; and rm.category_ids like concat('%',#{categoryCodes},'%')&ndash;&gt;-->
    <!--&lt;!&ndash;</if>&ndash;&gt;-->
    <!--<if test="transStatus !=null and transStatus !=''">-->
    <!--and rm.trans_status = #{transStatus}-->
    <!--</if>-->
    <!--<if test="modelCode !=null and modelCode !=''">-->
    <!--and rm.model_code like concat(#{modelCode},'%')-->
    <!--</if>-->
    <!--<if test="modelName !=null and modelName !=''">-->
    <!--and rm.model_name like concat(#{modelName},'%')-->
    <!--</if>-->
    <!--<if test="modelModelNum !=null and modelModelNum !=''">-->
    <!--and rm.model_model_num like concat(#{modelModelNum},'%')-->
    <!--</if>-->
    <!--<if test="author != null and author != ''">-->
    <!--and rm.creator like concat('%',#{author},'%')-->
    <!--</if>-->
    <!--<if test="modelType != null and modelType != ''">-->
    <!--and rm.small_type_mark = #{modelType}-->
    <!--</if>-->
    <!--<if test="existModelIds != null and existModelIds.size > 0">-->
    <!--and rm.id not in-->
    <!--<foreach collection="existModelIds" open="(" close=")" separator="," item="id">-->
    <!--#{id}-->
    <!--</foreach>-->

    <!--</if>-->
    <!--and rm.file_key != 'system.resTexture.textureBallFile'-->
    <!--order by rm.id desc-->
    <!--</select>-->
    <select id="listResModel" resultType="com.sandu.api.resmodel.model.bo.ModelListBO"
            parameterType="com.sandu.api.resmodel.input.ResModelQuery">
        select
        rm.id as id,
        rm.model_name as modelName,
        rm.category_ids as categoryIds,
        rm.category_names as categoryNames,
        rm.model_code as modelCode,
        rm.trans_status as transStatus,
        rm.gmt_modified as gmtModified,
        rm.model_desc as modelDesc,
        rm.remark as remark,
        rm.thumb_pic_path,
        rm.creator as author,
        rm.model_model_num as modelModelNum,
        rm.LENGTH ,
        rm.width,
        rm.height,
        rm.small_type_mark,
        rm.type_mark,
        rm.main_model_flag,
        rm.origin_Id
        from res_model rm FORCE INDEX(idx_deleted)
        where 1 = 1
        <if test="companyId !=null">
            and rm.company_id = #{companyId}
        </if>
        and rm.is_deleted = 0
        <if test="isUsed == 1">
            and rm.product_id > 0
        </if>
        <if test="modelModelNum != null and modelModelNum != ''">
            and rm.model_model_num like concat('%',#{modelModelNum},'%')
        </if>
        <if test="isUsed == 0">
            and rm.product_id = 0
        </if>
        <!--<if test="categoryCodes !=null and categoryCodes !=''">-->
        <!-- and rm.category_ids like concat('%',#{categoryCodes},'%')-->
        <!--</if>-->
        <if test="transStatus !=null and transStatus !=''">
            and rm.trans_status = #{transStatus}
        </if>
        <if test="modelCode !=null and modelCode !=''">
            and rm.model_code like concat(#{modelCode},'%')
        </if>
        <if test="modelName !=null and modelName !=''">
            and rm.model_name like concat(#{modelName},'%')
        </if>
        <if test="modelModelNum !=null and modelModelNum !=''">
            and rm.model_model_num like concat(#{modelModelNum},'%')
        </if>
        <if test="author != null and author != ''">
            and rm.creator like concat('%',#{author},'%')
        </if>
        <if test="modelType != null and modelType != ''">
            and rm.small_type_mark = #{modelType}
        </if>
        <if test="existModelIds != null and existModelIds.size > 0">
            and rm.id not in
            <foreach collection="existModelIds" open="(" close=")" separator="," item="id">
                #{id}
            </foreach>
        </if>
        and rm.file_key != 'system.resTexture.textureBallFile'

        <if test="usedModelIds != null and usedModelIds.size > 0">
            union
            select
            rm.id as id,
            rm.model_name as modelName,
            rm.category_ids as categoryIds,
            rm.category_names as categoryNames,
            rm.model_code as modelCode,
            rm.trans_status as transStatus,
            rm.gmt_modified as gmtModified,
            rm.model_desc as modelDesc,
            rm.remark as remark,
            rm.thumb_pic_path,
            rm.creator as author,
            rm.model_model_num as modelModelNum,
            rm.LENGTH ,
            rm.width,
            rm.height,
            rm.small_type_mark,
            rm.type_mark,
            rm.main_model_flag,
            rm.origin_Id
            from res_model rm
            where rm.id in
            <foreach collection="usedModelIds" open="(" close=")" separator="," item="id">
                #{id}
            </foreach>
        </if>

        order by id desc
    </select>

    <select resultType="java.lang.String" id="getMaxId">
        SELECT max(id)
        FROM res_model
    </select>

    <select id="getModelByIds" resultType="com.sandu.api.resmodel.model.ResModel">
        select id, model_code, model_name, trans_status, model_path,file_3du_path
        from res_model
        where 1= 1
        <if test="modelIds!=null and modelIds.size > 0">
            and id in
            <foreach collection="modelIds" open="(" close=")" item="id" separator=",">
                #{id}
            </foreach>
        </if>
    </select>

    <select id="getModelTextureInfoByModelId" resultType="com.sandu.api.resmodel.model.bo.ModelTextureInfoBO">
        SELECT
            area.id           AS areaId,
            area.model_id     AS modelId,
            area.`code`       AS areaCode,
            area.`name`       AS areaName,
            text.texture_id   AS textureId,
            text.affect_price AS affectPrice,
            text.is_default   AS isDefault
        FROM
            model_area_rel area
            LEFT JOIN model_area_texture_rel text ON area.id = text.area_id
        WHERE
            area.model_id = #{modelId}

    </select>

    <select id="getFirstNoneTransModel" resultType="com.sandu.api.resmodel.model.ResModel">
        <!--select-->
        <!--<include refid="Base_Column_List"/>-->
        <!--from res_model where id = (SELECT min(id)-->
        <!--FROM (SELECT id-->
        <!--FROM res_model-->
        <!--WHERE trans_status = 'NONE' and is_deleted = 0 and trans_machine_ip = #{machineIp}) t)-->
        SELECT *
        FROM res_model
        WHERE trans_status = 'NONE' and is_deleted = 0 and trans_machine_ip = #{machineIp}
        and model_code like 'M%'
        order by id asc limit 1
    </select>
    <select id="listModelByIds" resultType="com.sandu.api.resmodel.model.bo.ModelListBO">
        select
        rm.id,
        rm.model_code,
        rm.model_name,
        rm.model_path,
        bp.product_name as concerProductName,
        bp.id AS concerProductId,
        bp.product_code as concerProductcode
        from res_model rm
        LEFT JOIN base_product bp
        on rm.id = bp.windows_u3dmodel_id where rm.id IN
        <foreach collection="list" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>
    <select id="listDeliveredCompanyIds" resultType="java.lang.Long">
        select company_id from res_model where origin_id = #{modelId} and is_deleted = 0
    </select>
    
    <select id="queryModelByCode"  resultType="com.sandu.api.resmodel.model.ResModel">
    	SELECT * FROM res_model WHERE company_id = #{companyId} AND model_code 
    	like concat(#{modelCode},'%') limit 1
    </select>
    
    
    <select id="getModelTextureInfoByModelIds" resultType="com.sandu.api.resmodel.model.bo.ModelTextureInfoBO">
        SELECT
        area.id AS areaId,
        area.model_id AS modelId,
        area.`code` AS areaCode,
        area.`name` AS areaName,
        text.texture_id AS textureId,
        text.affect_price AS affectPrice,
        text.is_default AS isDefault
        FROM
        model_area_rel area
        LEFT JOIN model_area_texture_rel text ON area.id = text.area_id
        WHERE
        area.model_id in
        <foreach collection="modelId" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </select>
    <select id="listModelOriginInfoByModelIds" resultType="com.sandu.api.resmodel.model.bo.ModelListBO">
        select
        rm.id,
        ifnull(bc.company_name,'内部制作') as modelOrigin
        from res_model rm
        left join base_company bc on bc.id = rm.company_id
        where rm.id in
        <foreach collection="modelIds" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </select>
    <select id="listModelForFixPath" resultType="com.sandu.api.resmodel.model.ResModel">
        SELECT id,model_type,file_key,model_path,file_3du_path,thumb_pic_path,gmt_create,remark
          FROM res_model WHERE  company_id = 767 and model_path LIKE '/windowsPc%' and  (remark not like '迁移数据_%' or remark is null)
           order by  id desc limit #{limit};
    </select>

    <update id="resetProductId">
        update res_model
        set product_id = 0
        where product_id in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </update>
</mapper>