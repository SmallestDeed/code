<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sandu.service.solution.dao.DesignPlan2cPlatformMapper" >
  <sql id="Base_Column_List" >
    id, plan_id, platform_id, putaway_state, design_plan_type, allot_state, sys_code, 
    creator, gmt_create, user_id, modifier, gmt_modified, is_deleted, remark
  </sql>
  <select id="selectByPrimaryKey" resultType="com.sandu.api.solution.model.DesignPlan2cPlatform" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from design_plan_2c_platform
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectByPlanIdAndFormId" resultType="com.sandu.api.solution.model.DesignPlan2cPlatform">
    select
    id
    from design_plan_2c_platform
    where plan_id = #{planId} and platform_id = #{platformId}
    <if test="planType == 3">
      and design_plan_type = #{planType}
    </if>
    <if test="planType != 3">
      and design_plan_type != #{planType}
    </if>
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from design_plan_2c_platform
    where id = #{id,jdbcType=BIGINT}
  </delete>
  
  <!-- 根据方案和平台id删除 -->
  <delete id="deleteByPlanId">
  	delete from design_plan_2c_platform
    where 1=1
   	 <choose>
    	<when test="planIds!= null and planIds.size > 0">
	    	 and  plan_id in
		    <foreach collection="planIds" item="planId" separator="," open="(" close=")">
		      #{planId}
		    </foreach>
    	</when>
    	<otherwise>
    		and 1=2
    	</otherwise>
    </choose>
    <if test="platformIds!= null and platformIds.size > 0">
    	 and  platform_id in
	    <foreach collection="platformIds" item="platformId" separator="," open="(" close=")">
	      #{platformId}
	    </foreach>
    </if>
  </delete>
  
    <insert id="insertRelListIfNotExist">
		INSERT into design_plan_2c_platform
		(plan_id, platform_id, putaway_state, design_plan_type, allot_state,
    	creator, gmt_create, modifier, gmt_modified, is_deleted)
		VALUES 
		<foreach collection="list" item="tmp" separator=",">
			(#{tmp.planId},#{tmp.platformId},#{tmp.putawayState},#{tmp.designPlanType},
			#{tmp.allotState},#{tmp.creator},#{tmp.gmtCreate},#{tmp.modifier},#{tmp.gmtModified},#{tmp.isDeleted}
			)
		</foreach>
		 ON DUPLICATE KEY UPDATE  
       gmt_modified = NOW(),gmt_create = NOW(),putaway_state = 0
	</insert>
  
  
  <insert id="insertSelective" parameterType="com.sandu.api.solution.model.DesignPlan2cPlatform" >
    insert into design_plan_2c_platform
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="planId != null" >
        plan_id,
      </if>
      <if test="platformId != null" >
        platform_id,
      </if>
      <if test="putawayState != null" >
        putaway_state,
      </if>
      <if test="designPlanType != null" >
        design_plan_type,
      </if>
      <if test="allotState != null" >
        allot_state,
      </if>
      <if test="sysCode != null" >
        sys_code,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="gmtCreate != null" >
        gmt_create,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="gmtModified != null" >
        gmt_modified,
      </if>
      <if test="isDeleted != null" >
        is_deleted,
      </if>
      <if test="remark != null" >
        remark,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="planId != null" >
        #{planId,jdbcType=INTEGER},
      </if>
      <if test="platformId != null" >
        #{platformId,jdbcType=INTEGER},
      </if>
      <if test="putawayState != null" >
        #{putawayState,jdbcType=INTEGER},
      </if>
      <if test="designPlanType != null" >
        #{designPlanType,jdbcType=INTEGER},
      </if>
      <if test="allotState != null" >
        #{allotState,jdbcType=INTEGER},
      </if>
      <if test="sysCode != null" >
        #{sysCode,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="gmtCreate != null" >
        #{gmtCreate,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="gmtModified != null" >
        #{gmtModified,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        #{isDeleted,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sandu.api.solution.model.DesignPlan2cPlatform" >
    update design_plan_2c_platform
    <set >
      <if test="planId != null" >
        plan_id = #{planId,jdbcType=INTEGER},
      </if>
      <if test="platformId != null" >
        platform_id = #{platformId,jdbcType=INTEGER},
      </if>
      <if test="putawayState != null" >
        putaway_state = #{putawayState,jdbcType=INTEGER},
      </if>
      <if test="designPlanType != null" >
        design_plan_type = #{designPlanType,jdbcType=INTEGER},
      </if>
      <if test="allotState != null" >
        allot_state = #{allotState,jdbcType=INTEGER},
      </if>
      <if test="sysCode != null" >
        sys_code = #{sysCode,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="gmtCreate != null" >
        gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="gmtModified != null" >
        gmt_modified = #{gmtModified,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="deleteLogicByPrimaryKey" parameterType="java.lang.Long" >
    UPDATE  design_plan_2c_platform
    SET is_deleted = 1,
        remark=concat(remark,';delMark;'),
        sys_code=concat(concat(sys_code,'_del_'),
        unix_timestamp(now())),
        gmt_modified=now()
    WHERE id = #{id}
  </update>
  <sql id="sql_where" >
    <where >
      <if test="planId != null" >
         and plan_id = #{planId,jdbcType=INTEGER}
      </if>
      <if test="platformId != null" >
         and platform_id = #{platformId,jdbcType=INTEGER}
      </if>
      <if test="putawayState != null" >
         and putaway_state = #{putawayState,jdbcType=INTEGER}
      </if>
      <if test="designPlanType != null" >
         and design_plan_type = #{designPlanType,jdbcType=INTEGER}
      </if>
      <if test="allotState != null" >
         and allot_state = #{allotState,jdbcType=INTEGER}
      </if>
      <if test="sysCode != null" >
         and sys_code = #{sysCode,jdbcType=VARCHAR}
      </if>
      <if test="creator != null" >
         and creator = #{creator,jdbcType=VARCHAR}
      </if>
      <if test="gmtCreate != null" >
         and gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}
      </if>
      <if test="userId != null" >
         and user_id = #{userId,jdbcType=INTEGER}
      </if>
      <if test="modifier != null" >
         and modifier = #{modifier,jdbcType=VARCHAR}
      </if>
      <if test="gmtModified != null" >
         and gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}
      </if>
      <if test="isDeleted != null" >
         and is_deleted = #{isDeleted,jdbcType=INTEGER}
      </if>
      <if test="remark != null" >
         and remark = #{remark,jdbcType=VARCHAR}
      </if>
    </where>
  </sql>
  <select id="selectListSelective" resultType="com.sandu.api.solution.model.DesignPlan2cPlatform" parameterType="com.sandu.api.solution.model.DesignPlan2cPlatform" >
     SELECT  
    <include refid="Base_Column_List" />
    FROM design_plan_2c_platform
    <include refid="sql_where" />
  </select>


  <select id="listByPlanIdAndType" resultType="com.sandu.api.solution.model.DesignPlan2cPlatform">
    select
    <include refid="Base_Column_List"/>
    from design_plan_2c_platform dp2cp
    where
    dp2cp.plan_id = #{planId}
    <if test="planType !=null and planType!=null">
         and dp2cp.design_plan_type = #{planType}
    </if>
  </select>
  <select id="queryByPlanId" resultType="com.sandu.api.solution.model.DesignPlan2cPlatform">
    select plan_id,putaway_state,platform_id,gmt_modified
    from design_plan_2c_platform
    where is_deleted = 0 and allot_state =1
    and  plan_id in
    <foreach collection="planIds" item="it" separator="," open="(" close=")">
      #{it}
    </foreach>
  </select>

</mapper>